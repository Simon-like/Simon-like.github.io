[{"title":"ã€ç§‹æ‹›å¤‡æˆ˜ã€‘React Router è¿›åŒ–å²","url":"/2025/08/13/ã€ç§‹æ‹›å¤‡æˆ˜ã€‘React Router è¿›åŒ–å²/","content":"\n> å…„å¼Ÿï¼Œè¿˜åœ¨ä¸ºç§‹æ‹›å‘æ„ï¼Ÿä»Šå¤©å’±ä»¬æ¥èŠèŠ React Router è¿™ä¸ª\"è€å¸æœº\"ã€‚ä» v5 çš„ç¨³é‡å¤§å”åˆ° v6 çš„æ¿€è¿›é’å¹´ï¼Œå†åˆ° v7 çš„ç‹è€…å½’æ¥ï¼ˆç›´æ¥åå¹¶äº† Remixï¼‰ï¼Œè¿™ä¸ªæ•…äº‹æ¯”å®«æ–—å‰§è¿˜ç²¾å½©ã€‚ç³»å¥½å®‰å…¨å¸¦ï¼Œå’±ä»¬å‘è½¦äº†ï¼\n\n## åºç« ï¼šä¸ºä»€ä¹ˆå‰ç«¯éœ€è¦è·¯ç”±ï¼Ÿ\n\nè¿˜è®°å¾—ä¸Šå¤æ—¶ä»£çš„ç½‘é¡µå—ï¼Ÿæ¯ç‚¹ä¸€ä¸ªé“¾æ¥ï¼Œæ•´ä¸ªé¡µé¢\"å”°\"åœ°ç™½å±ï¼Œç„¶åæ…¢æ…¢åŠ è½½ã€‚ç”¨æˆ·ä½“éªŒï¼Ÿä¸å­˜åœ¨çš„ã€‚\n\nç„¶å SPAï¼ˆå•é¡µåº”ç”¨ï¼‰æ¨ªç©ºå‡ºä¸–ï¼Œé¡µé¢ä¸åˆ·æ–°äº†ï¼Œä½†æ–°é—®é¢˜æ¥äº†ï¼š\n\n- æµè§ˆå™¨çš„å‰è¿›åé€€æŒ‰é’®åºŸäº†\n- åˆ·æ–°é¡µé¢å°± 404 äº†\n- åˆ†äº«é“¾æ¥ï¼Ÿå¯¹ä¸èµ·ï¼Œéƒ½æ˜¯åŒä¸€ä¸ª URL\n\nè¿™æ—¶å€™ï¼Œå‰ç«¯è·¯ç”±ç«™å‡ºæ¥è¯´ï¼š\"è¿™æ´»å„¿æˆ‘æ¥ï¼\"\n\n## ç¬¬ä¸€ç« ï¼šReact Router v5 â€”â€” ç¨³é‡çš„è€å¤§å“¥\n\n### v5 çš„åŸºæœ¬ä½¿ç”¨\n\nReact Router v5 å°±åƒä¸ªç¨³é‡çš„è€å¸æœºï¼Œè™½ç„¶æœ‰ç‚¹å•°å—¦ï¼Œä½†é è°±ï¼š\n\n```javascript\nimport { \n  BrowserRouter as Router, \n  Route, \n  Switch, \n  Link,\n  useHistory,\n  useParams \n} from 'react-router-dom';\n\nfunction App() {\n  return (\n    <Router>\n      <nav>\n        <Link to=\"/\">é¦–é¡µ</Link>\n        <Link to=\"/about\">å…³äº</Link>\n        <Link to=\"/user/123\">ç”¨æˆ·è¯¦æƒ…</Link>\n      </nav>\n      \n      {/* Switch ç¡®ä¿åªæ¸²æŸ“ç¬¬ä¸€ä¸ªåŒ¹é…çš„è·¯ç”± */}\n      <Switch>\n        <Route exact path=\"/\">\n          <Home />\n        </Route>\n        <Route path=\"/about\">\n          <About />\n        </Route>\n        <Route path=\"/user/:id\">\n          <UserDetail />\n        </Route>\n        <Route path=\"*\">\n          <NotFound />\n        </Route>\n      </Switch>\n    </Router>\n  );\n}\n\n// ä½¿ç”¨ hooks è·å–è·¯ç”±ä¿¡æ¯\nfunction UserDetail() {\n  const { id } = useParams(); // è·å–è·¯ç”±å‚æ•°\n  const history = useHistory(); // è·å– history å¯¹è±¡\n  \n  const handleGoBack = () => {\n    history.push('/'); // ç¼–ç¨‹å¼å¯¼èˆª\n  };\n  \n  return (\n    <div>\n      <h1>ç”¨æˆ· {id} çš„è¯¦æƒ…é¡µ</h1>\n      <button onClick={handleGoBack}>è¿”å›é¦–é¡µ</button>\n    </div>\n  );\n}\n```\n\n### v5 çš„é«˜çº§æŠ€å·§\n\n```javascript\n// 1. è·¯ç”±é…ç½®åŒ–ï¼ˆæ›´ä¼˜é›…çš„å†™æ³•ï¼‰\nconst routes = [\n  { path: '/', component: Home, exact: true },\n  { path: '/about', component: About },\n  { path: '/user/:id', component: UserDetail }\n];\n\nfunction App() {\n  return (\n    <Router>\n      <Switch>\n        {routes.map(route => (\n          <Route \n            key={route.path}\n            exact={route.exact}\n            path={route.path}\n            component={route.component}\n          />\n        ))}\n      </Switch>\n    </Router>\n  );\n}\n\n// 2. è·¯ç”±å®ˆå«ï¼ˆç±»ä¼¼ Vue Router çš„å¯¼èˆªå®ˆå«ï¼‰\nfunction PrivateRoute({ children, ...rest }) {\n  const isAuthenticated = useAuth(); // å‡è®¾è¿™æ˜¯ä½ çš„è®¤è¯ hook\n  \n  return (\n    <Route {...rest}>\n      {isAuthenticated ? children : <Redirect to=\"/login\" />}\n    </Route>\n  );\n}\n\n// 3. åµŒå¥—è·¯ç”±ï¼ˆv5 çš„ç—›ç‚¹ä¹‹ä¸€ï¼‰\nfunction Users() {\n  const { path, url } = useRouteMatch();\n  \n  return (\n    <div>\n      <Link to={`${url}/profile`}>ä¸ªäººèµ„æ–™</Link>\n      <Link to={`${url}/settings`}>è®¾ç½®</Link>\n      \n      <Switch>\n        <Route exact path={path}>\n          <h3>è¯·é€‰æ‹©ä¸€ä¸ªé€‰é¡¹</h3>\n        </Route>\n        <Route path={`${path}/profile`}>\n          <Profile />\n        </Route>\n        <Route path={`${path}/settings`}>\n          <Settings />\n        </Route>\n      </Switch>\n    </div>\n  );\n}\n```\n\n## ç¬¬äºŒç« ï¼šReact Router v6 â€”â€” æ¿€è¿›çš„é©å‘½è€…\n\nv6 æ¥äº†ï¼Œå¸¦ç€ç ´åæ€§æ›´æ–°ï¼Œç¤¾åŒºç‚¸é”…äº†ï¼š\"ä½ ä»¬æ˜¯è¦æäº‹æƒ…å—ï¼Ÿ\"\n\n### v6 çš„å·¨å˜\n\n```javascript\nimport { \n  BrowserRouter,\n  Routes,  // æ³¨æ„ï¼šSwitch æ”¹åäº†\n  Route, \n  Link,\n  useNavigate,  // useHistory æ”¹åäº†\n  useParams,\n  Outlet  // æ–°æ¦‚å¿µï¼šæ’æ§½\n} from 'react-router-dom';\n\nfunction App() {\n  return (\n    <BrowserRouter>\n      <Routes>\n        {/* ä¸å†éœ€è¦ exactï¼Œé»˜è®¤å°±æ˜¯ç²¾ç¡®åŒ¹é… */}\n        <Route path=\"/\" element={<Home />} />\n        <Route path=\"/about\" element={<About />} />\n        \n        {/* åµŒå¥—è·¯ç”±çš„æ–°å†™æ³•ï¼Œè¶…çº§ä¼˜é›…ï¼ */}\n        <Route path=\"/users\" element={<Users />}>\n          <Route index element={<UserList />} />\n          <Route path=\":id\" element={<UserDetail />} />\n          <Route path=\"settings\" element={<Settings />} />\n        </Route>\n        \n        {/* 404 é¡µé¢çš„æ–°å†™æ³• */}\n        <Route path=\"*\" element={<NotFound />} />\n      </Routes>\n    </BrowserRouter>\n  );\n}\n\n// çˆ¶ç»„ä»¶ä½¿ç”¨ Outlet æ¸²æŸ“å­è·¯ç”±\nfunction Users() {\n  return (\n    <div>\n      <h1>ç”¨æˆ·ä¸­å¿ƒ</h1>\n      <nav>\n        <Link to=\"\">ç”¨æˆ·åˆ—è¡¨</Link>\n        <Link to=\"settings\">è®¾ç½®</Link>\n      </nav>\n      \n      {/* Outlet å°±åƒ Vue çš„ router-view */}\n      <Outlet />\n    </div>\n  );\n}\n\n// ç¼–ç¨‹å¼å¯¼èˆªçš„æ–°å†™æ³•\nfunction SomeComponent() {\n  const navigate = useNavigate(); // ä¸å†æ˜¯ history.push\n  \n  const handleClick = () => {\n    navigate('/about'); // æ›´ç›´è§‚\n    navigate(-1); // åé€€\n    navigate('/user/123', { replace: true }); // æ›¿æ¢å½“å‰è®°å½•\n  };\n  \n  return <button onClick={handleClick}>èµ°ä½ ï¼</button>;\n}\n```\n\n### v6 çš„æ€æ‰‹é”åŠŸèƒ½\n\n```javascript\n// 1. ç›¸å¯¹è·¯ç”±ï¼ˆç»ˆäºä¸ç”¨æ‹¼æ¥è·¯å¾„äº†ï¼ï¼‰\nfunction UserProfile() {\n  return (\n    <div>\n      {/* ç›¸å¯¹äºå½“å‰è·¯ç”± */}\n      <Link to=\"..\">è¿”å›ä¸Šçº§</Link>\n      <Link to=\"../settings\">è®¾ç½®</Link>\n      <Link to=\"edit\">ç¼–è¾‘</Link>\n    </div>\n  );\n}\n\n// 2. è·¯ç”±é…ç½®å¯¹è±¡ï¼ˆæ›´æ¥è¿‘ Vue Routerï¼‰\nconst routes = [\n  {\n    path: '/',\n    element: <Layout />,\n    children: [\n      { index: true, element: <Home /> },\n      { path: 'about', element: <About /> },\n      {\n        path: 'users',\n        element: <Users />,\n        children: [\n          { index: true, element: <UserList /> },\n          { path: ':id', element: <UserDetail /> }\n        ]\n      }\n    ]\n  }\n];\n\n// ä½¿ç”¨ useRoutes hook\nfunction App() {\n  const element = useRoutes(routes);\n  return element;\n}\n\n// 3. æ‡’åŠ è½½ï¼ˆSuspense é›†æˆï¼‰\nconst LazyAbout = React.lazy(() => import('./About'));\n\n<Route \n  path=\"/about\" \n  element={\n    <React.Suspense fallback={<Loading />}>\n      <LazyAbout />\n    </React.Suspense>\n  } \n/>\n```\n\n## ç¬¬ä¸‰ç« ï¼šåº•å±‚åŸç† â€”â€” è·¯ç”±çš„é­”æ³•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ\n\næ¥ï¼Œè®©æˆ‘ä»¬æ‰’å¼€ React Router çš„å¤–è¡£ï¼Œçœ‹çœ‹å®ƒçš„çœŸé¢ç›®ï¼\n\n### History APIï¼šä¸€åˆ‡çš„åŸºç¡€\n\n```javascript\n// æµè§ˆå™¨æä¾›çš„ History API\nwindow.history.pushState(state, title, url); // æ·»åŠ å†å²è®°å½•\nwindow.history.replaceState(state, title, url); // æ›¿æ¢å½“å‰è®°å½•\nwindow.history.back(); // åé€€\nwindow.history.forward(); // å‰è¿›\n\n// ç›‘å¬è·¯ç”±å˜åŒ–\nwindow.addEventListener('popstate', (event) => {\n  console.log('è·¯ç”±å˜åŒ–äº†ï¼', location.pathname);\n});\n```\n\n### ç®€åŒ–ç‰ˆ React Router å®ç°\n\nè®©æˆ‘ä»¬è‡ªå·±é€ ä¸ªè½®å­ï¼Œä½ å°±æ˜ç™½äº†ï¼š\n\n```javascript\n// 1. åˆ›å»º Router Context\nconst RouterContext = React.createContext();\n\n// 2. BrowserRouter å®ç°\nfunction BrowserRouter({ children }) {\n  const [location, setLocation] = useState(window.location.pathname);\n  \n  useEffect(() => {\n    // ç›‘å¬æµè§ˆå™¨å‰è¿›åé€€\n    const handlePopState = () => {\n      setLocation(window.location.pathname);\n    };\n    \n    window.addEventListener('popstate', handlePopState);\n    return () => window.removeEventListener('popstate', handlePopState);\n  }, []);\n  \n  const navigate = (to, options = {}) => {\n    if (options.replace) {\n      window.history.replaceState(null, '', to);\n    } else {\n      window.history.pushState(null, '', to);\n    }\n    setLocation(to);\n  };\n  \n  return (\n    <RouterContext.Provider value={{ location, navigate }}>\n      {children}\n    </RouterContext.Provider>\n  );\n}\n\n// 3. Route ç»„ä»¶å®ç°\nfunction Route({ path, element }) {\n  const { location } = useContext(RouterContext);\n  \n  // ç®€åŒ–ç‰ˆè·¯å¾„åŒ¹é…ï¼ˆçœŸå®çš„è¦å¤æ‚å¾—å¤šï¼‰\n  const match = matchPath(path, location);\n  \n  return match ? element : null;\n}\n\n// 4. Link ç»„ä»¶å®ç°\nfunction Link({ to, children }) {\n  const { navigate } = useContext(RouterContext);\n  \n  const handleClick = (e) => {\n    e.preventDefault(); // é˜»æ­¢é»˜è®¤è·³è½¬\n    navigate(to);\n  };\n  \n  return <a href={to} onClick={handleClick}>{children}</a>;\n}\n\n// 5. è·¯å¾„åŒ¹é…ç®—æ³•ï¼ˆç®€åŒ–ç‰ˆï¼‰\nfunction matchPath(pattern, pathname) {\n  // å¤„ç†åŠ¨æ€è·¯ç”±å‚æ•°\n  // /user/:id => /user/123\n  const regexPattern = pattern\n    .replace(/:[^/]+/g, '([^/]+)') // æ›¿æ¢ :id ä¸ºæ­£åˆ™\n    .replace(/\\*/g, '.*'); // å¤„ç†é€šé…ç¬¦\n    \n  const regex = new RegExp(`^${regexPattern}$`);\n  return regex.test(pathname);\n}\n```\n\n### Hash Router vs Browser Router\n\n```javascript\n// Hash Routerï¼šä½¿ç”¨ URL çš„ hash éƒ¨åˆ†\n// http://example.com/#/about\nclass HashRouter {\n  constructor() {\n    window.addEventListener('hashchange', this.handleHashChange);\n  }\n  \n  handleHashChange = () => {\n    const path = window.location.hash.slice(1); // å»æ‰ #\n    this.updateView(path);\n  }\n  \n  push(path) {\n    window.location.hash = path;\n  }\n}\n\n// Browser Routerï¼šä½¿ç”¨ HTML5 History API\n// http://example.com/about\nclass BrowserRouter {\n  constructor() {\n    window.addEventListener('popstate', this.handlePopState);\n  }\n  \n  handlePopState = () => {\n    this.updateView(window.location.pathname);\n  }\n  \n  push(path) {\n    window.history.pushState(null, '', path);\n    this.updateView(path);\n  }\n}\n```\n\n**é¢è¯•åŠ åˆ†ç‚¹**ï¼š\n\n- Hash Router å…¼å®¹æ€§å¥½ï¼Œä½† URL æœ‰ä¸ªä¸‘é™‹çš„ #\n- Browser Router éœ€è¦æœåŠ¡å™¨é…ç½®æ”¯æŒï¼ˆæ‰€æœ‰è·¯ç”±éƒ½è¿”å› index.htmlï¼‰\n- Hash Router ä¸ä¼šå‘é€åˆ°æœåŠ¡å™¨ï¼ŒBrowser Router ä¼š\n\n## ç¬¬å››ç« ï¼šReact Router v7 â€”â€” ç‹è€…å½’æ¥ï¼ˆèåˆ Remixï¼‰\n\n2024 å¹´åº•ï¼ŒReact Router v7 éœ‡æ’¼å‘å¸ƒï¼Œç›´æ¥æŠŠ Remix ç»™\"åå¹¶\"äº†ï¼\n\n### v7 çš„é‡ç£…ç‰¹æ€§ï¼šSSR æ”¯æŒ\n\n```javascript\n// v7 æœ€å¤§çš„å˜åŒ–ï¼šåŸç”Ÿæ”¯æŒ SSRï¼\n// è¿™ä¸æ˜¯ç®€å•çš„è·¯ç”±äº†ï¼Œè¿™æ˜¯å…¨æ ˆæ¡†æ¶ï¼\n\n// 1. æ•°æ®åŠ è½½ï¼ˆç±»ä¼¼ Next.js çš„ getServerSidePropsï¼‰\nexport async function loader({ params }) {\n  const user = await fetchUser(params.id);\n  return { user };\n}\n\nexport default function UserProfile() {\n  const { user } = useLoaderData();\n  \n  return <h1>æ¬¢è¿ï¼Œ{user.name}ï¼</h1>;\n}\n\n// 2. Action å¤„ç†è¡¨å•æäº¤\nexport async function action({ request }) {\n  const formData = await request.formData();\n  const email = formData.get('email');\n  \n  await updateEmail(email);\n  return redirect('/profile');\n}\n\nexport default function Settings() {\n  return (\n    <Form method=\"post\">\n      <input name=\"email\" type=\"email\" />\n      <button type=\"submit\">æ›´æ–°é‚®ç®±</button>\n    </Form>\n  );\n}\n\n// 3. é”™è¯¯è¾¹ç•Œ\nexport function ErrorBoundary() {\n  const error = useRouteError();\n  \n  return (\n    <div>\n      <h1>å“å‘€ï¼Œå‡ºé”™äº†ï¼</h1>\n      <p>{error.message}</p>\n    </div>\n  );\n}\n```\n\n### v7 çš„å®Œæ•´ SSR ç¤ºä¾‹\n\n```javascript\n// app/routes/blog.$slug.jsx\nimport { useLoaderData } from 'react-router-dom';\n\n// æœåŠ¡å™¨ç«¯æ•°æ®è·å–\nexport async function loader({ params }) {\n  // è¿™æ®µä»£ç åªåœ¨æœåŠ¡å™¨è¿è¡Œï¼\n  const post = await db.post.findUnique({\n    where: { slug: params.slug }\n  });\n  \n  if (!post) {\n    throw new Response('Not Found', { status: 404 });\n  }\n  \n  return { post };\n}\n\n// Meta æ ‡ç­¾ï¼ˆSEO ä¼˜åŒ–ï¼‰\nexport function meta({ data }) {\n  return [\n    { title: data.post.title },\n    { name: 'description', content: data.post.excerpt },\n    { property: 'og:title', content: data.post.title }\n  ];\n}\n\n// ç»„ä»¶\nexport default function BlogPost() {\n  const { post } = useLoaderData();\n  \n  return (\n    <article>\n      <h1>{post.title}</h1>\n      <time>{post.publishedAt}</time>\n      <div dangerouslySetInnerHTML={{ __html: post.content }} />\n    </article>\n  );\n}\n\n// æµå¼ SSRï¼ˆReact 18 ç‰¹æ€§ï¼‰\nexport async function loader() {\n  return defer({\n    critical: await getCriticalData(), // ç«‹å³åŠ è½½\n    comments: getComments() // å»¶è¿ŸåŠ è½½ï¼Œæµå¼ä¼ è¾“\n  });\n}\n\nexport default function Post() {\n  const { critical, comments } = useLoaderData();\n  \n  return (\n    <div>\n      <h1>{critical.title}</h1>\n      <Suspense fallback={<LoadingComments />}>\n        <Await resolve={comments}>\n          {(comments) => <Comments data={comments} />}\n        </Await>\n      </Suspense>\n    </div>\n  );\n}\n```\n\n## ç¬¬äº”ç« ï¼šç‰ˆæœ¬è¿ç§»æŒ‡å— â€”â€” ä» v5 åˆ° v6/v7\n\n### ä¸»è¦å˜åŒ–å¯¹ç…§è¡¨\n\n| ç‰¹æ€§      | v5                      | v6/v7                     |\n| --------- | ----------------------- | ------------------------- |\n| è·¯ç”±å®¹å™¨  | `<Switch>`              | `<Routes>`                |\n| è·¯ç”±ç»„ä»¶  | `component={Component}` | `element={<Component />}` |\n| åµŒå¥—è·¯ç”±  | æ‰‹åŠ¨æ‹¼æ¥è·¯å¾„            | è‡ªåŠ¨å¤„ç†ï¼Œä½¿ç”¨ `<Outlet>` |\n| å¯¼èˆª Hook | `useHistory`            | `useNavigate`             |\n| è·¯ç”±åŒ¹é…  | éœ€è¦ `exact`            | é»˜è®¤ç²¾ç¡®åŒ¹é…              |\n| ç›¸å¯¹é“¾æ¥  | ä¸æ”¯æŒ                  | å®Œå…¨æ”¯æŒ                  |\n\n### è¿ç§»ç¤ºä¾‹\n\n```javascript\n// v5 è€ä»£ç \nfunction OldApp() {\n  const history = useHistory();\n  \n  return (\n    <Switch>\n      <Route exact path=\"/\" component={Home} />\n      <Route path=\"/users/:id\" component={UserDetail} />\n    </Switch>\n  );\n}\n\n// v6/v7 æ–°ä»£ç \nfunction NewApp() {\n  const navigate = useNavigate();\n  \n  return (\n    <Routes>\n      <Route path=\"/\" element={<Home />} />\n      <Route path=\"/users/:id\" element={<UserDetail />} />\n    </Routes>\n  );\n}\n\n// å¤æ‚åµŒå¥—è·¯ç”±è¿ç§»\n// v5ï¼šéœ€è¦åœ¨æ¯ä¸ªç»„ä»¶é‡Œå¤„ç†\nfunction Users() {\n  const { path, url } = useRouteMatch();\n  return (\n    <Switch>\n      <Route exact path={path} component={UserList} />\n      <Route path={`${path}/:id`} component={UserDetail} />\n    </Switch>\n  );\n}\n\n// v6/v7ï¼šé›†ä¸­é…ç½®\n<Route path=\"/users\" element={<Users />}>\n  <Route index element={<UserList />} />\n  <Route path=\":id\" element={<UserDetail />} />\n</Route>\n```\n\n## ç¬¬å…­ç« ï¼šå®æˆ˜æŠ€å·§ä¸æ€§èƒ½ä¼˜åŒ–\n\n### 1. è·¯ç”±æ‡’åŠ è½½\n\n```javascript\n// é…åˆ React.lazy å’Œ Suspense\nconst LazyDashboard = lazy(() => \n  import(/* webpackChunkName: \"dashboard\" */ './Dashboard')\n);\n\nfunction App() {\n  return (\n    <Routes>\n      <Route \n        path=\"/dashboard/*\" \n        element={\n          <Suspense fallback={<Loading />}>\n            <LazyDashboard />\n          </Suspense>\n        } \n      />\n    </Routes>\n  );\n}\n```\n\n### 2. è·¯ç”±é¢„åŠ è½½\n\n```javascript\n// é¼ æ ‡æ‚¬åœæ—¶é¢„åŠ è½½\nfunction PreloadableLink({ to, children }) {\n  const handleMouseEnter = () => {\n    // é¢„åŠ è½½ç»„ä»¶\n    import(`./pages${to}`);\n  };\n  \n  return (\n    <Link to={to} onMouseEnter={handleMouseEnter}>\n      {children}\n    </Link>\n  );\n}\n```\n\n### 3. è·¯ç”±è¿‡æ¸¡åŠ¨ç”»\n\n```javascript\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\n\nfunction AnimatedRoutes() {\n  const location = useLocation();\n  \n  return (\n    <TransitionGroup>\n      <CSSTransition\n        key={location.pathname}\n        timeout={300}\n        classNames=\"fade\"\n      >\n        <Routes location={location}>\n          <Route path=\"/\" element={<Home />} />\n          <Route path=\"/about\" element={<About />} />\n        </Routes>\n      </CSSTransition>\n    </TransitionGroup>\n  );\n}\n\n/* CSS */\n.fade-enter {\n  opacity: 0;\n}\n.fade-enter-active {\n  opacity: 1;\n  transition: opacity 300ms;\n}\n.fade-exit {\n  opacity: 1;\n}\n.fade-exit-active {\n  opacity: 0;\n  transition: opacity 300ms;\n}\n```\n\n### 4. è·¯ç”±çº§åˆ«çš„çŠ¶æ€ç®¡ç†\n\n```javascript\n// ä½¿ç”¨ location.state ä¼ é€’ä¸´æ—¶æ•°æ®\nfunction ProductList() {\n  const navigate = useNavigate();\n  \n  const handleEdit = (product) => {\n    navigate('/edit', { \n      state: { product, from: '/products' } \n    });\n  };\n}\n\nfunction EditProduct() {\n  const location = useLocation();\n  const navigate = useNavigate();\n  const product = location.state?.product;\n  \n  const handleSave = async (data) => {\n    await saveProduct(data);\n    // è¿”å›æ¥æºé¡µé¢\n    navigate(location.state?.from || '/');\n  };\n}\n```\n\n## ç¬¬ä¸ƒç« ï¼šé¢è¯•å¿…è€ƒé¢˜\n\n### é¢è¯•å®˜ï¼šReact Router çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\n\n**æ ‡å‡†ç­”æ¡ˆ**ï¼š React Router åŸºäºæµè§ˆå™¨çš„ History APIï¼Œé€šè¿‡ç›‘å¬ URL å˜åŒ–æ¥æ¸²æŸ“å¯¹åº”çš„ç»„ä»¶ã€‚æ ¸å¿ƒåŸç†ï¼š\n\n1. ä½¿ç”¨ Context åœ¨ç»„ä»¶æ ‘ä¸­ä¼ é€’è·¯ç”±çŠ¶æ€\n2. Route ç»„ä»¶æ ¹æ®å½“å‰ URL åŒ¹é… path æ¥å†³å®šæ˜¯å¦æ¸²æŸ“\n3. Link ç»„ä»¶é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œè°ƒç”¨ history.pushState æ›´æ–° URL\n4. ç›‘å¬ popstate äº‹ä»¶å¤„ç†æµè§ˆå™¨å‰è¿›åé€€\n\n### é¢è¯•å®˜ï¼šå¦‚ä½•å®ç°è·¯ç”±å®ˆå«ï¼Ÿ\n\n```javascript\n// v6/v7 çš„å®ç°æ–¹å¼\nfunction RequireAuth({ children }) {\n  const auth = useAuth();\n  const location = useLocation();\n  \n  if (!auth.user) {\n    // è®°å½•ç”¨æˆ·æƒ³å»çš„é¡µé¢ï¼Œç™»å½•åè·³è½¬\n    return <Navigate to=\"/login\" state={{ from: location }} replace />;\n  }\n  \n  return children;\n}\n\n// ä½¿ç”¨\n<Route \n  path=\"/protected\" \n  element={\n    <RequireAuth>\n      <ProtectedPage />\n    </RequireAuth>\n  } \n/>\n```\n\n### é¢è¯•å®˜ï¼šHash Router å’Œ Browser Router çš„åŒºåˆ«ï¼Ÿ\n\n**åŠ åˆ†å›ç­”**ï¼š\n\n- **Hash Router**ï¼šURL å¸¦ #ï¼Œä¸éœ€è¦æœåŠ¡å™¨é…ç½®ï¼Œä¸æ”¯æŒ SSR\n- **Browser Router**ï¼šæ›´ç¾è§‚çš„ URLï¼Œéœ€è¦æœåŠ¡å™¨é…ç½®ï¼Œæ”¯æŒ SSR\n- **Memory Router**ï¼šURL ä¸å˜åŒ–ï¼Œç”¨äº React Native æˆ–æµ‹è¯•\n- **Static Router**ï¼šç”¨äº SSRï¼Œä¸ä¼šæ”¹å˜ URL\n\n### é¢è¯•å®˜ï¼šReact Router v6 ä¸ºä»€ä¹ˆè¦åš Breaking Changesï¼Ÿ\n\n**é«˜æƒ…å•†å›ç­”**ï¼š v6 çš„æ”¹åŠ¨è™½ç„¶å¾ˆå¤§ï¼Œä½†å¸¦æ¥äº†ï¼š\n\n1. **æ›´å°çš„åŒ…ä½“ç§¯**ï¼ˆå‡å°‘çº¦ 50%ï¼‰\n2. **æ›´å¥½çš„ TypeScript æ”¯æŒ**\n3. **æ›´ç›´è§‚çš„åµŒå¥—è·¯ç”±**\n4. **ç›¸å¯¹è·¯å¾„æ”¯æŒ**\n5. **ä¸º SSR åšå‡†å¤‡**ï¼ˆv7 å®ç°äº†ï¼‰\n\n## ç»“è¯­ï¼šè·¯ç”±çš„æœªæ¥\n\nä» v5 çš„ç¨³é‡ï¼Œåˆ° v6 çš„æ¿€è¿›ï¼Œå†åˆ° v7 çš„å…¨æ ˆåŒ–ï¼ŒReact Router çš„è¿›åŒ–å²å°±æ˜¯å‰ç«¯å‘å±•çš„ç¼©å½±ã€‚è®°ä½ï¼š\n\n1. **v5 è¿˜åœ¨å¹¿æ³›ä½¿ç”¨**ï¼Œå¾ˆå¤šè€é¡¹ç›®æ²¡æœ‰å‡çº§\n2. **v6 æ˜¯è¿‡æ¸¡**ï¼Œæ–°é¡¹ç›®å»ºè®®ç›´æ¥ä¸Š\n3. **v7 æ˜¯æœªæ¥**ï¼ŒSSR æˆä¸ºæ ‡é…\n\næœ€åç»™ç§‹æ‹›çš„ä½ ä¸€äº›å»ºè®®ï¼š\n\n- é¢è¯•æ—¶èƒ½è®²æ¸…æ¥šç‰ˆæœ¬å·®å¼‚ä¼šå¾ˆåŠ åˆ†\n- ç†è§£åŸç†æ¯”è®° API é‡è¦ 100 å€\n- å¦‚æœé¢è¯•å®˜é—®åˆ° v7ï¼Œè¯´æ˜è¿™æ˜¯å®¶æŠ€æœ¯å¾ˆæ–°çš„å…¬å¸\n- å‡†å¤‡ä¸€ä¸ªè·¯ç”±ç›¸å…³çš„é¡¹ç›®äº®ç‚¹ï¼Œæ¯”å¦‚\"æˆ‘ç”¨è·¯ç”±æ‡’åŠ è½½ä¼˜åŒ–äº† 70% çš„é¦–å±åŠ è½½æ—¶é—´\"\n\n**è®°ä½**ï¼šæŠ€æœ¯æ˜¯åœ¨ä¸æ–­è¿›åŒ–çš„ï¼Œä¿æŒå­¦ä¹ çš„å¿ƒæ€æ¯”æŒæ¡æŸä¸ªç‰ˆæœ¬çš„ API æ›´é‡è¦ã€‚ä»Šå¤©çš„ v7ï¼Œå¯èƒ½å°±æ˜¯æ˜å¤©çš„ \"legacy code\"ã€‚\n\n------\n\n*P.S. å¦‚æœè¿™ç¯‡æ–‡ç« å¸®åˆ°äº†ä½ ï¼Œè®°å¾—æ”¶è—èµ·æ¥ã€‚æ¯•ç«Ÿï¼Œé¢è¯•å‰ä¸´æ—¶æŠ±ä½›è„šçš„æ—¶å€™ï¼Œä½ ä¼šæ„Ÿè°¢ç°åœ¨è®¤çœŸçœ‹å®Œçš„è‡ªå·±çš„ï¼*\n\n*P.P.S. React Router å›¢é˜Ÿï¼šæ±‚æ±‚ä½ ä»¬ï¼Œåˆ«å†æç ´åæ€§æ›´æ–°äº†ï¼Œæˆ‘ä»¬å­¦ä¸åŠ¨äº†... ğŸ˜­*\n","tags":["React","ç§‹æ‹›","ReactRouter"],"categories":["ç§‹æ‹›å‡†å¤‡"]},{"title":"ã€ç§‹æ‹›å¤‡æˆ˜ã€‘ReactçŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼šRedux vs MobX","url":"/2025/08/13/ã€ç§‹æ‹›å¤‡æˆ˜ã€‘Reactè·¯ç”±ç®¡ç†æ–¹æ¡ˆï¼šRedux vs MobX/","content":"\n> æœ‹å‹ï¼Œå¬è¯´ä½ åœ¨å‡†å¤‡ç§‹æ‹›ï¼Ÿé‚£ä»Šå¤©å’±ä»¬æ¥èŠèŠå‰ç«¯æ±Ÿæ¹–é‡Œçš„ä¸¤å¤§é—¨æ´¾â€”â€”Redux å’Œ MobXã€‚è¿™ä¸¤ä½å¯éƒ½æ˜¯çŠ¶æ€ç®¡ç†ç•Œçš„å¤§ä½¬ï¼Œä¸€ä¸ªåƒå°‘æ—å¯ºçš„æ˜“ç­‹ç»ï¼Œæ‹›å¼è§„çŸ©æ£®ä¸¥ï¼›ä¸€ä¸ªåƒé€é¥æ´¾çš„åŒ—å†¥ç¥åŠŸï¼Œçµæ´»è‡ªåœ¨ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ­å¼€å®ƒä»¬çš„ç¥ç§˜é¢çº±ã€‚\n\n## ç¬¬ä¸€ç« ï¼šåˆå…¥æ±Ÿæ¹–â€”â€”ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€ç®¡ç†ï¼Ÿ\n\næƒ³è±¡ä¸€ä¸‹ï¼Œä½ åœ¨å¼€å‘ä¸€ä¸ªç”µå•†ç½‘ç«™ã€‚ç”¨æˆ·çš„è´­ç‰©è½¦æ•°æ®éœ€è¦åœ¨å¯¼èˆªæ ã€è´­ç‰©è½¦é¡µé¢ã€ç»“è´¦é¡µé¢å…±äº«ï¼Œå¦‚æœæ²¡æœ‰çŠ¶æ€ç®¡ç†ï¼Œä½ å°±å¾—åƒä¼ è¯æ¸¸æˆä¸€æ ·ï¼Œä¸€å±‚å±‚æŠŠæ•°æ®ä¼ ä¸‹å»ï¼š\n\n```javascript\n// æ²¡æœ‰çŠ¶æ€ç®¡ç†çš„ç—›è‹¦ä¼ è¯æ¸¸æˆ\n<App cartItems={cartItems}>\n  <Header cartItems={cartItems}>\n    <CartIcon cartItems={cartItems}>\n      <CartCount count={cartItems.length} /> // ç»ˆäºåˆ°äº†ï¼ç´¯æ­»äº†...\n    </CartIcon>\n  </Header>\n</App>\n```\n\nè¿™å°±æ˜¯ä¼ è¯´ä¸­çš„\"prop drilling\"ï¼ˆå±æ€§é’»å­”ï¼‰ï¼Œé’»ç€é’»ç€ï¼Œä½ å°±æƒ³æ€æ¡Œå­äº†ã€‚\n\n## ç¬¬äºŒç« ï¼šReduxâ€”â€”è§„çŸ©æ£®ä¸¥çš„å°‘æ—æ´¾\n\n### Redux çš„åŸºæœ¬æ‹›å¼\n\nRedux å°±åƒä¸€ä¸ªè¶…çº§ä¸¥æ ¼çš„å›¾ä¹¦ç®¡ç†å‘˜ï¼Œå®ƒæœ‰ä¸‰å¤§é‡‘ç§‘ç‰å¾‹ï¼š\n\n1. **å•ä¸€æ•°æ®æºï¼ˆSingle Source of Truthï¼‰**ï¼šæ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ª storeï¼Œå°±åƒå›¾ä¹¦é¦†åªæœ‰ä¸€ä¸ªæ€»ç›®å½•\n2. **State æ˜¯åªè¯»çš„**ï¼šä½ ä¸èƒ½ç›´æ¥æ”¹ä¹¦ï¼Œåªèƒ½æäº¤ç”³è¯·\n3. **ä½¿ç”¨çº¯å‡½æ•°ä¿®æ”¹**ï¼šä¿®æ”¹å¿…é¡»æŒ‰è§„çŸ©æ¥ï¼Œä¸èƒ½æç‰¹æ®Š\n\næ¥çœ‹çœ‹ Redux çš„åŸºæœ¬å¥—è·¯ï¼š\n\n```javascript\n// 1. å®šä¹‰ Actionï¼ˆä½ çš„ç”³è¯·å•ï¼‰\nconst ADD_TO_CART = 'ADD_TO_CART';\nconst addToCart = (product) => ({\n  type: ADD_TO_CART,\n  payload: product\n});\n\n// 2. åˆ›å»º Reducerï¼ˆå›¾ä¹¦ç®¡ç†å‘˜çš„å¤„ç†è§„åˆ™ï¼‰\nconst cartReducer = (state = [], action) => {\n  switch (action.type) {\n    case ADD_TO_CART:\n      // æ³¨æ„ï¼å¿…é¡»è¿”å›æ–°å¯¹è±¡ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹\n      return [...state, action.payload];\n    default:\n      return state;\n  }\n};\n\n// 3. åˆ›å»º Storeï¼ˆå›¾ä¹¦é¦†ï¼‰\nimport { createStore } from 'redux';\nconst store = createStore(cartReducer);\n\n// 4. ä½¿ç”¨ Store\nstore.dispatch(addToCart({ id: 1, name: 'ç§‹æ‹›é¢è¯•å®å…¸', price: 99 }));\nconsole.log(store.getState()); // [{ id: 1, name: 'ç§‹æ‹›é¢è¯•å®å…¸', price: 99 }]\n```\n\n### Redux çš„å†…åŠŸå¿ƒæ³•â€”â€”å®ç°åŸç†\n\nRedux çš„æ ¸å¿ƒå…¶å®å°±æ˜¯ä¸€ä¸ªå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œæˆ‘æ¥ç»™ä½ \"è§£å‰–\"ä¸€ä¸‹å®ƒçš„å†…éƒ¨æ„é€ ï¼š\n\n```javascript\n// ç®€åŒ–ç‰ˆ Redux å®ç°ï¼ˆå»æ‰äº†ä¸­é—´ä»¶ç­‰å¤æ‚åŠŸèƒ½ï¼‰\nfunction createStore(reducer, initialState) {\n  let state = initialState;\n  let listeners = []; // è®¢é˜…è€…åå•\n  \n  // è·å–å½“å‰çŠ¶æ€\n  const getState = () => state;\n  \n  // è®¢é˜…å˜åŒ–\n  const subscribe = (listener) => {\n    listeners.push(listener);\n    // è¿”å›å–æ¶ˆè®¢é˜…çš„å‡½æ•°ï¼ˆè´´å¿ƒä¸ï¼Ÿï¼‰\n    return () => {\n      listeners = listeners.filter(l => l !== listener);\n    };\n  };\n  \n  // æ´¾å‘ action\n  const dispatch = (action) => {\n    // é€šè¿‡ reducer è®¡ç®—æ–°çŠ¶æ€\n    state = reducer(state, action);\n    // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ï¼š\"å…„å¼Ÿä»¬ï¼Œæ•°æ®æ›´æ–°äº†ï¼\"\n    listeners.forEach(listener => listener());\n    return action;\n  };\n  \n  // åˆå§‹åŒ– state\n  dispatch({ type: '@@INIT' });\n  \n  return { getState, subscribe, dispatch };\n}\n```\n\nçœ‹åˆ°äº†å—ï¼ŸRedux å°±åƒä¸€ä¸ªä¸¥æ ¼çš„å¹¿æ’­ç”µå°ï¼š\n\n1. dispatch ä¸€ä¸ª action = å‘é€å¹¿æ’­ä¿¡å·\n2. reducer å¤„ç† = ç”µå°å¤„ç†ä¿¡å·\n3. é€šçŸ¥æ‰€æœ‰ listeners = å¹¿æ’­ç»™æ‰€æœ‰æ”¶éŸ³æœº\n\n### Redux åœ¨ React ä¸­çš„å®æˆ˜\n\nåœ¨ React ä¸­ä½¿ç”¨ Reduxï¼Œéœ€è¦ react-redux è¿™ä¸ª\"ç¿»è¯‘å®˜\"ï¼š\n\n```javascript\n// 1. ä½¿ç”¨ Provider åŒ…è£¹åº”ç”¨\nimport { Provider } from 'react-redux';\n\nfunction App() {\n  return (\n    <Provider store={store}>\n      <YourAppComponents />\n    </Provider>\n  );\n}\n\n// 2. ä½¿ç”¨ hooks è¿æ¥ç»„ä»¶\nimport { useSelector, useDispatch } from 'react-redux';\n\nfunction ShoppingCart() {\n  // useSelector å°±åƒä¸€ä¸ªç›‘è§†å™¨ï¼Œç›¯ç€ state çš„å˜åŒ–\n  const cartItems = useSelector(state => state.cart);\n  const dispatch = useDispatch();\n  \n  const handleAddItem = (product) => {\n    dispatch(addToCart(product));\n  };\n  \n  return (\n    <div>\n      <h2>è´­ç‰©è½¦ï¼ˆ{cartItems.length}ä»¶å•†å“ï¼‰</h2>\n      {/* ... */}\n    </div>\n  );\n}\n```\n\n## ç¬¬ä¸‰ç« ï¼šMobXâ€”â€”è‡ªç”±å¥”æ”¾çš„é€é¥æ´¾\n\nå¦‚æœè¯´ Redux æ˜¯ä¸ªä¸¥æ ¼çš„å›¾ä¹¦ç®¡ç†å‘˜ï¼Œé‚£ MobX å°±æ˜¯ä¸ªè´´å¿ƒçš„ç§äººåŠ©ç†ã€‚å®ƒä¼šè‡ªåŠ¨è¿½è¸ªä½ éœ€è¦ä»€ä¹ˆï¼Œç„¶ååœ¨æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°ã€‚\n\n### MobX çš„åŸºæœ¬æ‹›å¼\n\n```javascript\nimport { makeObservable, observable, action, computed } from 'mobx';\n\nclass ShoppingCart {\n  items = [];\n  \n  constructor() {\n    // å‘Šè¯‰ MobXï¼š\"å¸®æˆ‘ç›¯ç€è¿™äº›ä¸œè¥¿\"\n    makeObservable(this, {\n      items: observable,\n      addItem: action,\n      removeItem: action,\n      totalPrice: computed\n    });\n  }\n  \n  // ç›´æ¥ä¿®æ”¹ï¼Œæ²¡æœ‰é‚£ä¹ˆå¤šè§„çŸ©\n  addItem(product) {\n    this.items.push(product);\n  }\n  \n  removeItem(id) {\n    const index = this.items.findIndex(item => item.id === id);\n    if (index > -1) {\n      this.items.splice(index, 1);\n    }\n  }\n  \n  // è®¡ç®—å±æ€§ï¼Œè‡ªåŠ¨ç¼“å­˜\n  get totalPrice() {\n    return this.items.reduce((sum, item) => sum + item.price, 0);\n  }\n}\n\nconst cart = new ShoppingCart();\n```\n\nçœ‹åˆ°äº†å—ï¼ŸMobX å°±åƒä½ çš„è´´å¿ƒå°æ£‰è¢„ï¼Œä½ ç›´æ¥æ”¹æ•°æ®å°±è¡Œï¼Œå®ƒä¼šè‡ªåŠ¨é€šçŸ¥è¯¥é€šçŸ¥çš„äººã€‚\n\n### MobX çš„å†…åŠŸå¿ƒæ³•â€”â€”å“åº”å¼åŸç†\n\nMobX çš„é­”æ³•ä¸»è¦æ¥è‡ªäº ES6 çš„ Proxyï¼ˆæˆ–è€…åœ¨è€ç‰ˆæœ¬ä¸­ç”¨ Object.definePropertyï¼‰ã€‚è®©æˆ‘æ¥æ­ç§˜ä¸€ä¸‹ï¼š\n\n```javascript\n// ç®€åŒ–ç‰ˆ MobX åŸç†\nfunction makeObservable(target) {\n  const observers = new Set(); // è§‚å¯Ÿè€…é›†åˆ\n  \n  // ä½¿ç”¨ Proxy æ‹¦æˆªå¯¹è±¡æ“ä½œ\n  return new Proxy(target, {\n    get(obj, prop) {\n      // æ”¶é›†ä¾èµ–ï¼š\"å“¦ï¼Œæœ‰äººåœ¨è¯»å–è¿™ä¸ªå±æ€§\"\n      if (currentObserver) {\n        observers.add(currentObserver);\n      }\n      return obj[prop];\n    },\n    \n    set(obj, prop, value) {\n      obj[prop] = value;\n      // é€šçŸ¥è§‚å¯Ÿè€…ï¼š\"å…„å¼Ÿä»¬ï¼Œæ•°æ®å˜äº†ï¼\"\n      observers.forEach(observer => observer());\n      return true;\n    }\n  });\n}\n\n// è¿½è¸ªå‡½æ•°æ‰§è¡Œæ—¶è®¿é—®äº†å“ªäº›å±æ€§\nlet currentObserver = null;\n\nfunction autorun(fn) {\n  currentObserver = fn;\n  fn(); // æ‰§è¡Œä¸€æ¬¡ï¼Œæ”¶é›†ä¾èµ–\n  currentObserver = null;\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst person = makeObservable({ name: 'å°æ˜', age: 25 });\n\nautorun(() => {\n  console.log(`${person.name} ä»Šå¹´ ${person.age} å²`);\n});\n\nperson.age = 26; // è‡ªåŠ¨è§¦å‘ console.log\n```\n\nMobX çš„ç²¾é«“å°±æ˜¯ï¼š\n\n1. **ä¾èµ–æ”¶é›†**ï¼šå½“ä½ è¯»å–æ•°æ®æ—¶ï¼ŒMobX å·å·è®°ä¸‹\"è°åœ¨ç”¨è¿™ä¸ªæ•°æ®\"\n2. **è‡ªåŠ¨æ›´æ–°**ï¼šå½“æ•°æ®å˜åŒ–æ—¶ï¼ŒMobX é€šçŸ¥æ‰€æœ‰ç”¨åˆ°è¿™ä¸ªæ•°æ®çš„åœ°æ–¹\n\nè¿™å°±åƒä½ åœ¨æ·˜å®æ”¶è—äº†ä¸€ä¸ªå•†å“ï¼Œé™ä»·æ—¶è‡ªåŠ¨ç»™ä½ å‘é€šçŸ¥ä¸€æ ·è´´å¿ƒï¼\n\n### MobX åœ¨ React ä¸­çš„å®æˆ˜\n\n```javascript\nimport { observer } from 'mobx-react-lite';\n\n// observer æ˜¯ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œè®©ç»„ä»¶\"æœ‰çœ¼åŠ›è§\"\nconst ShoppingCart = observer(() => {\n  // ç›´æ¥ä½¿ç”¨ï¼Œæ²¡æœ‰ hookï¼Œæ²¡æœ‰ dispatch\n  const cart = useCart(); // å‡è®¾è¿™æ˜¯ä½ çš„ cart store\n  \n  return (\n    <div>\n      <h2>è´­ç‰©è½¦ï¼ˆ{cart.items.length}ä»¶å•†å“ï¼‰</h2>\n      <p>æ€»ä»·ï¼š{cart.totalPrice}å…ƒ</p>\n      <button onClick={() => cart.addItem(newProduct)}>\n        æ·»åŠ å•†å“\n      </button>\n    </div>\n  );\n});\n```\n\n## ç¬¬å››ç« ï¼šæ±Ÿæ¹–å¯¹å†³â€”â€”Redux vs MobX\n\nå¥½äº†ï¼Œä¸¤ä½å¤§ä¾ çš„ç»å­¦éƒ½å±•ç¤ºå®Œäº†ï¼Œè®©æˆ‘ä»¬æ¥ä¸ªæ­£é¢å¯¹å†³ï¼š\n\n### å­¦ä¹ æ›²çº¿\n\n**Redux**ï¼šå°±åƒå­¦å¼€æ‰‹åŠ¨æŒ¡æ±½è½¦ï¼Œä¸€å¼€å§‹å„ç§ç†„ç«ï¼Œä½†å­¦ä¼šäº†ä½ å°±æ˜¯è€å¸æœºã€‚\n\n- Actionã€Reducerã€Storeã€Middleware... æ¦‚å¿µä¸€å¤§å †\n- å¿…é¡»ç†è§£å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³\n- ä»£ç é‡å¤šï¼ˆè¿™ä¹Ÿå« boilerplateï¼‰\n\n**MobX**ï¼šåƒè‡ªåŠ¨æŒ¡ï¼Œä¸Šæ‰‹å°±èƒ½å¼€ï¼Œä½†ä½ å¯èƒ½ä¸çŸ¥é“å˜é€Ÿç®±æ€ä¹ˆå·¥ä½œçš„ã€‚\n\n- é¢å‘å¯¹è±¡ï¼Œç¬¦åˆç›´è§‰\n- è£…é¥°å™¨è¯­æ³•å¾ˆä¼˜é›…\n- ä»£ç é‡å°‘\n\n### å¯é¢„æµ‹æ€§\n\n**Redux**ï¼š\n\n```javascript\n// Redux çš„æ¯ä¸€æ­¥éƒ½æœ‰è¿¹å¯å¾ª\ndispatch(action) â†’ reducer â†’ new state â†’ UI update\n// æ—¶é—´æ—…è¡Œè°ƒè¯•ï¼Œå¯ä»¥å›æ”¾æ¯ä¸ª action\n```\n\n**MobX**ï¼š\n\n```javascript\n// MobX çš„æ›´æ–°æ˜¯è‡ªåŠ¨çš„ï¼Œæœ‰æ—¶å€™åƒé»‘é­”æ³•\nobservable.value = newValue â†’ ??? â†’ UI update\n// è°ƒè¯•æ—¶å¯èƒ½ä¼šæƒ³ï¼š\"å’¦ï¼Œè¿™å’‹å°±æ›´æ–°äº†ï¼Ÿ\"\n```\n\n### æ€§èƒ½ä¼˜åŒ–\n\n**Redux**ï¼š\n\n- éœ€è¦æ‰‹åŠ¨ä¼˜åŒ–ï¼ˆuseSelectorã€reselect ç­‰ï¼‰\n- å®¹æ˜“äº§ç”Ÿä¸å¿…è¦çš„æ¸²æŸ“\n- ä½†ä¼˜åŒ–åæ€§èƒ½å¾ˆå¥½\n\n**MobX**ï¼š\n\n- è‡ªåŠ¨ä¼˜åŒ–ï¼Œåªæ›´æ–°çœŸæ­£éœ€è¦æ›´æ–°çš„ç»„ä»¶\n- ç»†ç²’åº¦çš„å“åº”å¼æ›´æ–°\n- å¼€ç®±å³ç”¨çš„å¥½æ€§èƒ½\n\n### ä½¿ç”¨åœºæ™¯\n\n**é€‰ Redux çš„åœºæ™¯**ï¼š\n\n- å¤§å‹åº”ç”¨ï¼Œéœ€è¦ä¸¥æ ¼çš„æ•°æ®æµ\n- å›¢é˜Ÿåä½œï¼Œéœ€è¦ç»Ÿä¸€çš„è§„èŒƒ\n- éœ€è¦æ—¶é—´æ—…è¡Œè°ƒè¯•\n- éœ€è¦æŒä¹…åŒ–ã€åŒæ­¥ç­‰é«˜çº§åŠŸèƒ½\n\n**é€‰ MobX çš„åœºæ™¯**ï¼š\n\n- ä¸­å°å‹åº”ç”¨ï¼Œè¿½æ±‚å¼€å‘æ•ˆç‡\n- æœ‰å¾ˆå¤šæ´¾ç”ŸçŠ¶æ€ï¼ˆcomputedï¼‰\n- å›¢é˜Ÿç†Ÿæ‚‰é¢å‘å¯¹è±¡ç¼–ç¨‹\n- ä¸æƒ³å†™å¤ªå¤šæ ·æ¿ä»£ç \n\n## ç¬¬äº”ç« ï¼šå®æˆ˜æŠ€å·§ä¸æ³¨æ„äº‹é¡¹\n\n### Redux çš„å‘ä¸æŠ€å·§\n\n1. **ä¸å¯å˜æ›´æ–°çš„å‘**ï¼š\n\n```javascript\n// âŒ é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹\nstate.items.push(newItem);\n\n// âœ… æ­£ç¡®ï¼šè¿”å›æ–°å¯¹è±¡\nreturn {\n  ...state,\n  items: [...state.items, newItem]\n};\n\n// ğŸ’¡ æŠ€å·§ï¼šä½¿ç”¨ Immer ç®€åŒ–ä¸å¯å˜æ›´æ–°\nimport produce from 'immer';\n\nconst reducer = produce((draft, action) => {\n  // ç°åœ¨å¯ä»¥ç›´æ¥ä¿®æ”¹ draft\n  draft.items.push(action.payload);\n});\n```\n\n1. **å¼‚æ­¥å¤„ç†**ï¼š\n\n```javascript\n// ä½¿ç”¨ Redux Thunk å¤„ç†å¼‚æ­¥\nconst fetchUserData = (userId) => async (dispatch) => {\n  dispatch({ type: 'FETCH_START' });\n  try {\n    const data = await api.getUser(userId);\n    dispatch({ type: 'FETCH_SUCCESS', payload: data });\n  } catch (error) {\n    dispatch({ type: 'FETCH_ERROR', payload: error });\n  }\n};\n```\n\n### MobX çš„å‘ä¸æŠ€å·§\n\n1. **è§‚å¯Ÿæ•°ç»„å’Œå¯¹è±¡**ï¼š\n\n```javascript\n// âš ï¸ æ³¨æ„ï¼šMobX 4/5 éœ€è¦ä½¿ç”¨ observable æ•°ç»„çš„æ–¹æ³•\nclass Store {\n  @observable items = [];\n  \n  @action addItem(item) {\n    // âœ… è¿™æ ·ä¼šè§¦å‘æ›´æ–°\n    this.items.push(item);\n    \n    // âŒ è¿™æ ·ä¸ä¼šè§¦å‘æ›´æ–°ï¼ˆMobX 4/5ï¼‰\n    // this.items[this.items.length] = item;\n  }\n}\n```\n\n1. **é¿å…è¿‡åº¦ä½¿ç”¨ computed**ï¼š\n\n```javascript\nclass Store {\n  @observable users = [];\n  \n  // âœ… å¥½çš„ computedï¼šæœ‰å¤æ‚è®¡ç®—\n  @computed get activeUsers() {\n    return this.users.filter(u => u.isActive && u.lastLogin > someDate);\n  }\n  \n  // âŒ ä¸å¿…è¦çš„ computedï¼šå¤ªç®€å•äº†\n  @computed get userCount() {\n    return this.users.length; // ç›´æ¥ç”¨ users.length å°±è¡Œ\n  }\n}\n```\n\n## ç¬¬å…­ç« ï¼š2024 å¹´çš„æ–°è¶‹åŠ¿\n\n### Redux Toolkit â€”â€” Redux çš„ç°ä»£åŒ–æ”¹é€ \n\nRedux å¬åˆ°äº†å¤§å®¶çš„æŠ±æ€¨ï¼Œæ¨å‡ºäº† Redux Toolkit (RTK)ï¼š\n\n```javascript\nimport { createSlice } from '@reduxjs/toolkit';\n\n// ä¸€ä¸ª slice æå®š actions + reducer\nconst cartSlice = createSlice({\n  name: 'cart',\n  initialState: [],\n  reducers: {\n    addItem: (state, action) => {\n      // å¯ä»¥ç›´æ¥ä¿®æ”¹ï¼RTK å†…ç½®äº† Immer\n      state.push(action.payload);\n    },\n    removeItem: (state, action) => {\n      return state.filter(item => item.id !== action.payload);\n    }\n  }\n});\n\nexport const { addItem, removeItem } = cartSlice.actions;\nexport default cartSlice.reducer;\n```\n\n### MobX 6 çš„æ–°ç‰¹æ€§\n\nMobX 6 å¸¦æ¥äº†æ›´ç®€æ´çš„ APIï¼š\n\n```javascript\nimport { makeAutoObservable } from 'mobx';\n\nclass Store {\n  items = [];\n  \n  constructor() {\n    // è‡ªåŠ¨å°†æ‰€æœ‰å±æ€§å’Œæ–¹æ³•å˜æˆ observable/action\n    makeAutoObservable(this);\n  }\n  \n  addItem(item) {\n    this.items.push(item);\n  }\n}\n```\n\n## ç¬¬ä¸ƒç« ï¼šé¢è¯•é«˜é¢‘é—®é¢˜\n\n### é¢è¯•å®˜ï¼šRedux çš„ä¸­é—´ä»¶åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ\n\n**ä½ çš„å›ç­”**ï¼šä¸­é—´ä»¶å°±åƒå¿«é€’çš„ä¸­è½¬ç«™ï¼Œaction åœ¨åˆ°è¾¾ reducer ä¹‹å‰ä¼šç»è¿‡ä¸­é—´ä»¶å¤„ç†ï¼š\n\n```javascript\n// ä¸­é—´ä»¶çš„æœ¬è´¨æ˜¯å‡½æ•°ç»„åˆ\nconst middleware = store => next => action => {\n  console.log('dispatching', action);\n  const result = next(action); // è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶\n  console.log('next state', store.getState());\n  return result;\n};\n```\n\n### é¢è¯•å®˜ï¼šMobX å’Œ Vue çš„å“åº”å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\n\n**ä½ çš„å›ç­”**ï¼š\n\n- Vue 2ï¼šä½¿ç”¨ Object.definePropertyï¼Œéœ€è¦é¢„å®šä¹‰å±æ€§\n- Vue 3 å’Œ MobXï¼šéƒ½ä½¿ç”¨ Proxyï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å±æ€§\n- MobX æ˜¯æ˜¾å¼å£°æ˜ï¼ˆmakeObservableï¼‰ï¼ŒVue æ˜¯è‡ªåŠ¨çš„ï¼ˆdata å‡½æ•°ï¼‰\n\n## ç»“è¯­ï¼šæ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰æƒè¡¡\n\nè®°ä½ï¼ŒRedux å’Œ MobX éƒ½æ˜¯å·¥å…·ï¼Œæ²¡æœ‰ç»å¯¹çš„å¥½åã€‚å°±åƒé‡‘åº¸å°è¯´é‡Œï¼Œé™é¾™åå…«æŒåˆšçŒ›æ— æ¯”ï¼Œå‡Œæ³¢å¾®æ­¥é£˜é€¸çµåŠ¨ï¼Œå…³é”®çœ‹ä½ è¦æ‰“ä»€ä¹ˆæ€ªã€‚\n\n**ç»™ç§‹æ‹›çš„ä½ ä¸€äº›å»ºè®®**ï¼š\n\n1. ä¸¤ä¸ªéƒ½è¦äº†è§£ï¼Œä½†ç²¾é€šä¸€ä¸ªå°±å¤Ÿäº†\n2. ç†è§£åŸç†æ¯”ä¼šç”¨ API æ›´é‡è¦\n3. é¡¹ç›®ä¸­é‡åˆ°çŠ¶æ€ç®¡ç†çš„ç—›ç‚¹ï¼Œæ‰èƒ½çœŸæ­£ç†è§£è¿™äº›å·¥å…·çš„ä»·å€¼\n4. é¢è¯•æ—¶èƒ½è®²æ¸…æ¥šæƒè¡¡ï¼ˆtrade-offï¼‰æ¯”æ­»è®°ç¡¬èƒŒæ›´åŠ åˆ†\n\næœ€åï¼Œç¥ä½ ç§‹æ‹›é¡ºåˆ©ï¼Œoffer æ‹¿åˆ°æ‰‹è½¯ï¼è®°ä½ï¼ŒæŠ€æœ¯åªæ˜¯å·¥å…·ï¼Œè§£å†³é—®é¢˜çš„æ€ç»´æ‰æ˜¯æ ¸å¿ƒç«äº‰åŠ›ã€‚\n\n------\n\n*P.S. å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾—ç»™æœªæ¥çš„åŒäº‹ä»¬ä¹Ÿåˆ†äº«ä¸€ä¸‹ã€‚æ¯•ç«Ÿï¼Œç‹¬ä¹ä¹ä¸å¦‚ä¼—ä¹ä¹ï¼Œä¸€èµ·è¿›æ­¥æ‰æ˜¯çœŸçš„è¿›æ­¥ï¼*\n","tags":["React","ç§‹æ‹›","Redux","Mobx"],"categories":["ç§‹æ‹›å‡†å¤‡"]},{"title":"ã€ä»é¡¹ç›®åˆ°æŠ€æœ¯ã€‘SPA vs MPA æ·±åº¦åˆ†æ","url":"/2025/08/13/ã€ä»é¡¹ç›®åˆ°æŠ€æœ¯ã€‘SPA vs MPA æ·±åº¦åˆ†æ/","content":"\n2024-2025å¹´å‰ç«¯æ¶æ„æ­£ç»å†é‡è¦è½¬å‹ï¼Œå¼€å‘è€…æ­£ä»ä¼ ç»Ÿçš„\"JavaScriptä¼˜å…ˆ\"æ¨¡å¼è½¬å‘æ›´å¹³è¡¡çš„æ€§èƒ½å¯¼å‘è§£å†³æ–¹æ¡ˆã€‚æœ¬æŠ¥å‘ŠåŸºäºæœ€æ–°è¡Œä¸šæ•°æ®å’ŒæŠ€æœ¯å‘å±•ï¼Œä¸ºReactå¼€å‘è€…æä¾›æ¶æ„é€‰æ‹©çš„å…¨é¢æŒ‡å¯¼ã€‚\n\n## SPAç–²åŠ³ä¸æ¶æ„æ–‡è‰ºå¤å…´\n\nå½“å‰å‰ç«¯ç¤¾åŒºæ­£ç»å†æ‰€è°“çš„\"SPAç–²åŠ³\"ç°è±¡ã€‚è™½ç„¶å•é¡µåº”ç”¨ä»å æ®90%çš„ä½¿ç”¨ç‡ï¼Œä½†å¼€å‘è€…è¶Šæ¥è¶Šæ„è¯†åˆ°å…¶æ€§èƒ½å’Œå¤æ‚æ€§æˆæœ¬ã€‚è¡Œä¸šæ•´ä½“è¶‹åŠ¿æ˜¯\"**æ›´å¤šä¾èµ–æœåŠ¡å™¨ï¼Œå‘æµè§ˆå™¨å‘é€æ›´å°‘JavaScriptï¼Œå‡å°‘UIæ¸²æŸ“è¯·æ±‚ï¼Œæ›´å¿«åœ°æ‰“åŒ…ä»£ç **\"ï¼Œè¿™ä»£è¡¨äº†ä»å®¢æˆ·ç«¯é‡å‹å‘æœåŠ¡å™¨é‡å‹æ¶æ„çš„æ ¹æœ¬æ€§è½¬å˜ã€‚\n\nå…³é”®çš„å˜åŒ–æ˜¯æ··åˆæ–¹æ³•çš„å…´èµ·ï¼Œè€Œéç®€å•çš„SPAæˆ–MPAäºŒé€‰ä¸€ã€‚å¼€å‘è€…é‡‡ç”¨å²›å±¿æ¶æ„ï¼ˆIslands Architectureï¼‰è¿›è¡Œé€‰æ‹©æ€§æ°´åˆã€æœåŠ¡å™¨ç«¯æ¸²æŸ“é…åˆå®¢æˆ·ç«¯å¢å¼ºã€ä»¥åŠé™æ€ç«™ç‚¹ç”Ÿæˆä¸åŠ¨æ€å…ƒç´ çš„ç»“åˆã€‚\n\n## ç”µå•†å¹³å°ä¸­çš„SPA vs MPAæ¶æ„å¯¹æ¯”\n\n### æ¶æ„ä¼˜åŠ¿åˆ†æ\n\n**SPAåœ¨ç”µå•†ä¸­çš„ä¼˜åŠ¿ï¼š**\n\n- **æµç•…çš„ç”¨æˆ·ä½“éªŒ**ï¼šæ— åˆ·æ–°é¡µé¢è½¬æ¢ï¼Œç±»ä¼¼åŸç”Ÿåº”ç”¨çš„äº¤äº’\n- **å“è¶Šçš„ç§»åŠ¨ç«¯æ€§èƒ½**ï¼šå¯¹äºç§»åŠ¨ç”µå•†è‡³å…³é‡è¦\n- **åŠ¨æ€ç­›é€‰æœç´¢**ï¼šå³æ—¶äº§å“ç­›é€‰ã€æ’åºå’Œæœç´¢åŠŸèƒ½\n- **å®æ—¶åŠŸèƒ½æ”¯æŒ**ï¼šè´­ç‰©è½¦æ›´æ–°ã€åº“å­˜çŠ¶æ€ã€ä»·æ ¼å˜åŒ–\n- **å‡å°‘æœåŠ¡å™¨è´Ÿè½½**ï¼šåˆå§‹åŠ è½½åä»…éœ€è·å–æ•°æ®(JSON)\n\n**MPAåœ¨ç”µå•†ä¸­çš„ä¼˜åŠ¿ï¼š**\n\n- **å“è¶Šçš„SEOè¡¨ç°**ï¼šæ¯ä¸ªé¡µé¢éƒ½æœ‰ç‹¬ç‰¹URLã€å…ƒæ•°æ®å’Œå†…å®¹ï¼Œæ˜“äºæœç´¢å¼•æ“ç´¢å¼•\n- **æ›´å¿«çš„åˆå§‹åŠ è½½**ï¼šä»…åŠ è½½å½“å‰é¡µé¢æ‰€éœ€èµ„æº\n- **æ›´å¥½çš„æµè§ˆå™¨å…¼å®¹æ€§**ï¼šé€‚ç”¨äºæ‰€æœ‰è®¾å¤‡ï¼ŒåŒ…æ‹¬æ—§ç‰ˆæµè§ˆå™¨\n- **ç‹¬ç«‹é¡µé¢ä¼˜åŒ–**ï¼šæ¯ä¸ªäº§å“/ç±»ç›®é¡µé¢å¯å•ç‹¬ä¼˜åŒ–\n- **æˆç†Ÿçš„å®‰å…¨æ¨¡å‹**ï¼šæœåŠ¡å™¨ç«¯æ¸²æŸ“æä¾›ä¼ ç»Ÿã€æ˜“ç†è§£çš„å®‰å…¨æ¨¡å¼\n\n### ä¸åŒé¡µé¢ç±»å‹çš„æ¶æ„é€‰æ‹©å»ºè®®\n\n**å•†å“åˆ—è¡¨/ç±»ç›®é¡µé¢** **æ¨èï¼šæ··åˆMPA + SPAç»„ä»¶**\n\n- åŸºç¡€ç»“æ„ä½¿ç”¨MPAä»¥è·å¾—SEOä¼˜åŠ¿å’Œæ˜“äºç´¢å¼•\n- ç­›é€‰ã€æ’åºã€åˆ†é¡µåŠŸèƒ½é‡‡ç”¨SPAç»„ä»¶\n- æœç´¢å¼•æ“å¯ä»¥çˆ¬å–ç±»ç›®ç»“æ„ï¼Œç”¨æˆ·è·å¾—æµç•…çš„ç­›é€‰ä½“éªŒ\n\n**å•†å“è¯¦æƒ…é¡µ(PDP)** **æ¨èï¼šMPA + äº¤äº’å¼ç»„ä»¶**\n\n- æœåŠ¡å™¨æ¸²æŸ“é¡µé¢ç¡®ä¿SEOå’Œå¿«é€ŸåŠ è½½\n- å›¾ç‰‡ç”»å»Šã€è¯„è®ºã€åŠ è´­åŠŸèƒ½ä½¿ç”¨JavaScriptå¢å¼º\n- æ¯ä¸ªäº§å“éœ€è¦ç‹¬ç«‹URLã€å…ƒæ•°æ®å’Œç»“æ„åŒ–æ•°æ®\n\n**è´­ç‰©è½¦åŠŸèƒ½** **æ¨èï¼šMPAæ¡†æ¶å†…çš„SPAç»„ä»¶**\n\n- è´­ç‰©è½¦æ›´æ–°éœ€è¦æ— åˆ·æ–°å®æ—¶æ›´æ–°ä»¥ç¡®ä¿ç”¨æˆ·ä½“éªŒ\n- å®æ–½ç­–ç•¥ï¼šä¹è§‚æ›´æ–°é…åˆæœåŠ¡å™¨éªŒè¯çš„æ··åˆæ–¹æ³•\n\n**ç»“è´¦æ”¯ä»˜æµç¨‹** **å¼ºçƒˆæ¨èï¼šMPAæ¶æ„**\n\n- åˆ†æ­¥å¯¼èˆªçš„ä¼ ç»Ÿå¤šé¡µé¢ç»“è´¦å¯å‡å°‘æ”¾å¼ƒç‡\n- æœåŠ¡å™¨ç«¯æ¸²æŸ“å¯¹æ”¯ä»˜å¤„ç†è‡³å…³é‡è¦\n- åŸºäºé¡µé¢çš„æ–¹æ³•æ›´é€‚åˆå¤„ç†æ”¯ä»˜å¤±è´¥\n- å®¢æˆ·æœŸæœ›ä¼ ç»Ÿç»“è´¦æµç¨‹ä»¥å»ºç«‹ä¿¡ä»»æ„Ÿ\n\n**ç”¨æˆ·è´¦æˆ·é¡µé¢** **æ¨èï¼šSPAæ¶æ„**\n\n- ç”¨æˆ·æœŸæœ›è´¦æˆ·ç®¡ç†å…·æœ‰ç±»ä¼¼åº”ç”¨çš„ç•Œé¢\n- è®¢å•çŠ¶æ€ã€åå¥½è®¾ç½®ã€æ„¿æœ›æ¸…å•å˜åŒ–å—ç›ŠäºSPAæ¨¡å¼\n- è´¦æˆ·é¡µé¢é€šå¸¸ä¸è¢«æœç´¢å¼•æ“ç´¢å¼•ï¼ŒSEOä¼˜å…ˆçº§è¾ƒä½\n\n## Reactå¼€å‘è€…çš„MPAæ¶æ„é€‰æ‹©æ—¶æœº\n\n### é€‰æ‹©MPAçš„å…³é”®åœºæ™¯\n\n**åº”é€‰æ‹©MPAæ¶æ„å½“ï¼š**\n\n- **SEOè‡³å…³é‡è¦**ï¼šå†…å®¹ä¸ºä¸»çš„ç½‘ç«™ã€åšå®¢ã€è¥é”€ç«™ç‚¹\n- **é¦–å±åŠ è½½é€Ÿåº¦ä¼˜å…ˆ**ï¼šMPAçš„é¦–å­—èŠ‚æ—¶é—´(TTFB)å’Œé¦–æ¬¡å†…å®¹ç»˜åˆ¶(FCP)æ›´å¿«\n- **JavaScriptéœ€æ±‚æœ‰é™**ï¼šäº¤äº’æ€§ä¸å¼ºçš„ç½‘ç«™æ— éœ€å¤æ‚å®¢æˆ·ç«¯çŠ¶æ€ç®¡ç†\n- **æ¸è¿›å¢å¼ºæ–¹æ³•**ï¼šæ ¸å¿ƒåŠŸèƒ½éœ€è¦åœ¨æ— JavaScriptç¯å¢ƒä¸‹å·¥ä½œ\n- **å¤§è§„æ¨¡äº§å“ç›®å½•**ï¼šéœ€è¦ä¼˜ç§€SEOè¡¨ç°çš„ç”µå•†å¹³å°\n\n**ä»é€‰æ‹©SPAæ¶æ„å½“ï¼š**\n\n- **é«˜äº¤äº’æ€§éœ€æ±‚**ï¼šä»ªè¡¨æ¿ã€ç®¡ç†é¢æ¿ã€å®æ—¶åº”ç”¨\n- **ç±»åº”ç”¨ä½“éªŒ**ï¼šæµç•…å¯¼èˆªã€è·¨è§†å›¾å…±äº«çŠ¶æ€\n- **å¤æ‚å®¢æˆ·ç«¯é€»è¾‘**ï¼šç¹é‡çŠ¶æ€ç®¡ç†ã€å®æ—¶æ›´æ–°\n\n### æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”\n\nåŸºäº2024å¹´åŸºå‡†æµ‹è¯•æ•°æ®ï¼š\n\n- **æœåŠ¡å™¨ç«¯æ¸²æŸ“æ€§èƒ½**ï¼šSvelte(1,641 req/s) > Vue(1,139 req/s) > React(572 req/s)\n- **MPAä¼˜åŠ¿**ï¼šæ›´å¥½çš„SEOç´¢å¼•ã€æ›´å¿«çš„åˆå§‹é¡µé¢åŠ è½½ã€æ›´å°çš„JavaScriptåŒ…å¤§å°\n- **SPAä¼˜åŠ¿**ï¼šæ›´æµç•…çš„å¯¼èˆªã€åˆå§‹åŠ è½½åæ›´å¥½çš„æ„ŸçŸ¥æ€§èƒ½ã€å…±äº«çŠ¶æ€ç®¡ç†\n\n## é€‚åˆReactå¼€å‘è€…çš„MPAæ¡†æ¶å·¥å…·å¯¹æ¯”\n\n### Next.jsï¼šå¸‚åœºé¢†å¯¼è€…\n\n**æŠ€æœ¯è§„æ ¼ï¼š**\n\n- **æ¸²æŸ“æ–¹å¼**ï¼šSSRã€SSGã€ISRã€å®¢æˆ·ç«¯æ¸²æŸ“æ”¯æŒ\n- **è·¯ç”±ç³»ç»Ÿ**ï¼šåŸºäºæ–‡ä»¶çš„è·¯ç”±ï¼ˆPages Router vs App Routerï¼‰\n- **æ€§èƒ½ç‰¹æ€§**ï¼šReact Server Componentsã€Turbopackæ‰“åŒ…\n- **å¸‚åœºé‡‡ç”¨ç‡**ï¼šåœ¨State of JS 2024ä¸­ä¿æŒ52.9%çš„é‡‡ç”¨ç‡\n\n**App Router vs Pages Routerï¼š**\n\n- **App Routerï¼ˆæ¨èï¼‰**ï¼šé»˜è®¤ä½¿ç”¨React Server Componentsï¼ŒåŸºäºæ–‡ä»¶å¤¹çš„è·¯ç”±ï¼Œæ›´å¥½çš„æ€§èƒ½ä½†å­¦ä¹ æ›²çº¿æ›´é™¡\n- **Pages Routerï¼ˆé—ç•™ï¼‰**ï¼šåŸºäºæ–‡ä»¶çš„è·¯ç”±ï¼Œæ›´ç®€å•çš„è¿ç§»è·¯å¾„ä½†ä¸å†æ¨è\n\n### SvelteKitï¼šæ€§èƒ½å† å†›\n\n**æŠ€æœ¯è§„æ ¼ï¼š**\n\n- **æ€§èƒ½ä¼˜åŠ¿**ï¼šç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œæ— è™šæ‹ŸDOMå¼€é”€ï¼Œæ›´å°çš„JavaScriptåŒ…\n- **å¼€å‘ä½“éªŒ**ï¼šåŸºäºæ–‡ä»¶çš„è·¯ç”±ï¼Œå†…ç½®TypeScriptæ”¯æŒ\n- **å…´è¶£åº¦**ï¼š43.6%çš„å¼€å‘è€…æœ‰å…´è¶£å­¦ä¹ SvelteKit\n- **æ ¸å¿ƒWebç”Ÿå‘½åŠ›æŒ‡æ ‡**è¡¨ç°ä¼˜ç§€\n\n### Astroï¼šå†…å®¹ä¼˜å…ˆæ¶æ„\n\n**å…³é”®ç‰¹æ€§ï¼š**\n\n- **å“²å­¦**ï¼šå†…å®¹ä¼˜å…ˆï¼Œé»˜è®¤é›¶JavaScript\n- **å²›å±¿æ¶æ„**ï¼šé€‰æ‹©æ€§æ°´åˆäº¤äº’å¼ç»„ä»¶\n- **æ¡†æ¶æ— å…³**ï¼šæ”¯æŒReactã€Vueã€Svelteç»„ä»¶\n- **å¢é•¿æ•°æ®**ï¼šå°½ç®¡æ˜¯æ–°æ¡†æ¶ï¼Œä½†å·²è·å¾—25%çš„é‡‡ç”¨ç‡\n\n**ä»£ç ç¤ºä¾‹ï¼š**\n\n```javascript\n// Astroç»„ä»¶ä¸å²›å±¿æ°´åˆ\n---\nimport { getCollection } from 'astro:content';\nimport BlogPost from '../components/BlogPost.astro';\n\nconst posts = await getCollection('blog');\n---\n\n<html>\n  <body>\n    {posts.map(post => \n      <BlogPost \n        post={post} \n        client:visible \n      />\n    )}\n  </body>\n</html>\n```\n\n### Fresh (Deno)ï¼šè¾¹ç¼˜åŸç”Ÿæ¡†æ¶\n\n**æŠ€æœ¯è§„æ ¼ï¼š**\n\n- **è¿è¡Œæ—¶**ï¼šDenoåŸç”Ÿï¼Œå†…ç½®TypeScriptæ”¯æŒ\n- **æ¶æ„**ï¼šåŸºäºå²›å±¿çš„Preactç»„ä»¶\n- **è¾¹ç¼˜è®¡ç®—**ï¼šä¸“ä¸ºè¾¹ç¼˜éƒ¨ç½²æ„å»º\n- **å³æ—¶æ¸²æŸ“**ï¼šé›¶é…ç½®ï¼Œå®æ—¶ç¼–è¯‘\n\n## Remixæ¡†æ¶æ·±åº¦åˆ†æ\n\n### é‡å¤§æ›´æ–°ï¼šRemixè½¬åŒ–ä¸ºReact Router v7\n\n**2024å¹´12æœˆé‡å¤§å˜æ›´**ï¼šRemixå·²æ¼”è¿›ä¸ºReact Router v7ã€‚Remixå›¢é˜Ÿå°†RemixåŠŸèƒ½åˆå¹¶åˆ°React Routerä¸­ï¼Œä½¿React Router v7æˆä¸ºRemix v2çš„ç»§ä»»è€…ã€‚è¿™ä»£è¡¨äº†Reactç”Ÿæ€ç³»ç»Ÿçš„é‡è¦æ•´åˆã€‚\n\n### æ ¸å¿ƒæ¶æ„ä¸å“²å­¦\n\n**å››å¤§æ”¯æŸ±**ï¼š\n\n1. **æ‹¥æŠ±æœåŠ¡å™¨/å®¢æˆ·ç«¯æ¨¡å‹**ï¼šæºä»£ç ä¸å†…å®¹/æ•°æ®åˆ†ç¦»\n2. **ä½¿ç”¨Webæ ‡å‡†**ï¼šåˆ©ç”¨æµè§ˆå™¨ã€HTTPå’ŒHTMLåŸºç¡€\n3. **ç”¨JavaScriptå¢å¼º**ï¼šæ¨¡æ‹Ÿè€Œéæ›¿ä»£æµè§ˆå™¨è¡Œä¸º\n4. **æ¸è¿›å¢å¼º**ï¼šåº”ç”¨åœ¨æ— JavaScriptæƒ…å†µä¸‹å·¥ä½œï¼Œæœ‰JavaScriptæ—¶å¢å¼º\n\n**è®¾è®¡åŸåˆ™ï¼š**\n\n- **UIä¸ºä¸­å¿ƒçš„è·¯ç”±**ï¼šä¸“æ³¨äºUIç»„ä»¶å’Œå¸ƒå±€è€Œéæ¨¡å‹\n- **Webæ ‡å‡†ä¼˜å…ˆ**ï¼šåŸºäºWeb Fetch APIï¼Œæ”¯æŒHTTPç¼“å­˜\n- **\"ä¸­å¿ƒæ ˆ\"æ–¹æ³•**ï¼šèåˆä¼ ç»Ÿ(Webæ ‡å‡†)å’Œç°ä»£(React)å¼€å‘æ¨¡å¼\n\n### ä¸Next.jsçš„è¯¦ç»†å¯¹æ¯”\n\n| æ–¹é¢         | Remix/React Router v7        | Next.js                            |\n| ------------ | ---------------------------- | ---------------------------------- |\n| **æ¶æ„**     | æœåŠ¡å™¨ä¼˜å…ˆï¼ŒWebæ ‡å‡†          | æ··åˆ(SSG/SSR/CSR)                  |\n| **æ¸²æŸ“**     | SSR + æ¸è¿›å¢å¼º               | SSGã€SSRã€ISRã€CSR                 |\n| **æ•°æ®è·å–** | Loaders(æœåŠ¡å™¨) + å®¢æˆ·ç«¯æ°´åˆ | getStaticPropsã€getServerSideProps |\n| **è·¯ç”±**     | åµŒå¥—çš„ï¼ŒåŸºäºURLæ®µ            | åŸºäºæ–‡ä»¶çš„pagesç›®å½•                |\n| **è¡¨å•å¤„ç†** | åŸç”ŸHTMLè¡¨å•å¢å¼º             | éœ€è¦JavaScriptçš„æ–¹æ³•               |\n| **æ ‡å‡†èšç„¦** | Web Fetch APIã€HTTPæ ‡å‡†      | Node.jsç”Ÿæ€é›†æˆ                    |\n\n**æ€§èƒ½ç‰¹å¾ï¼š**\n\n- **Remixä¼˜åŠ¿**ï¼šé€šè¿‡SSRæ›´å¿«çš„åŠ¨æ€å†…å®¹ä¼ é€’ï¼Œå‡å°‘å®¢æˆ·ç«¯JavaScriptåŒ…å¤§å°ï¼Œå¹¶è¡Œæ•°æ®åŠ è½½ï¼Œæ…¢ç½‘ç»œä¸‹æ›´å¥½çš„æ€§èƒ½\n- **Next.jsä¼˜åŠ¿**ï¼šSSGçš„å“è¶Šé™æ€ç«™ç‚¹æ€§èƒ½ï¼Œå¼€ç®±å³ç”¨çš„å›¾åƒä¼˜åŒ–ï¼Œå¢é‡é™æ€å†ç”Ÿæˆ(ISR)\n\n### é€‚ç”¨åœºæ™¯\n\n**é€‰æ‹©Remix/React Router v7å½“ï¼š**\n\n- åŠ¨æ€æ•°æ®å¯†é›†å‹åº”ç”¨\n- éœ€è¦å¼ºSEOçš„ç”µå•†ç½‘ç«™\n- ä»ªè¡¨æ¿å’Œç®¡ç†åº”ç”¨\n- é‡è§†æ¸è¿›å¢å¼ºçš„åº”ç”¨\n\n**é€‰æ‹©Next.jså½“ï¼š**\n\n- é™æ€æˆ–å¤§éƒ¨åˆ†é™æ€çš„ç½‘ç«™\n- å†…å®¹å¯†é›†å‹ç½‘ç«™å’Œåšå®¢\n- éœ€è¦å¹¿æ³›é™æ€ä¼˜åŒ–çš„åº”ç”¨\n- éœ€è¦æˆç†Ÿç”Ÿæ€æ”¯æŒçš„å›¢é˜Ÿ\n\n## é¦–å±åŠ è½½æ€§èƒ½ä¼˜åŒ–ç­–ç•¥\n\n### SPAä¼˜åŒ–ç­–ç•¥\n\n**æœåŠ¡å™¨ç«¯æ¸²æŸ“(SSR)å®ç°ï¼š**\n\n- ä¼ é€’åˆå§‹HTMLä»¥å¯ç”¨æµè§ˆå™¨èµ„æºåŠ è½½ä¼˜åŒ–\n- é˜²æ­¢åœ¨å®¢æˆ·ç«¯æ¸²æŸ“åº”ç”¨ä¸­å‡ºç°çš„åæœŸèµ„äº§å‘ç°\n- ä½¿ç”¨React 18çš„æµå¼SSRä¸Suspenseè¾¹ç•Œ\n\n**æ¸è¿›å¼æ°´åˆç­–ç•¥ï¼š**\n\n```javascript\n// ç©ºé—²ç›´åˆ°ç´§æ€¥æ¨¡å¼å®ç°\nconst EnhancedComponent = withIdleRender(MyComponent);\n// åœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´æˆ–ç”¨æˆ·äº¤äº’æ—¶æ°´åˆç»„ä»¶\n```\n\n**æ€§èƒ½å½±å“ï¼š**\n\n- Cdiscounté€šè¿‡æ¸è¿›å¼æ°´åˆå®ç°45%çš„åˆå§‹æ°´åˆæˆæœ¬é™ä½(128msé™è‡³70ms)\n- é¦–æ¬¡è¾“å…¥å»¶è¿Ÿé™ä½50%+\n- å…³é”®é¦–å±å†…å®¹æ›´æ—©å®ç°äº¤äº’æ€§\n\n**æ†ç»‘åŒ…å¤§å°ä¼˜åŒ–ï¼š**\n\n- åŸºäºè·¯ç”±çš„ä»£ç åˆ†å‰²(æœ€æœ‰æ•ˆçš„ç¬¬ä¸€æ­¥)\n- åŸºäºç»„ä»¶çš„åˆ†å‰²(é€‚ç”¨äºå¾ˆå°‘ä½¿ç”¨çš„åŠŸèƒ½ï¼Œ>100KBé˜ˆå€¼)\n- å¼¹çª—/æ¨¡æ€æ¡†åˆ†å‰²(æŒ‰éœ€åŠ è½½)\n- åŸºäºç‰¹æ€§çš„åˆ†å‰²(ä¸åŒåŠŸèƒ½çš„ç‹¬ç«‹å—)\n\n### MPAä¼˜åŒ–ç­–ç•¥\n\n**ç¼“å­˜ç­–ç•¥ï¼š**\n\n- å¸¦å†…å®¹å“ˆå¸Œçš„é™æ€èµ„æºé•¿æœŸç¼“å­˜(æ¨è1å¹´)\n- HTMLé¡µé¢çŸ­TTL(æ¨è60ç§’)\n- åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜è¿›è¡Œåç»­é¡µé¢åŠ è½½\n\n**CDNå®ç°ï¼š**\n\n- é™æ€èµ„æºçš„è¾¹ç¼˜ç¼“å­˜\n- åœ°ç†åˆ†å¸ƒå‡å°‘å»¶è¿Ÿ\n- Gzip/Brotliå‹ç¼©(å¯å®ç°70%+æ–‡ä»¶å¤§å°ç¼©å‡)\n\n**èµ„æºä¼˜åŒ–ï¼š**\n\n- æœ€å°åŒ–é˜»å¡CSSå’ŒJavaScript\n- å®ç°å…³é”®CSSå†…è”\n- ä½¿ç”¨ç°ä»£å›¾åƒæ ¼å¼å’Œå“åº”å¼å›¾ç‰‡\n- ä½¿ç”¨WOFF2å’Œfont-display: swapä¼˜åŒ–å­—ä½“åŠ è½½\n\n### æ··åˆæ¶æ„ä¼˜åŒ–\n\n**PESPA(æ¸è¿›å¢å¼ºSPA)æ–¹æ³•ï¼š**\n\n- Next.jsåº”ç”¨ä¸SSG/SSR\n- å¸¦é€‰æ‹©æ€§äº¤äº’çš„Astro\n- å²›å±¿æ¶æ„(Qwikã€Fresh)\n- å¸¦å®¢æˆ·ç«¯æ°´åˆçš„æœåŠ¡å™¨ç»„ä»¶\n\n## 2024-2025å‰ç«¯æ¶æ„è¶‹åŠ¿\n\n### å²›å±¿æ¶æ„çš„å´›èµ·\n\n**å®šä¹‰ä¸æ¦‚å¿µ**ï¼šå²›å±¿æ¶æ„æ—¨åœ¨é€šè¿‡åœ¨é™æ€HTMLä¹‹ä¸Šç‹¬ç«‹äº¤ä»˜çš„\"äº¤äº’å²›å±¿\"æ¥å‡å°‘å‘é€çš„JavaScripté‡ã€‚\n\n**å…³é”®ä¼˜åŠ¿ï¼š**\n\n- **æ€§èƒ½**ï¼šç›¸æ¯”ä¼ ç»Ÿæ¡†æ¶JavaScriptä»£ç å‡å°‘83%\n- **SEOå‹å¥½**ï¼šæœåŠ¡å™¨æ¸²æŸ“çš„é™æ€å†…å®¹\n- **æ¸è¿›å¢å¼º**ï¼šå…³é”®å†…å®¹ç«‹å³åŠ è½½ï¼Œäº¤äº’æ€§é€æ­¥åŠ è½½\n- **ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªå²›å±¿ç‹¬ç«‹æ°´åˆï¼Œé˜²æ­¢çº§è”æ•…éšœ\n\n### å¼€å‘è€…æƒ…ç»ªä¸é‡‡ç”¨è¶‹åŠ¿\n\n**State of JavaScript 2024ç»“æœï¼š**\n\n- **React**ï¼šä¿æŒ69.9%ä½¿ç”¨ç‡ä½†å¢é•¿æ”¾ç¼“\n- **Next.js**ï¼šåœ¨å…ƒæ¡†æ¶ä¸­52.9%é‡‡ç”¨ç‡\n- **SvelteKit**ï¼šå…´è¶£ä¸Šå‡(43.6%æƒ³å­¦ä¹ )\n- **Astro**ï¼šæ–°æ¡†æ¶å–å¾—25%é‡‡ç”¨ç‡ä»¤äººå°è±¡æ·±åˆ»\n\n### ä¼ä¸šé‡‡ç”¨æ¨¡å¼\n\n**å¤§è§„æ¨¡æ¶æ„å†³ç­–ï¼š**\n\n- ä¼ä¸šè¶Šæ¥è¶Šå¤šé‡‡ç”¨å¾®å‰ç«¯æ¶æ„å®ç°ç‹¬ç«‹å›¢é˜Ÿå¼€å‘ã€æŠ€æœ¯å¤šæ ·æ€§ã€å¯æ‰©å±•æ€§\n- Backend-for-Frontend(BFF)æ¨¡å¼ä¸ºå…¬å¸çº§æ¨èï¼Œä»¥èµ‹èƒ½å‰ç«¯å›¢é˜Ÿã€é™ä½APIå¤æ‚æ€§\n\n**æŠ€æœ¯åå¥½ï¼š**\n\n- æˆç†Ÿç”Ÿæ€ç³»ç»Ÿ(Reactã€Angular)\n- é•¿æœŸæ”¯æŒä¿è¯\n- å¹¿æ³›å·¥å…·å’Œæ–‡æ¡£\n- å¼ºå¤§ç¤¾åŒºæ”¯æŒ\n\n### æœªæ¥é¢„æµ‹(2025-2027)\n\n**çŸ­æœŸè¶‹åŠ¿ï¼š**\n\n- **å²›å±¿æ¶æ„ä¸»æµé‡‡ç”¨**ï¼šé¢„è®¡æˆä¸ºå†…å®¹å¯†é›†å‹ç½‘ç«™çš„æ ‡å‡†æ¨¡å¼\n- **AIå¢å¼ºå¼€å‘**ï¼š76%å¼€å‘è€…è®¡åˆ’ä½¿ç”¨AIå·¥å…·è¿›è¡Œä»£ç ç”Ÿæˆã€æ€§èƒ½ä¼˜åŒ–ã€è‡ªåŠ¨æµ‹è¯•\n- **WebAssemblyé›†æˆ**ï¼šç”¨äºé«˜æ€§èƒ½è®¡ç®—ã€é—ç•™ç³»ç»Ÿé›†æˆ\n\n**ä¸­æœŸæ¼”è¿›ï¼š**\n\n- **è¾¹ç¼˜è®¡ç®—é›†æˆ**ï¼šå‰ç«¯æ¶æ„å°†æ›´å¤šåˆ©ç”¨è¾¹ç¼˜è®¡ç®—å®ç°å‡å°‘å»¶è¿Ÿã€è¾¹ç¼˜æœåŠ¡å™¨ç«¯æ¸²æŸ“\n- **ç»„ä»¶æµå¼ä¼ è¾“**ï¼šä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„ç»†ç²’åº¦ç»„ä»¶æµå¼ä¼ è¾“æ¼”è¿›\n\n## å®æ–½å»ºè®®ä¸æœ€ä½³å®è·µ\n\n### æ¶æ„é€‰æ‹©å†³ç­–æ¡†æ¶\n\n| ä½¿ç”¨åœºæ™¯       | æ¨èæ¡†æ¶        | å¤‡é€‰æ–¹æ¡ˆ     |\n| -------------- | --------------- | ------------ |\n| å†…å®¹å¯†é›†å‹ç½‘ç«™ | Astro           | Next.js SSG  |\n| ç”µå•†å¹³å°       | Next.js         | SvelteKit    |\n| è¥é”€ç½‘ç«™       | Astro           | SvelteKit    |\n| æ–‡æ¡£ç«™ç‚¹       | Astro           | Next.js      |\n| ç®¡ç†é¢æ¿       | Next.js SPAæ¨¡å¼ | Remix        |\n| åšå®¢           | Astro           | Next.js      |\n| ä¼ä¸šåº”ç”¨       | Next.js         | Remix        |\n| æ€§èƒ½å…³é”®åº”ç”¨   | SvelteKit       | Astro        |\n| è¾¹ç¼˜è®¡ç®—       | Fresh           | Next.js Edge |\n\n### è¿ç§»ç­–ç•¥\n\n**SPAåˆ°MPAè¿ç§»æ–¹æ³•ï¼š**\n\n1. **è¯„ä¼°é˜¶æ®µ**ï¼šåˆ†æå½“å‰SPAç»“æ„ï¼Œè¯†åˆ«é™æ€é¡µé¢ã€åŠ¨æ€é¡µé¢ã€äº¤äº’éƒ¨åˆ†\n2. **å¢é‡è¿ç§»**ï¼šä»é™æ€é¡µé¢å¼€å§‹ï¼Œè¿ç§»å†…å®¹å¯†é›†å‹éƒ¨åˆ†ï¼Œä¿æŒé«˜äº¤äº’éƒ¨åˆ†ä¸ºSPAå²›å±¿\n3. **ä¼˜åŒ–é˜¶æ®µ**ï¼šå®ç°æ¸è¿›å¼æ°´åˆã€ä¼˜åŒ–å…³é”®æ¸²æŸ“è·¯å¾„ã€æ·»åŠ æ€§èƒ½ç›‘æ§\n\n### æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ\n\n**Core Web Vitalsä¼˜åŒ–ï¼š**\n\n- **æœ€å¤§å†…å®¹ç»˜åˆ¶(LCP)**ï¼šä½¿ç”¨é€‚å½“æ¸²æŸ“ç­–ç•¥(SSG > SSR > CSR)ã€ä¼˜åŒ–å›¾ç‰‡ã€å®ç°èµ„æºä¼˜å…ˆçº§\n- **é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ(FID)**ï¼šæ¸è¿›å¼æ°´åˆç­–ç•¥ã€ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½\n- **ç´¯ç§¯å¸ƒå±€åç§»(CLS)**ï¼šä¸ºåŠ¨æ€å†…å®¹é¢„ç•™ç©ºé—´ã€ä½¿ç”¨éª¨æ¶å±\n\n### æ¡†æ¶ç‰¹å®šä¼˜åŒ–\n\n**Next.jsä¼˜åŒ–ï¼š**\n\n```javascript\n// å›¾ç‰‡ä¼˜åŒ–\nimport Image from 'next/image';\n\n// è·¯ç”±é¢„å–\nimport Link from 'next/link';\n<Link href=\"/blog\" prefetch={true}>\n\n// åŠ¨æ€å¯¼å…¥\nconst DynamicComponent = dynamic(() => import('../components/Heavy'));\n```\n\n**Astroä¼˜åŒ–ï¼š**\n\n```javascript\n// é€‰æ‹©æ€§æ°´åˆçš„ç»„ä»¶å²›å±¿\n<Counter client:visible />\n<SearchBox client:media=\"(max-width: 800px)\" />\n<Chart client:idle />\n```\n\n## ç»“è®ºä¸å±•æœ›\n\n2024-2025å¹´çš„å‰ç«¯æ¶æ„æ ¼å±€ä»¥æˆç†Ÿå’Œå®ç”¨ä¸»ä¹‰ä¸ºç‰¹å¾ï¼Œè€Œéé©å‘½æ€§å˜åŒ–ã€‚è¡Œä¸šæ­£åœ¨ä»\"JavaScriptä¼˜å…ˆ\"æ–¹æ³•è½¬å‘å¹³è¡¡è§£å†³æ–¹æ¡ˆï¼Œä¼˜å…ˆè€ƒè™‘æ€§èƒ½ã€å¼€å‘ä½“éªŒå’Œç”¨æˆ·éœ€æ±‚ã€‚å²›å±¿æ¶æ„ä»£è¡¨äº†æœ€é‡è¦çš„æ–°æ¨¡å¼ï¼Œä¸ºä¼ ç»ŸSPA/MPAäºŒåˆ†æ³•æä¾›äº†å¼•äººæ³¨ç›®çš„æ›¿ä»£æ–¹æ¡ˆã€‚\n\n**å…³é”®å»ºè®®ï¼š**\n\n1. **å¯¹äºä¼ä¸šå›¢é˜Ÿ**ï¼šè¯„ä¼°å²›å±¿æ¶æ„ç”¨äºå†…å®¹å¯†é›†å‹åº”ç”¨ï¼ŒæŠ•èµ„å…ƒæ¡†æ¶å‡å°‘å¤æ‚æ€§ï¼Œä¼˜å…ˆè€ƒè™‘æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–\n2. **å¯¹äºä¸ªäººå¼€å‘è€…**ï¼šå­¦ä¹ å²›å±¿æ¦‚å¿µå’Œæ¸è¿›å¢å¼ºï¼ŒæŒæ¡ç°ä»£æ„å»ºå·¥å…·å¦‚Viteï¼Œä¿æŒæ¡†æ¶æ— å…³çš„æ€ç»´\n3. **æŠ€æœ¯é€‰æ‹©å‡†åˆ™**ï¼šä¸è¦é€‰æ‹©å•ä¸€æ–¹æ³•ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªç‰¹å®šç”¨ä¾‹é€‰æ‹©æ­£ç¡®çš„æ¶æ„æ¨¡å¼\n\nå‰ç«¯æ¶æ„çš„æœªæ¥ä¸åœ¨äºé€‰æ‹©å•ä¸€æ–¹æ³•ï¼Œè€Œåœ¨äºä¸ºæ¯ä¸ªç‰¹å®šç”¨ä¾‹é€‰æ‹©åˆé€‚çš„æ¶æ„æ¨¡å¼ï¼Œå²›å±¿æ¶æ„ä¸ºå¼€å‘è€…å·¥å…·åŒ…æä¾›äº†å¼ºå¤§çš„æ–°é€‰æ‹©ã€‚è¿™ç§æ¶æ„æ¼”è¿›ä¸ºç»„ç»‡æä¾›äº†é‡‡ç”¨ç»è¿‡éªŒè¯çš„å…¨æ ˆæ¨¡å¼ã€é™ä½ä¾èµ–å¤æ‚æ€§ã€æ”¹å–„åº”ç”¨æ€§èƒ½ã€æŠ•èµ„é•¿æœŸWebæ ‡å‡†çŸ¥è¯†çš„æœºä¼šã€‚\n","tags":["React","å‰ç«¯å¼€å‘","SSR","MPA"],"categories":["ä»é¡¹ç›®åˆ°æŠ€æœ¯"]},{"title":"ã€ç§‹æ‹›å¤‡æˆ˜ã€‘ Object.defineProperty vs Proxy","url":"/2025/08/07/ã€ç§‹æ‹›å¤‡æˆ˜ã€‘å±æ€§åŠ«æŒ/","content":"\n>  å¦‚æœä½ æ›¾ç»å¥½å¥‡ Vue2 å’Œ Vue3 çš„å“åº”å¼åŸç†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæˆ–è€…åœ¨é¢è¯•ä¸­è¢«é—®åˆ°\"å¦‚ä½•å®ç°æ•°æ®åŠ«æŒ\"æ—¶ä¸€è„¸æ‡µé€¼ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œè¿™ç¯‡æ–‡ç« å°±æ˜¯ä½ çš„æ•‘æ˜Ÿï¼\n\n## ğŸ“– å¼€ç¯‡ï¼šä¸€ä¸ªå¯¹è±¡çš„è‡ªæˆ‘ä¿®å…»\n\nåœ¨ JavaScript çš„ä¸–ç•Œé‡Œï¼Œå¯¹è±¡å°±åƒæ˜¯ä¸€ä¸ªä¸ªå°ç›’å­ï¼Œæˆ‘ä»¬å¯ä»¥å¾€é‡Œé¢æ”¾ä¸œè¥¿ï¼ˆå±æ€§ï¼‰ï¼Œä¹Ÿå¯ä»¥å–ä¸œè¥¿ã€‚ä½†æ˜¯æœ‰ä¸€å¤©ï¼Œäº§å“ç»ç†çªç„¶è¯´ï¼š\"æˆ‘æƒ³çŸ¥é“ç”¨æˆ·ä»€ä¹ˆæ—¶å€™æ‰“å¼€ç›’å­ï¼Œä»€ä¹ˆæ—¶å€™å¾€é‡Œé¢æ”¾ä¸œè¥¿ï¼\"\n\nè¿™æ—¶å€™ï¼Œ`Object.defineProperty` å’Œ `Proxy` å°±é—ªäº®ç™»åœºäº†â€”â€”å®ƒä»¬å°±æ˜¯å¯¹è±¡ä¸–ç•Œçš„\"ç›‘æ§æ‘„åƒå¤´\"ã€‚\n\n## ğŸ­ ç¬¬ä¸€å¹•ï¼šObject.defineProperty - è€ç‰Œç‰¹å·¥\n\n### åŸºæœ¬æ¦‚å¿µ\n\n`Object.defineProperty()` æ˜¯ ES5 å¼•å…¥çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥ç²¾ç¡®åœ°å®šä¹‰æˆ–ä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶å±æ€§çš„è¡Œä¸ºã€‚å°±åƒç»™å¯¹è±¡çš„æŸä¸ªå±æ€§è£…ä¸Šäº†ä¸€ä¸ª\"æ™ºèƒ½é”\"ã€‚\n\n### åŸºç¡€è¯­æ³•\n\n```javascript\nObject.defineProperty(obj, prop, descriptor)\n```\n\n- `obj`ï¼šè¦å®šä¹‰å±æ€§çš„å¯¹è±¡\n- `prop`ï¼šè¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§å\n- `descriptor`ï¼šå±æ€§æè¿°ç¬¦å¯¹è±¡\n\n### å±æ€§æè¿°ç¬¦çš„ä¸¤ç§å½¢æ€\n\nå±æ€§æè¿°ç¬¦åˆ†ä¸ºä¸¤ç§ï¼š**æ•°æ®æè¿°ç¬¦**å’Œ**å­˜å–æè¿°ç¬¦**ï¼ˆä¸èƒ½åŒæ—¶ä½¿ç”¨ï¼‰ã€‚\n\n#### 1. æ•°æ®æè¿°ç¬¦\n\n```javascript\nconst person = {};\n\nObject.defineProperty(person, 'name', {\n  value: 'å¼ ä¸‰',           // å±æ€§å€¼\n  writable: true,         // æ˜¯å¦å¯å†™ï¼ˆé»˜è®¤ falseï¼‰\n  enumerable: true,       // æ˜¯å¦å¯æšä¸¾ï¼ˆé»˜è®¤ falseï¼‰\n  configurable: true      // æ˜¯å¦å¯é…ç½®ï¼ˆé»˜è®¤ falseï¼‰\n});\n\nconsole.log(person.name); // å¼ ä¸‰\nperson.name = 'æå››';      // å› ä¸º writable: trueï¼Œæ‰€ä»¥å¯ä»¥ä¿®æ”¹\nconsole.log(person.name); // æå››\n```\n\n#### 2. å­˜å–æè¿°ç¬¦ï¼ˆé‡ç‚¹ï¼ï¼‰\n\nè¿™å°±æ˜¯å®ç°\"æ•°æ®åŠ«æŒ\"çš„æ ¸å¿ƒï¼š\n\n```javascript\nlet internalValue = 'æˆ‘æ˜¯å†…éƒ¨å€¼';\nconst obj = {};\n\nObject.defineProperty(obj, 'magicProp', {\n  enumerable: true,\n  configurable: true,\n  get() {\n    console.log('ğŸ” æœ‰äººåœ¨è¯»å– magicPropï¼');\n    return internalValue;\n  },\n  set(newValue) {\n    console.log(`âœï¸ æœ‰äººåœ¨è®¾ç½® magicProp ä¸º: ${newValue}`);\n    internalValue = newValue;\n  }\n});\n\nobj.magicProp;           // ğŸ” æœ‰äººåœ¨è¯»å– magicPropï¼\nobj.magicProp = 'æ–°å€¼';   // âœï¸ æœ‰äººåœ¨è®¾ç½® magicProp ä¸º: æ–°å€¼\n```\n\n### å®æˆ˜æ¡ˆä¾‹ï¼šç®€æ˜“ç‰ˆ Vue2 å“åº”å¼\n\n```javascript\n// æ¨¡æ‹Ÿ Vue2 çš„å“åº”å¼åŸç†\nfunction observe(obj) {\n  Object.keys(obj).forEach(key => {\n    let internalValue = obj[key];\n    \n    Object.defineProperty(obj, key, {\n      get() {\n        console.log(`ğŸ“Š æ”¶é›†ä¾èµ–: ${key}`);\n        return internalValue;\n      },\n      set(newValue) {\n        console.log(`ğŸ”„ è§¦å‘æ›´æ–°: ${key} = ${newValue}`);\n        internalValue = newValue;\n        // è¿™é‡Œå¯ä»¥è§¦å‘è§†å›¾æ›´æ–°\n      }\n    });\n  });\n}\n\nconst data = { count: 0, message: 'Hello' };\nobserve(data);\n\ndata.count;        // ğŸ“Š æ”¶é›†ä¾èµ–: count\ndata.count = 1;    // ğŸ”„ è§¦å‘æ›´æ–°: count = 1\n```\n\n### Object.defineProperty çš„å±€é™æ€§\n\n1. **æ— æ³•ç›‘å¬æ•°ç»„ç´¢å¼•çš„å˜åŒ–**\n\n```javascript\nconst arr = [1, 2, 3];\nobserve(arr);\narr[0] = 999;  // æ— æ³•è§¦å‘ setter\narr.push(4);   // æ— æ³•ç›‘å¬\n```\n\n1. **å¿…é¡»éå†å¯¹è±¡çš„æ¯ä¸ªå±æ€§**\n\n```javascript\n// å¦‚æœæœ‰åµŒå¥—å¯¹è±¡ï¼Œéœ€è¦é€’å½’å¤„ç†\nconst complexObj = {\n  user: {\n    name: 'å¼ ä¸‰',\n    address: {\n      city: 'åŒ—äº¬'\n    }\n  }\n};\n// éœ€è¦é€’å½’éå†æ‰€æœ‰å±‚çº§\n```\n\n1. **æ— æ³•ç›‘å¬æ–°å¢å±æ€§**\n\n```javascript\nconst obj = { a: 1 };\nobserve(obj);\nobj.b = 2;  // æ–°å¢å±æ€§ b ä¸ä¼šè¢«ç›‘å¬\n```\n\n## ğŸ¦¸ ç¬¬äºŒå¹•ï¼šProxy - æ–°æ—¶ä»£çš„å…¨èƒ½ç®¡å®¶\n\n### åŸºæœ¬æ¦‚å¿µ\n\n`Proxy` æ˜¯ ES6 å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œå®ƒå¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°å¯¹è¿™ä¸ªå¯¹è±¡çš„åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰ã€‚å¦‚æœè¯´ `Object.defineProperty` æ˜¯ç»™å±æ€§è£…ç›‘æ§ï¼Œé‚£ `Proxy` å°±æ˜¯ç»™æ•´ä¸ªå¯¹è±¡é…äº†ä¸€ä¸ªå…¨èƒ½ç®¡å®¶ã€‚\n\n### åŸºç¡€è¯­æ³•\n\n```javascript\nconst proxy = new Proxy(target, handler)\n```\n\n- `target`ï¼šè¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡\n- `handler`ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œå®šä¹‰äº†å„ç§æ‹¦æˆªè¡Œä¸º\n\n### 13 ç§æ‹¦æˆªæ–¹æ³•\n\nProxy æ”¯æŒæ‹¦æˆª 13 ç§æ“ä½œï¼Œå¸¸ç”¨çš„æœ‰ï¼š\n\n```javascript\nconst handler = {\n  get(target, property, receiver) {},      // è¯»å–å±æ€§\n  set(target, property, value, receiver) {}, // è®¾ç½®å±æ€§\n  has(target, property) {},                // in æ“ä½œç¬¦\n  deleteProperty(target, property) {},     // delete æ“ä½œ\n  ownKeys(target) {},                      // Object.keys()\n  // ... è¿˜æœ‰å…¶ä»–æ‹¦æˆªæ–¹æ³•\n};\n```\n\n### åŸºç¡€ç¤ºä¾‹\n\n```javascript\nconst person = {\n  name: 'å¼ ä¸‰',\n  age: 25\n};\n\nconst personProxy = new Proxy(person, {\n  get(target, property) {\n    console.log(`ğŸ” æ­£åœ¨è®¿é—®å±æ€§: ${property}`);\n    return target[property];\n  },\n  set(target, property, value) {\n    console.log(`âœï¸ æ­£åœ¨è®¾ç½®å±æ€§: ${property} = ${value}`);\n    target[property] = value;\n    return true;  // è¡¨ç¤ºè®¾ç½®æˆåŠŸ\n  }\n});\n\npersonProxy.name;           // ğŸ” æ­£åœ¨è®¿é—®å±æ€§: name\npersonProxy.age = 26;       // âœï¸ æ­£åœ¨è®¾ç½®å±æ€§: age = 26\npersonProxy.hobby = 'ç¼–ç¨‹';  // âœï¸ æ­£åœ¨è®¾ç½®å±æ€§: hobby = ç¼–ç¨‹ï¼ˆæ–°å±æ€§ä¹Ÿèƒ½ç›‘å¬ï¼ï¼‰\n```\n\n### é«˜çº§åº”ç”¨ï¼šæ•°ç»„çš„å®Œç¾ç›‘å¬\n\n```javascript\nconst arr = [1, 2, 3];\nconst arrProxy = new Proxy(arr, {\n  get(target, property) {\n    console.log(`è®¿é—®æ•°ç»„: arr[${property}]`);\n    return target[property];\n  },\n  set(target, property, value) {\n    console.log(`ä¿®æ”¹æ•°ç»„: arr[${property}] = ${value}`);\n    target[property] = value;\n    return true;\n  }\n});\n\narrProxy[0] = 999;    // ä¿®æ”¹æ•°ç»„: arr[0] = 999\narrProxy.push(4);     // è®¿é—®æ•°ç»„: arr[push]\n                      // è®¿é—®æ•°ç»„: arr[length]\n                      // ä¿®æ”¹æ•°ç»„: arr[3] = 4\n                      // ä¿®æ”¹æ•°ç»„: arr[length] = 4\n```\n\n### å®æˆ˜æ¡ˆä¾‹ï¼šå®ç°ä¸€ä¸ªæ™ºèƒ½å¯¹è±¡\n\n```javascript\n// åˆ›å»ºä¸€ä¸ª\"æ™ºèƒ½\"å¯¹è±¡ï¼Œè‡ªåŠ¨éªŒè¯å’Œè½¬æ¢æ•°æ®\nconst smartObj = new Proxy({}, {\n  set(target, property, value) {\n    // è‡ªåŠ¨ç±»å‹è½¬æ¢\n    if (property === 'age') {\n      value = Number(value);\n      if (isNaN(value) || value < 0 || value > 150) {\n        throw new Error('å¹´é¾„å¿…é¡»æ˜¯ 0-150 ä¹‹é—´çš„æ•°å­—');\n      }\n    }\n    \n    // è‡ªåŠ¨æ ¼å¼åŒ–\n    if (property === 'phone') {\n      value = value.replace(/[^0-9]/g, '');\n      if (value.length !== 11) {\n        throw new Error('æ‰‹æœºå·å¿…é¡»æ˜¯ 11 ä½');\n      }\n    }\n    \n    console.log(`âœ… è®¾ç½® ${property} = ${value}`);\n    target[property] = value;\n    return true;\n  }\n});\n\nsmartObj.age = '25';        // âœ… è®¾ç½® age = 25ï¼ˆè‡ªåŠ¨è½¬æ•°å­—ï¼‰\nsmartObj.phone = '138-0000-0000'; // âœ… è®¾ç½® phone = 13800000000ï¼ˆè‡ªåŠ¨æ ¼å¼åŒ–ï¼‰\n// smartObj.age = 'ä¸€ç™¾å²';  // æŠ›å‡ºé”™è¯¯ï¼\n```\n\n## âš”ï¸ ç»ˆæå¯¹å†³ï¼šObject.defineProperty vs Proxy\n\n| ç‰¹æ€§         | Object.defineProperty  | Proxy                  |\n| ------------ | ---------------------- | ---------------------- |\n| å…¼å®¹æ€§       | ES5ï¼Œå…¼å®¹ IE9+         | ES6ï¼Œä¸æ”¯æŒ IE         |\n| ç›‘å¬èŒƒå›´     | å•ä¸ªå±æ€§               | æ•´ä¸ªå¯¹è±¡               |\n| ç›‘å¬æ•°ç»„ç´¢å¼• | âŒ ä¸æ”¯æŒ               | âœ… æ”¯æŒ                 |\n| ç›‘å¬æ–°å¢å±æ€§ | âŒ éœ€è¦é¢å¤–å¤„ç†         | âœ… è‡ªåŠ¨æ”¯æŒ             |\n| ç›‘å¬åˆ é™¤å±æ€§ | âŒ ä¸æ”¯æŒ               | âœ… æ”¯æŒ                 |\n| æ€§èƒ½         | éœ€è¦é€’å½’éå†ï¼Œåˆå§‹åŒ–æ…¢ | æ‡’å¤„ç†ï¼ŒæŒ‰éœ€æ‹¦æˆª       |\n| æ“ä½œåŸå¯¹è±¡   | ç›´æ¥ä¿®æ”¹åŸå¯¹è±¡         | ä¸ä¿®æ”¹åŸå¯¹è±¡ï¼Œè¿”å›ä»£ç† |\n\n## ğŸ¯ é¢è¯•é«˜é¢‘è€ƒç‚¹\n\n### 1. Vue2 vs Vue3 å“åº”å¼åŸç†\n\n```javascript\n// Vue2 é£æ ¼ï¼ˆç®€åŒ–ç‰ˆï¼‰\nfunction reactive2(obj) {\n  Object.keys(obj).forEach(key => {\n    let value = obj[key];\n    Object.defineProperty(obj, key, {\n      get() {\n        // ä¾èµ–æ”¶é›†\n        return value;\n      },\n      set(newValue) {\n        value = newValue;\n        // è§¦å‘æ›´æ–°\n      }\n    });\n  });\n  return obj;\n}\n\n// Vue3 é£æ ¼ï¼ˆç®€åŒ–ç‰ˆï¼‰\nfunction reactive3(obj) {\n  return new Proxy(obj, {\n    get(target, key) {\n      // ä¾èµ–æ”¶é›†\n      return target[key];\n    },\n    set(target, key, value) {\n      target[key] = value;\n      // è§¦å‘æ›´æ–°\n      return true;\n    }\n  });\n}\n```\n\n### 2. å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„è§‚å¯Ÿè€…æ¨¡å¼ï¼Ÿ\n\n```javascript\nclass Observer {\n  constructor(data) {\n    this.data = data;\n    this.callbacks = {};\n    this.observe();\n  }\n  \n  observe() {\n    const that = this;\n    this.proxy = new Proxy(this.data, {\n      set(target, property, value) {\n        target[property] = value;\n        // è§¦å‘å›è°ƒ\n        if (that.callbacks[property]) {\n          that.callbacks[property].forEach(cb => cb(value));\n        }\n        return true;\n      }\n    });\n    return this.proxy;\n  }\n  \n  subscribe(property, callback) {\n    if (!this.callbacks[property]) {\n      this.callbacks[property] = [];\n    }\n    this.callbacks[property].push(callback);\n  }\n}\n\n// ä½¿ç”¨\nconst obs = new Observer({ count: 0 });\nconst data = obs.observe();\n\nobs.subscribe('count', (value) => {\n  console.log(`count å˜åŒ–äº†: ${value}`);\n});\n\ndata.count = 1;  // count å˜åŒ–äº†: 1\n```\n\n## ğŸš€ æ€»ç»“ï¼šé€‰æ‹©çš„æ™ºæ…§\n\n- **ä½¿ç”¨ Object.defineProperty çš„åœºæ™¯**ï¼š\n  - éœ€è¦å…¼å®¹æ—§æµè§ˆå™¨ï¼ˆIE9+ï¼‰\n  - åªéœ€è¦ç›‘å¬å·²çŸ¥çš„ã€å›ºå®šçš„å±æ€§\n  - é¡¹ç›®å·²ç»å¤§é‡ä½¿ç”¨ä¸”ç¨³å®šè¿è¡Œ\n- **ä½¿ç”¨ Proxy çš„åœºæ™¯**ï¼š\n  - ä¸éœ€è¦è€ƒè™‘ IE å…¼å®¹æ€§\n  - éœ€è¦ç›‘å¬æ•°ç»„å˜åŒ–\n  - éœ€è¦ç›‘å¬åŠ¨æ€æ–°å¢çš„å±æ€§\n  - éœ€è¦å®ç°æ›´å¤æ‚çš„æ‹¦æˆªé€»è¾‘\n  - æ–°é¡¹ç›®ä¼˜å…ˆé€‰æ‹©\n\n## ğŸ’¡ æœ€åçš„å°è´´å£«\n\nè®°ä½è¿™ä¸ªå£è¯€ï¼š\n\n- **defineProperty æ˜¯ä¿å®‰**ï¼šåªèƒ½çœ‹ç€æŒ‡å®šçš„å‡ ä¸ªé—¨ï¼ˆå±æ€§ï¼‰\n- **Proxy æ˜¯ç®¡å®¶**ï¼šæ•´ä¸ªæˆ¿å­ï¼ˆå¯¹è±¡ï¼‰çš„äº‹éƒ½ç®¡\n\né¢è¯•æ—¶å¦‚æœè¢«é—®åˆ°ï¼Œè®°å¾—æåˆ°ï¼š\n\n1. ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«ï¼ˆå±æ€§çº§ vs å¯¹è±¡çº§ï¼‰\n2. Vue2 åˆ° Vue3 çš„å‡çº§åŸå› \n3. å„è‡ªçš„ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯\n\nç°åœ¨ï¼Œä½ å·²ç»æŒæ¡äº† JavaScript ä¸­ä¸¤ä¸ªæœ€å¼ºå¤§çš„\"å¯¹è±¡ç›‘æ§\"æŠ€æœ¯ã€‚ä¸‹æ¬¡é¢è¯•å®˜é—®ä½ \"å¦‚ä½•å®ç°æ•°æ®åŒå‘ç»‘å®š\"æ—¶ï¼Œä½ å¯ä»¥è‡ªä¿¡åœ°è¯´ï¼š\"è¿™é¢˜æˆ‘ä¼šï¼Œè€Œä¸”æˆ‘è¿˜èƒ½å‘Šè¯‰ä½ ä¸¤ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹ï¼\"\n\n------\n\n*Happy Coding! æ„¿ä½ çš„ç§‹æ‹›ä¹‹è·¯ä¸€å¸†é£é¡ºï¼* ğŸ‰\n","tags":["ç§‹æ‹›","ES","å…«è‚¡"],"categories":["ç§‹æ‹›å‡†å¤‡"]},{"title":"ã€ç§‹æ‹›å¤‡æˆ˜ã€‘JavaScript é›†åˆç±»å‹æ·±åº¦è§£æ","url":"/2025/08/05/ã€ç§‹æ‹›å¤‡æˆ˜ã€‘JavaScript é›†åˆç±»å‹æ·±åº¦è§£æ/","content":"\nåœ¨ JavaScript çš„ä¸–ç•Œé‡Œï¼Œé™¤äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„å¯¹è±¡ï¼ˆObjectï¼‰å’Œæ•°ç»„ï¼ˆArrayï¼‰ï¼ŒES6 è¿˜å¼•å…¥äº†å››ç§æ–°çš„é›†åˆç±»å‹ï¼šMapã€Setã€WeakMap å’Œ WeakSetã€‚è¿™äº›æ•°æ®ç»“æ„ä¸ä»…ä¸°å¯Œäº†æˆ‘ä»¬çš„å·¥å…·ç®±ï¼Œæ›´æ˜¯åœ¨ç°ä»£å‰ç«¯æ¡†æ¶çš„åº•å±‚å®ç°ä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚ä»Šå¤©ï¼Œè®©æˆ‘ä»¬æ·±å…¥æ¢è®¨è¿™äº›é›†åˆç±»å‹çš„ç‰¹æ€§ã€ä½¿ç”¨åœºæ™¯ï¼Œä»¥åŠå®ƒä»¬åœ¨ React å’Œ Vue æºç ä¸­çš„ç²¾å¦™åº”ç”¨ã€‚\n\n## ä¸€ã€Mapï¼šæ›´å¼ºå¤§çš„é”®å€¼å¯¹é›†åˆ\n\n### åŸºæœ¬æ¦‚å¿µ\n\nMap æ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„é›†åˆï¼Œä¸æ™®é€šå¯¹è±¡æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼š**Map çš„é”®å¯ä»¥æ˜¯ä»»æ„ç±»å‹**ï¼Œè€Œä¸ä»…ä»…æ˜¯å­—ç¬¦ä¸²æˆ– Symbolã€‚\n\n```javascript\nconst map = new Map();\n\n// åŸºæœ¬ç”¨æ³•\nmap.set('name', 'JavaScript');\nmap.set(42, 'The Answer');\nmap.set(true, 'Boolean key');\n\n// å¯¹è±¡ä½œä¸ºé”®\nconst objKey = { id: 1 };\nmap.set(objKey, 'Object as key');\n\n// å‡½æ•°ä½œä¸ºé”®\nconst funcKey = () => {};\nmap.set(funcKey, 'Function as key');\n\nconsole.log(map.get(objKey)); // 'Object as key'\nconsole.log(map.size); // 5\n```\n\n### Map çš„æ ¸å¿ƒç‰¹æ€§\n\n1. **é”®çš„å”¯ä¸€æ€§**ï¼šMap ä¸­çš„é”®æ˜¯å”¯ä¸€çš„ï¼Œé‡å¤è®¾ç½®ä¼šè¦†ç›–ä¹‹å‰çš„å€¼\n2. **ä¿æŒæ’å…¥é¡ºåº**ï¼šMap ä¼šè®°ä½é”®å€¼å¯¹çš„æ’å…¥é¡ºåº\n3. **å¯è¿­ä»£**ï¼šMap å®ç°äº†è¿­ä»£å™¨åè®®\n\n```javascript\nconst map = new Map([\n  ['first', 1],\n  ['second', 2],\n  ['third', 3]\n]);\n\n// éå†æ–¹æ³•\nfor (const [key, value] of map) {\n  console.log(`${key}: ${value}`);\n}\n\n// è·å–æ‰€æœ‰é”®\nconsole.log([...map.keys()]); // ['first', 'second', 'third']\n\n// è·å–æ‰€æœ‰å€¼\nconsole.log([...map.values()]); // [1, 2, 3]\n\n// è·å–æ‰€æœ‰é”®å€¼å¯¹\nconsole.log([...map.entries()]); // [['first', 1], ['second', 2], ['third', 3]]\n```\n\n### Map vs Object çš„æ€§èƒ½å¯¹æ¯”\n\n```javascript\n// æ€§èƒ½æµ‹è¯•ï¼šé¢‘ç¹å¢åˆ æ“ä½œ\nconst testSize = 100000;\n\n// Object æµ‹è¯•\nconsole.time('Object');\nconst obj = {};\nfor (let i = 0; i < testSize; i++) {\n  obj[`key${i}`] = i;\n  delete obj[`key${i}`];\n}\nconsole.timeEnd('Object');\n\n// Map æµ‹è¯•\nconsole.time('Map');\nconst map = new Map();\nfor (let i = 0; i < testSize; i++) {\n  map.set(`key${i}`, i);\n  map.delete(`key${i}`);\n}\nconsole.timeEnd('Map');\n\n\n// Object: 40.439ms\n// Map: 15.457ms\n// Map åœ¨é¢‘ç¹å¢åˆ æ“ä½œæ—¶æ€§èƒ½æ›´ä¼˜\n```\n\n### å®é™…åº”ç”¨åœºæ™¯\n\n```javascript\n// ç¼“å­˜ç®¡ç†\nclass LRUCache {\n  constructor(capacity) {\n    this.capacity = capacity;\n    this.cache = new Map();\n  }\n\n  get(key) {\n    if (!this.cache.has(key)) return -1;\n    \n    // å°†è®¿é—®çš„å…ƒç´ ç§»åˆ°æœ€åï¼ˆæœ€æ–°ï¼‰\n    const value = this.cache.get(key);\n    this.cache.delete(key);\n    this.cache.set(key, value);\n    return value;\n  }\n\n  put(key, value) {\n    if (this.cache.has(key)) {\n      this.cache.delete(key);\n    }\n    \n    this.cache.set(key, value);\n    \n    // è¶…å‡ºå®¹é‡ï¼Œåˆ é™¤æœ€æ—§çš„ï¼ˆç¬¬ä¸€ä¸ªï¼‰\n    if (this.cache.size > this.capacity) {\n      const firstKey = this.cache.keys().next().value;\n      this.cache.delete(firstKey);\n    }\n  }\n}\n```\n\n## äºŒã€Setï¼šç‹¬ç‰¹å€¼çš„é›†åˆ\n\n### åŸºæœ¬æ¦‚å¿µ\n\nSet æ˜¯ä¸€ä¸ªå€¼çš„é›†åˆï¼Œå…¶ä¸­æ¯ä¸ªå€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¸ä¼šé‡å¤ã€‚\n\n```javascript\nconst set = new Set();\n\n// æ·»åŠ å€¼\nset.add(1);\nset.add(2);\nset.add(2); // é‡å¤å€¼ä¸ä¼šè¢«æ·»åŠ \nset.add('2'); // å­—ç¬¦ä¸²'2'å’Œæ•°å­—2æ˜¯ä¸åŒçš„\n\nconsole.log(set.size); // 3\nconsole.log(set.has(2)); // true\n\n// æ•°ç»„å»é‡\nconst numbers = [1, 2, 2, 3, 4, 4, 5];\nconst uniqueNumbers = [...new Set(numbers)];\nconsole.log(uniqueNumbers); // [1, 2, 3, 4, 5]\n```\n\n### Set çš„é«˜çº§åº”ç”¨\n\n```javascript\n// 1. æ•°ç»„æ“ä½œ\nconst setA = new Set([1, 2, 3, 4]);\nconst setB = new Set([3, 4, 5, 6]);\n\n// å¹¶é›†\nconst union = new Set([...setA, ...setB]);\nconsole.log([...union]); // [1, 2, 3, 4, 5, 6]\n\n// äº¤é›†\nconst intersection = new Set([...setA].filter(x => setB.has(x)));\nconsole.log([...intersection]); // [3, 4]\n\n// å·®é›†\nconst difference = new Set([...setA].filter(x => !setB.has(x)));\nconsole.log([...difference]); // [1, 2]\n\n// 2. å¯¹è±¡å»é‡\nconst users = [\n  { id: 1, name: 'Alice' },\n  { id: 2, name: 'Bob' },\n  { id: 1, name: 'Alice' },\n  { id: 3, name: 'Charlie' }\n];\n\nconst uniqueUsers = Array.from(\n  new Map(users.map(user => [user.id, user])).values()\n);\nconsole.log(uniqueUsers); // å»é‡åçš„ç”¨æˆ·æ•°ç»„\n```\n\n### æ€§èƒ½ä¼˜åŠ¿\n\n```javascript\n// Set çš„ has æ–¹æ³•æ€§èƒ½æµ‹è¯•\nconst arr = Array.from({ length: 10000 }, (_, i) => i);\nconst set = new Set(arr);\n\nconsole.time('Array includes');\nfor (let i = 0; i < 1000; i++) {\n  arr.includes(9999);\n}\nconsole.timeEnd('Array includes');\n\nconsole.time('Set has');\nfor (let i = 0; i < 1000; i++) {\n  set.has(9999);\n}\nconsole.timeEnd('Set has');\n\n// Set.has() çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)ï¼Œè€Œ Array.includes() æ˜¯ O(n)\n```\n\n## ä¸‰ã€WeakMapï¼šå¼±å¼•ç”¨çš„é”®å€¼å¯¹é›†åˆ\n\n### æ ¸å¿ƒç‰¹æ€§\n\nWeakMap ä¸ Map ç±»ä¼¼ï¼Œä½†æœ‰å‡ ä¸ªå…³é”®åŒºåˆ«ï¼š\n\n1. **é”®å¿…é¡»æ˜¯å¯¹è±¡**ï¼ˆä¸èƒ½æ˜¯åŸå§‹å€¼ï¼‰\n2. **é”®æ˜¯å¼±å¼•ç”¨çš„**ï¼Œä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶\n3. **ä¸å¯è¿­ä»£**ï¼Œæ²¡æœ‰ size å±æ€§\n\n```javascript\nconst wm = new WeakMap();\n\n// åªèƒ½ä½¿ç”¨å¯¹è±¡ä½œä¸ºé”®\nconst obj1 = { name: 'object1' };\nconst obj2 = { name: 'object2' };\n\nwm.set(obj1, 'value1');\nwm.set(obj2, 'value2');\n\nconsole.log(wm.get(obj1)); // 'value1'\n\n// ä¸èƒ½ä½¿ç”¨åŸå§‹å€¼ä½œä¸ºé”®\n// wm.set('string', 'value'); // TypeError\n\n// å¼±å¼•ç”¨ç‰¹æ€§\nlet obj3 = { name: 'object3' };\nwm.set(obj3, 'value3');\nobj3 = null; // obj3 å¯ä»¥è¢«åƒåœ¾å›æ”¶ï¼Œå¯¹åº”çš„ WeakMap æ¡ç›®ä¹Ÿä¼šè¢«æ¸…é™¤\n```\n\n### WeakMap çš„å®é™…åº”ç”¨\n\n```javascript\n// 1. ç§æœ‰å±æ€§å®ç°\nconst privateData = new WeakMap();\n\nclass Person {\n  constructor(name, age) {\n    privateData.set(this, { name, age });\n  }\n\n  getName() {\n    return privateData.get(this).name;\n  }\n\n  getAge() {\n    return privateData.get(this).age;\n  }\n}\n\nconst person = new Person('Alice', 30);\nconsole.log(person.getName()); // 'Alice'\nconsole.log(person.name); // undefined\n\n// 2. DOM å…ƒç´ å…³è”æ•°æ®\nconst elementData = new WeakMap();\n\nfunction attachData(element, data) {\n  elementData.set(element, data);\n}\n\nfunction getData(element) {\n  return elementData.get(element);\n}\n\n// ä½¿ç”¨\nconst button = document.querySelector('#myButton');\nattachData(button, { clickCount: 0 });\n\nbutton.addEventListener('click', () => {\n  const data = getData(button);\n  data.clickCount++;\n  console.log(`Clicked ${data.clickCount} times`);\n});\n```\n\n### å†…å­˜ç®¡ç†ä¼˜åŠ¿\n\n```javascript\n// ä½¿ç”¨ Map å¯èƒ½é€ æˆå†…å­˜æ³„æ¼\nconst cache = new Map();\n\nfunction processData(obj) {\n  if (cache.has(obj)) {\n    return cache.get(obj);\n  }\n  \n  const result = expensiveOperation(obj);\n  cache.set(obj, result); // obj è¢« Map å¼•ç”¨ï¼Œæ— æ³•è¢«åƒåœ¾å›æ”¶\n  return result;\n}\n\n// ä½¿ç”¨ WeakMap é¿å…å†…å­˜æ³„æ¼\nconst weakCache = new WeakMap();\n\nfunction processDataSafe(obj) {\n  if (weakCache.has(obj)) {\n    return weakCache.get(obj);\n  }\n  \n  const result = expensiveOperation(obj);\n  weakCache.set(obj, result); // obj å¯ä»¥è¢«æ­£å¸¸åƒåœ¾å›æ”¶\n  return result;\n}\n```\n\n## å››ã€WeakSetï¼šå¼±å¼•ç”¨çš„å€¼é›†åˆ\n\n### åŸºæœ¬ç‰¹æ€§\n\nWeakSet ä¸ Set ç±»ä¼¼ï¼Œä½†å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n\n1. **åªèƒ½å­˜å‚¨å¯¹è±¡**\n2. **å¯¹è±¡æ˜¯å¼±å¼•ç”¨çš„**\n3. **ä¸å¯è¿­ä»£**\n\n```javascript\nconst ws = new WeakSet();\n\nconst obj1 = { id: 1 };\nconst obj2 = { id: 2 };\n\nws.add(obj1);\nws.add(obj2);\n\nconsole.log(ws.has(obj1)); // true\n\n// ä¸èƒ½æ·»åŠ åŸå§‹å€¼\n// ws.add(1); // TypeError\n\n// é˜²æ­¢é‡å¤æ·»åŠ \nws.add(obj1); // ä¸ä¼šæŠ¥é”™ï¼Œä½†ä¹Ÿä¸ä¼šé‡å¤æ·»åŠ \n```\n\n### å®é™…åº”ç”¨åœºæ™¯\n\n```javascript\n// 1. æ ‡è®°å¯¹è±¡çŠ¶æ€\nconst disabledElements = new WeakSet();\n\nfunction disableElement(element) {\n  disabledElements.add(element);\n  element.classList.add('disabled');\n}\n\nfunction enableElement(element) {\n  disabledElements.delete(element);\n  element.classList.remove('disabled');\n}\n\nfunction isDisabled(element) {\n  return disabledElements.has(element);\n}\n\n// 2. é˜²æ­¢é€’å½’è°ƒç”¨\nconst processing = new WeakSet();\n\nfunction processObject(obj) {\n  if (processing.has(obj)) {\n    console.log('Already processing this object');\n    return;\n  }\n  \n  processing.add(obj);\n  \n  try {\n    // å¤„ç†å¯¹è±¡\n    console.log('Processing:', obj);\n    \n    // å¦‚æœå¯¹è±¡æœ‰å­å¯¹è±¡ï¼Œé€’å½’å¤„ç†\n    if (obj.children) {\n      obj.children.forEach(child => processObject(child));\n    }\n  } finally {\n    processing.delete(obj);\n  }\n}\n```\n\n## äº”ã€åœ¨ React ä¸­çš„åº”ç”¨\n\n### React Fiber ä¸­çš„ WeakMap ä½¿ç”¨\n\nReact çš„ Fiber æ¶æ„ä¸­ä½¿ç”¨ WeakMap æ¥å­˜å‚¨ç»„ä»¶ç›¸å…³çš„ä¿¡æ¯ï¼š\n\n```javascript\n// React æºç ç®€åŒ–ç¤ºä¾‹\nconst fiberNodeMap = new WeakMap();\n\nfunction createFiberNode(element) {\n  const fiber = {\n    type: element.type,\n    props: element.props,\n    // ... å…¶ä»– fiber å±æ€§\n  };\n  \n  // å°† DOM å…ƒç´ ä¸ Fiber èŠ‚ç‚¹å…³è”\n  if (element.dom) {\n    fiberNodeMap.set(element.dom, fiber);\n  }\n  \n  return fiber;\n}\n\nfunction getFiberFromDOM(domElement) {\n  return fiberNodeMap.get(domElement);\n}\n```\n\n### React Hooks ä¸­çš„ Map åº”ç”¨\n\n```javascript\n// React Hooks å®ç°åŸç†ç®€åŒ–\nlet currentComponent = null;\nconst hooksMap = new Map();\n\nfunction useState(initialState) {\n  const component = currentComponent;\n  \n  if (!hooksMap.has(component)) {\n    hooksMap.set(component, []);\n  }\n  \n  const hooks = hooksMap.get(component);\n  const hookIndex = hooks.length;\n  \n  if (hooks[hookIndex] === undefined) {\n    hooks[hookIndex] = {\n      state: initialState,\n      setState: (newState) => {\n        hooks[hookIndex].state = newState;\n        reRender(component);\n      }\n    };\n  }\n  \n  return [hooks[hookIndex].state, hooks[hookIndex].setState];\n}\n```\n\n## å…­ã€åœ¨ Vue ä¸­çš„åº”ç”¨\n\n### Vue 3 å“åº”å¼ç³»ç»Ÿä¸­çš„ WeakMap\n\nVue 3 çš„å“åº”å¼ç³»ç»Ÿå¤§é‡ä½¿ç”¨äº† WeakMap æ¥å­˜å‚¨ä¾èµ–å…³ç³»ï¼š\n\n```javascript\n// Vue 3 å“åº”å¼åŸç†ç®€åŒ–\nconst targetMap = new WeakMap();\n\nfunction track(target, key) {\n  let depsMap = targetMap.get(target);\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()));\n  }\n  \n  let dep = depsMap.get(key);\n  if (!dep) {\n    depsMap.set(key, (dep = new Set()));\n  }\n  \n  dep.add(activeEffect);\n}\n\nfunction trigger(target, key) {\n  const depsMap = targetMap.get(target);\n  if (!depsMap) return;\n  \n  const dep = depsMap.get(key);\n  if (!dep) return;\n  \n  dep.forEach(effect => effect());\n}\n\n// åˆ›å»ºå“åº”å¼å¯¹è±¡\nfunction reactive(target) {\n  return new Proxy(target, {\n    get(target, key, receiver) {\n      track(target, key);\n      return Reflect.get(target, key, receiver);\n    },\n    set(target, key, value, receiver) {\n      const result = Reflect.set(target, key, value, receiver);\n      trigger(target, key);\n      return result;\n    }\n  });\n}\n```\n\n### Vue ç»„ä»¶å®ä¾‹ç®¡ç†\n\n```javascript\n// Vue ç»„ä»¶å®ä¾‹ç¼“å­˜\nconst instanceMap = new WeakMap();\n\nclass VueComponent {\n  constructor(options) {\n    this.options = options;\n    \n    // å°†ç»„ä»¶å®ä¾‹ä¸å…¶ DOM å…ƒç´ å…³è”\n    if (options.el) {\n      instanceMap.set(options.el, this);\n    }\n  }\n  \n  static getInstance(element) {\n    return instanceMap.get(element);\n  }\n}\n\n// KeepAlive ç»„ä»¶çš„ç¼“å­˜å®ç°\nconst cache = new Map();\nconst keys = new Set();\n\nfunction pruneCache(keepAliveInstance, filter) {\n  cache.forEach((entry, key) => {\n    const name = getComponentName(entry.componentInstance);\n    if (name && !filter(name)) {\n      pruneCacheEntry(key);\n    }\n  });\n}\n\nfunction pruneCacheEntry(key) {\n  const cached = cache.get(key);\n  if (cached) {\n    cached.componentInstance.$destroy();\n  }\n  cache.delete(key);\n  keys.delete(key);\n}\n```\n\n## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ\n\n### é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„\n\n```javascript\n// åœºæ™¯1ï¼šéœ€è¦é¢‘ç¹æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨\n// âŒ ä¸æ¨èï¼šä½¿ç”¨æ•°ç»„\nconst permissions = ['read', 'write', 'delete'];\nif (permissions.includes('write')) { } // O(n)\n\n// âœ… æ¨èï¼šä½¿ç”¨ Set\nconst permissionSet = new Set(['read', 'write', 'delete']);\nif (permissionSet.has('write')) { } // O(1)\n\n// åœºæ™¯2ï¼šéœ€è¦å…³è” DOM å…ƒç´ å’Œæ•°æ®\n// âŒ ä¸æ¨èï¼šä½¿ç”¨ Mapï¼ˆå¯èƒ½é€ æˆå†…å­˜æ³„æ¼ï¼‰\nconst elementDataMap = new Map();\n\n// âœ… æ¨èï¼šä½¿ç”¨ WeakMap\nconst elementDataWeakMap = new WeakMap();\n\n// åœºæ™¯3ï¼šéœ€è¦æœ‰åºçš„é”®å€¼å¯¹\n// âœ… Map ä¿æŒæ’å…¥é¡ºåº\nconst orderedMap = new Map([\n  ['first', 1],\n  ['second', 2],\n  ['third', 3]\n]);\n```\n\n### å†…å­˜ç®¡ç†æ³¨æ„äº‹é¡¹\n\n```javascript\n// é¿å…å†…å­˜æ³„æ¼çš„æ¨¡å¼\nclass EventManager {\n  constructor() {\n    // ä½¿ç”¨ WeakMap å­˜å‚¨äº‹ä»¶ç›‘å¬å™¨\n    this.listeners = new WeakMap();\n  }\n  \n  addEventListener(element, event, handler) {\n    if (!this.listeners.has(element)) {\n      this.listeners.set(element, new Map());\n    }\n    \n    const elementListeners = this.listeners.get(element);\n    if (!elementListeners.has(event)) {\n      elementListeners.set(event, new Set());\n    }\n    \n    elementListeners.get(event).add(handler);\n    element.addEventListener(event, handler);\n  }\n  \n  removeEventListener(element, event, handler) {\n    const elementListeners = this.listeners.get(element);\n    if (!elementListeners) return;\n    \n    const eventHandlers = elementListeners.get(event);\n    if (!eventHandlers) return;\n    \n    eventHandlers.delete(handler);\n    element.removeEventListener(event, handler);\n    \n    // æ¸…ç†ç©ºçš„é›†åˆ\n    if (eventHandlers.size === 0) {\n      elementListeners.delete(event);\n    }\n    if (elementListeners.size === 0) {\n      this.listeners.delete(element);\n    }\n  }\n}\n```\n\n## å…«ã€æ€»ç»“ä¸å»ºè®®\n\n### ä½•æ—¶ä½¿ç”¨ Map/Set\n\n- **Map**ï¼šå½“ä½ éœ€è¦é”®å€¼å¯¹é›†åˆï¼Œä¸”é”®å¯èƒ½æ˜¯å¯¹è±¡æˆ–éœ€è¦ä¿æŒæ’å…¥é¡ºåºæ—¶\n- **Set**ï¼šå½“ä½ éœ€è¦å­˜å‚¨å”¯ä¸€å€¼ï¼Œæˆ–è¿›è¡Œé›†åˆè¿ç®—ï¼ˆå¹¶é›†ã€äº¤é›†ã€å·®é›†ï¼‰æ—¶\n\n### ä½•æ—¶ä½¿ç”¨ WeakMap/WeakSet\n\n- **WeakMap**ï¼šå½“ä½ éœ€è¦å°†æ•°æ®ä¸å¯¹è±¡å…³è”ï¼Œä¸”ä¸æƒ³é˜»æ­¢å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶\n- **WeakSet**ï¼šå½“ä½ éœ€è¦æ ‡è®°å¯¹è±¡ï¼Œæˆ–åˆ›å»ºå¯¹è±¡çš„å¼±å¼•ç”¨é›†åˆæ—¶\n\n### æ€§èƒ½è€ƒè™‘\n\n1. **æŸ¥æ‰¾æ€§èƒ½**ï¼šMap/Set çš„æŸ¥æ‰¾æ˜¯ O(1)ï¼Œè€Œæ•°ç»„æ˜¯ O(n)\n2. **å†…å­˜ç®¡ç†**ï¼šWeakMap/WeakSet æœ‰åŠ©äºé˜²æ­¢å†…å­˜æ³„æ¼\n3. **è¿­ä»£æ€§èƒ½**ï¼šMap/Set å¯ä»¥ç›´æ¥è¿­ä»£ï¼Œæ€§èƒ½ä¼˜äºå¯¹è±¡çš„ Object.keys()\n\nè¿™å››ç§é›†åˆç±»å‹æå¤§åœ°ä¸°å¯Œäº† JavaScript çš„æ•°æ®ç»“æ„é€‰æ‹©ï¼Œåˆç†ä½¿ç”¨å®ƒä»¬ä¸ä»…èƒ½è®©ä»£ç æ›´ç®€æ´ã€æ›´å…·è¡¨ç°åŠ›ï¼Œè¿˜èƒ½åœ¨æ€§èƒ½å’Œå†…å­˜ç®¡ç†æ–¹é¢å¸¦æ¥æ˜¾è‘—çš„æå‡ã€‚åœ¨ç°ä»£å‰ç«¯æ¡†æ¶çš„å¼€å‘ä¸­ï¼Œå®ƒä»¬æ›´æ˜¯ä¸å¯æˆ–ç¼ºçš„åŸºç¡€è®¾æ–½ã€‚\n","tags":["ç§‹æ‹›","ES"],"categories":["ç§‹æ‹›å‡†å¤‡"]},{"title":"Reactæ¸²æŸ“æ—¶æœºå®Œå…¨æŒ‡å—ï¼šä»ä¸€ä¸ªç”µå•†ç»„ä»¶çš„ä¼˜åŒ–è¯´èµ·","url":"/2025/07/24/ã€ä»é¡¹ç›®åˆ°æŠ€æœ¯ã€‘Reactæ¸²æŸ“æ—¶æœºæŒ‡å—/","content":"\n## å‰è¨€\n\nä½œä¸ºå‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨å’Œ React æ‰“äº¤é“ï¼Œä½†ä½ çœŸçš„äº†è§£ React çš„æ¸²æŸ“æ—¶æœºå—ï¼Ÿ\n\n- ä¸ºä»€ä¹ˆæœ‰æ—¶å€™è·å– DOM å…ƒç´ çš„é«˜åº¦æ˜¯ 0ï¼Ÿ\n- ä¸ºä»€ä¹ˆè®¾ç½®çš„åŠ¨ç”»æ•ˆæœæ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ\n- ä¸ºä»€ä¹ˆé¡µé¢ä¼šå‡ºç°é—ªçƒï¼Ÿ\n- useEffect å’Œ useLayoutEffect åˆ°åº•è¯¥ç”¨å“ªä¸ªï¼Ÿ\n- requestAnimationFrame åœ¨ React ä¸­æœ‰ä»€ä¹ˆç”¨ï¼Ÿ\n\nåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†é€šè¿‡ä¸€ä¸ªçœŸå®çš„ç”µå•†é¡¹ç›®æ¡ˆä¾‹å»ææ‡‚ React çš„æ¸²æŸ“æ—¶æœºã€‚\n\n## ä¸€ã€ä»ä¸€ä¸ªçœŸå®çš„ç”µå•†åœºæ™¯è¯´èµ·\n\n### 1.1 ä¸šåŠ¡èƒŒæ™¯\n\nåœ¨ç”µå•†é¡¹ç›®ä¸­ï¼Œå•†å“åˆ†ç±»ç­›é€‰æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§çš„åŠŸèƒ½ã€‚æƒ³è±¡ä¸€ä¸‹æ·˜å®æˆ–äº¬ä¸œçš„å•†å“åˆ—è¡¨é¡µï¼Œé¡¶éƒ¨é€šå¸¸ä¼šæœ‰è¿™æ ·çš„ç­›é€‰å™¨ï¼š\n\n```\næ‰‹æœºé€šè®¯ > æ‰‹æœº > åä¸º | å°ç±³ | OPPO | vivo | è‹¹æœ | ä¸‰æ˜Ÿ | è£è€€ | realme | ä¸€åŠ  | é­…æ—...\n```\n\nå½“åˆ†ç±»é¡¹ç‰¹åˆ«å¤šæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ï¼š\n\n- é»˜è®¤åªæ˜¾ç¤º 2 è¡Œï¼Œå¤šä½™çš„æŠ˜å èµ·æ¥\n- æä¾›å±•å¼€/æ”¶èµ·æŒ‰é’®\n- æ”¯æŒå¹³æ»‘çš„å±•å¼€/æ”¶èµ·åŠ¨ç”»\n- åˆ‡æ¢ä¸€çº§åˆ†ç±»æ—¶ï¼ŒäºŒçº§åˆ†ç±»éœ€è¦é‡ç½®\n\n### 1.2 ç»„ä»¶æ•ˆæœæ¼”ç¤º\n\n![ç±»ç›®ç­›é€‰æ¡†](/Applications/PersonalWork/website/Blog_simonicle/source/postImage/ã€ä»é¡¹ç›®åˆ°æŠ€æœ¯ã€‘Reactæ¸²æŸ“æ—¶æœºæŒ‡å—/category.png)\n\n![ç±»ç›®ç­›é€‰åŒº-å±•å¼€](/Applications/PersonalWork/website/Blog_simonicle/source/postImage/ã€ä»é¡¹ç›®åˆ°æŠ€æœ¯ã€‘Reactæ¸²æŸ“æ—¶æœºæŒ‡å—/category_expanded.png)\n\n(gifæ•ˆæœå¤ªå·®äº†ã€‚ã€‚ã€‚ã€‚)\n\n### 1.3 æ ¸å¿ƒæŠ€æœ¯æŒ‘æˆ˜\n\nçœ‹ä¼¼ç®€å•çš„éœ€æ±‚ï¼Œå®ç°èµ·æ¥å´é‡åˆ°äº†ä¸å°‘æŒ‘æˆ˜ï¼š\n\n1. **é«˜åº¦è®¡ç®—é—®é¢˜**ï¼šå¦‚ä½•å‡†ç¡®è·å–å†…å®¹çš„å®Œæ•´é«˜åº¦ï¼Ÿ\n2. **åŠ¨ç”»æµç•…æ€§**ï¼šå¦‚ä½•å®ç°å¹³æ»‘çš„é«˜åº¦è¿‡æ¸¡åŠ¨ç”»ï¼Ÿ\n3. **çŠ¶æ€åˆ‡æ¢é—®é¢˜**ï¼šåˆ‡æ¢åˆ†ç±»æ—¶å¦‚ä½•é¿å…ä¸å¿…è¦çš„åŠ¨ç”»ï¼Ÿ\n4. **å“åº”å¼é€‚é…**ï¼šå¦‚ä½•åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹ä¿æŒè‰¯å¥½ä½“éªŒï¼Ÿ\n\nè¿™äº›é—®é¢˜çš„æ ¸å¿ƒéƒ½æŒ‡å‘ä¸€ä¸ªå…³é”®ç‚¹ï¼š**æˆ‘ä»¬éœ€è¦åœ¨æ­£ç¡®çš„æ—¶æœºæ‰§è¡Œæ­£ç¡®çš„æ“ä½œ**ã€‚\n\n## äºŒã€React æ¸²æŸ“æœºåˆ¶æ·±åº¦è§£æ\n\n### 2.1 React çš„å·¥ä½œæµç¨‹\n\nåœ¨æ·±å…¥ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç†è§£ React çš„å®Œæ•´å·¥ä½œæµç¨‹ï¼š\n\n```mermaid\ngraph TB\n    A[ç”¨æˆ·äº¤äº’/Propså˜åŒ–] --> B[è§¦å‘çŠ¶æ€æ›´æ–°]\n    B --> C[React è°ƒåº¦æ›´æ–°]\n    C --> D[Render Phase<br/>æ¸²æŸ“é˜¶æ®µ]\n    D --> E[Reconciliation<br/>åè°ƒè¿‡ç¨‹]\n    E --> F[ç”Ÿæˆ Fiber æ ‘]\n    F --> G[Commit Phase<br/>æäº¤é˜¶æ®µ]\n    G --> H[æ›´æ–° DOM]\n    H --> I[æ‰§è¡Œ useLayoutEffect]\n    I --> J[æµè§ˆå™¨ç»˜åˆ¶]\n    J --> K[æ‰§è¡Œ useEffect]\n    K --> L[ç”¨æˆ·çœ‹åˆ°æ›´æ–°]\n    \n    style D fill:#f9f,stroke:#333,stroke-width:2px\n    style G fill:#9ff,stroke:#333,stroke-width:2px\n    style J fill:#ff9,stroke:#333,stroke-width:2px\n```\n\n### 2.2 ä¸‰ä¸ªå…³é”®é˜¶æ®µ\n\n#### é˜¶æ®µä¸€ï¼šRender Phaseï¼ˆæ¸²æŸ“é˜¶æ®µï¼‰\n\n- **ç‰¹ç‚¹**ï¼šå¯ä¸­æ–­ã€å¯æ¢å¤ã€å¯å¹¶å‘\n- **ä»»åŠ¡**ï¼šè°ƒç”¨ç»„ä»¶å‡½æ•°ï¼Œç”Ÿæˆæ–°çš„è™šæ‹Ÿ DOM æ ‘\n- **é™åˆ¶**ï¼šä¸èƒ½æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆside effectsï¼‰\n\n```javascript\n// è¿™ä¸ªé˜¶æ®µæ‰§è¡Œçš„ä»£ç \nfunction MyComponent({ data }) {\n  // âœ… çº¯è®¡ç®—\n  const processedData = useMemo(() => processData(data), [data]);\n  \n  // âŒ ä¸è¦åœ¨è¿™é‡Œæ‰§è¡Œå‰¯ä½œç”¨\n  // document.title = 'New Title'; // é”™è¯¯ï¼\n  \n  return <div>{processedData}</div>;\n}\n```\n\n#### é˜¶æ®µäºŒï¼šCommit Phaseï¼ˆæäº¤é˜¶æ®µï¼‰\n\n- **ç‰¹ç‚¹**ï¼šåŒæ­¥æ‰§è¡Œï¼Œä¸å¯ä¸­æ–­\n- **ä»»åŠ¡**ï¼šå°†å˜æ›´åº”ç”¨åˆ°çœŸå® DOM\n- **æ—¶æœº**ï¼šuseLayoutEffect åœ¨æ­¤é˜¶æ®µæ‰§è¡Œ\n\n```javascript\nfunction MyComponent() {\n  useLayoutEffect(() => {\n    // è¿™é‡Œ DOM å·²æ›´æ–°ï¼Œä½†æµè§ˆå™¨è¿˜æœªç»˜åˆ¶\n    // é€‚åˆè¿›è¡Œ DOM æµ‹é‡æˆ–ç´§æ€¥çš„æ ·å¼è°ƒæ•´\n    const height = ref.current.scrollHeight;\n    console.log('çœŸå®é«˜åº¦:', height);\n  });\n}\n```\n\n#### é˜¶æ®µä¸‰ï¼šBrowser Paintï¼ˆæµè§ˆå™¨ç»˜åˆ¶ï¼‰\n\n- **ç‰¹ç‚¹**ï¼šæµè§ˆå™¨çš„å·¥ä½œï¼ŒReact ä¸å‚ä¸\n- **ä»»åŠ¡**ï¼šè®¡ç®—å¸ƒå±€ã€ç»˜åˆ¶åƒç´ \n- **æ—¶æœº**ï¼šuseEffect åœ¨æ­¤ä¹‹åæ‰§è¡Œ\n\n### 2.3 æ—¶åºå¯¹æ¯”å›¾\n\nè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªè¯¦ç»†çš„æ—¶åºå›¾æ¥å¯¹æ¯”ä¸åŒ Hook çš„æ‰§è¡Œæ—¶æœºï¼š\n\n```mermaid\nsequenceDiagram\n    participant User as ç”¨æˆ·\n    participant React as React\n    participant DOM as DOM\n    participant Browser as æµè§ˆå™¨\n    participant Effect as useEffect\n    participant LayoutEffect as useLayoutEffect\n    \n    User->>React: ç‚¹å‡»æŒ‰é’®\n    React->>React: setState æ›´æ–°çŠ¶æ€\n    \n    rect rgb(255, 230, 230)\n        Note over React: Render Phase å¼€å§‹\n        React->>React: è°ƒç”¨ç»„ä»¶å‡½æ•°\n        React->>React: ç”Ÿæˆè™šæ‹Ÿ DOM\n        React->>React: Diff ç®—æ³•å¯¹æ¯”\n        Note over React: Render Phase ç»“æŸ\n    end\n    \n    rect rgb(230, 255, 230)\n        Note over React,DOM: Commit Phase å¼€å§‹\n        React->>DOM: æ›´æ–°çœŸå® DOM\n        DOM-->>React: DOM æ›´æ–°å®Œæˆ\n        React->>LayoutEffect: åŒæ­¥æ‰§è¡Œ useLayoutEffect\n        LayoutEffect-->>React: æ‰§è¡Œå®Œæˆ\n        Note over React,DOM: Commit Phase ç»“æŸ\n    end\n    \n    rect rgb(230, 230, 255)\n        Note over Browser: Paint Phase å¼€å§‹\n        DOM->>Browser: è§¦å‘é‡æ’/é‡ç»˜\n        Browser->>Browser: è®¡ç®—å¸ƒå±€\n        Browser->>Browser: ç»˜åˆ¶åƒç´ \n        Browser->>User: æ˜¾ç¤ºæ›´æ–°åçš„ç•Œé¢\n        Note over Browser: Paint Phase ç»“æŸ\n    end\n    \n    Browser->>Effect: å¼‚æ­¥æ‰§è¡Œ useEffect\n    Effect-->>React: æ‰§è¡Œå®Œæˆ\n```\n\n## ä¸‰ã€ä»£ç å®æˆ˜ï¼šå‰–ææŠ˜å ç»„ä»¶çš„å®ç°\n\nç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®é™…çš„ä»£ç å®ç°ï¼Œæˆ‘ä¼šé€æ­¥è§£ææ¯ä¸ªå…³é”®éƒ¨åˆ†ã€‚\n\n### 3.1 ç»„ä»¶æ•´ä½“ç»“æ„\n\né¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ç»„ä»¶çš„æ•´ä½“ç»“æ„ï¼š\n\n```javascript\n// ä¸»ç»„ä»¶ï¼šSecondCategoryBox\nconst SecondCategoryBox = ({\n  categoryList,        // åˆ†ç±»æ•°æ®\n  defaultCategoryIds,  // é»˜è®¤é€‰ä¸­é¡¹\n  maxVisibleRows,      // æœ€å¤§å¯è§è¡Œæ•°\n  onCategoryChange     // é€‰ä¸­é¡¹å˜åŒ–å›è°ƒ\n}) => {\n  // çŠ¶æ€ç®¡ç†\n  const [activeIDList, setActiveIDList] = useState([]);\n  \n  // ä½¿ç”¨è‡ªå®šä¹‰ Hook ç®¡ç†æŠ˜å é€»è¾‘\n  const { containerRef, isExpanded, showToggleButton, setIsExpanded } = useCollapse({\n    maxVisibleRows,\n    dependencies: [categoryList]\n  });\n  \n  // æ¸²æŸ“é€»è¾‘...\n};\n```\n\n### 3.2 æ ¸å¿ƒéš¾ç‚¹ä¸€ï¼šç²¾ç¡®çš„é«˜åº¦è®¡ç®—\n\nè¿™æ˜¯æ•´ä¸ªç»„ä»¶æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚æˆ‘ä»¬éœ€è¦ï¼š\n\n1. è·å–å†…å®¹çš„å®Œæ•´é«˜åº¦ï¼ˆå±•å¼€æ—¶çš„é«˜åº¦ï¼‰\n2. è®¡ç®—æŠ˜å æ—¶åº”è¯¥æ˜¾ç¤ºçš„é«˜åº¦\n3. å†³å®šæ˜¯å¦éœ€è¦æ˜¾ç¤ºå±•å¼€/æ”¶èµ·æŒ‰é’®\n\n```javascript\nconst calculateHeightsWithScale = useCallback(() => {\n  if (!containerRef.current) return;\n  \n  const container = containerRef.current;\n  \n  // æ­¥éª¤1ï¼šä¸´æ—¶è§£é™¤é«˜åº¦é™åˆ¶\n  const originalHeight = container.style.height;\n  const originalOverflow = container.style.overflow;\n  \n  container.style.height = 'auto';\n  container.style.overflow = 'visible';\n  \n  // æ­¥éª¤2ï¼šæµ‹é‡çœŸå®é«˜åº¦\n  // æ³¨æ„ï¼šè¿™é‡Œå¿…é¡»ç­‰å¾…æµè§ˆå™¨å®Œæˆå¸ƒå±€è®¡ç®—\n  const fullHeight = container.scrollHeight;\n  \n  // æ­¥éª¤3ï¼šè®¡ç®—æŠ˜å é«˜åº¦\n  const visibleHeight = rowHeight * maxVisibleRows + gap * (maxVisibleRows - 1);\n  \n  // æ­¥éª¤4ï¼šæ¢å¤åŸå§‹æ ·å¼\n  container.style.height = originalHeight;\n  container.style.overflow = originalOverflow;\n  \n  // æ­¥éª¤5ï¼šæ›´æ–°çŠ¶æ€\n  setHeights({ full: fullHeight, visible: visibleHeight });\n  setShowToggleButton(fullHeight > visibleHeight);\n}, [maxVisibleRows, rowHeight, gap]);\n```\n\n**å…³é”®é—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Ÿ**\n\n### 3.3 æ ¸å¿ƒéš¾ç‚¹äºŒï¼šé€‰æ‹©æ­£ç¡®çš„æ‰§è¡Œæ—¶æœº\n\nè¿™å°±æ¶‰åŠåˆ°æˆ‘ä»¬è¦æ·±å…¥è®¨è®ºçš„ React æ¸²æŸ“æ—¶æœºé—®é¢˜ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸åŒæ–¹æ¡ˆçš„å¯¹æ¯”ï¼š\n\n#### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ useEffectï¼ˆâŒ ä¼šé—ªçƒï¼‰\n\n```javascript\nuseEffect(() => {\n  calculateHeightsWithScale();\n}, [categoryList]);\n```\n\n**é—®é¢˜åˆ†æ**ï¼š\n\n```mermaid\ngraph LR\n    A[åˆ†ç±»æ•°æ®å˜åŒ–] --> B[ç»„ä»¶é‡æ–°æ¸²æŸ“]\n    B --> C[DOM æ›´æ–°]\n    C --> D[æµè§ˆå™¨ç»˜åˆ¶]\n    D --> E[ç”¨æˆ·çœ‹åˆ°é”™è¯¯é«˜åº¦]\n    E --> F[useEffect æ‰§è¡Œ]\n    F --> G[è®¡ç®—å¹¶è®¾ç½®æ­£ç¡®é«˜åº¦]\n    G --> H[å†æ¬¡æ¸²æŸ“]\n    H --> I[ç”¨æˆ·çœ‹åˆ°æ­£ç¡®é«˜åº¦]\n    \n    style E fill:#ffcccc\n    style I fill:#ccffcc\n```\n\nç”¨æˆ·ä¼šå…ˆçœ‹åˆ°é”™è¯¯çš„é«˜åº¦ï¼Œç„¶åçªç„¶è·³åˆ°æ­£ç¡®é«˜åº¦â€”â€”è¿™å°±æ˜¯\"é—ªçƒ\"ï¼\n\n#### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ useLayoutEffectï¼ˆâš ï¸ å¯èƒ½é˜»å¡æ¸²æŸ“ï¼‰\n\n```javascript\nuseLayoutEffect(() => {\n  calculateHeightsWithScale();\n}, [categoryList]);\n```\n\n**ä¼˜ç‚¹**ï¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶å‰æ‰§è¡Œï¼Œé¿å…é—ªçƒ **ç¼ºç‚¹**ï¼šåŒæ­¥æ‰§è¡Œï¼Œå¯èƒ½é˜»å¡æ¸²æŸ“ï¼Œå½±å“æ€§èƒ½\n\n#### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ requestAnimationFrameï¼ˆâœ… æœ€ä½³æ–¹æ¡ˆï¼‰\n\n```javascript\nuseEffect(() => {\n  requestAnimationFrame(() => {\n    calculateHeightsWithScale();\n  });\n}, [categoryList]);\n```\n\n**ä¸ºä»€ä¹ˆè¿™æ˜¯æœ€ä½³æ–¹æ¡ˆï¼Ÿ**\n\n```mermaid\ngraph TB\n    A[useEffect æ‰§è¡Œ] --> B[æ³¨å†Œ RAF å›è°ƒ]\n    B --> C[æµè§ˆå™¨å®Œæˆå½“å‰å¸§ç»˜åˆ¶]\n    C --> D[å¸ƒå±€ä¿¡æ¯å·²ç¡®å®š]\n    D --> E[RAF å›è°ƒæ‰§è¡Œ]\n    E --> F[å‡†ç¡®è·å–é«˜åº¦]\n    F --> G[æ›´æ–°ç»„ä»¶çŠ¶æ€]\n    \n    style D fill:#ccffcc\n    style F fill:#ccffcc\n```\n\nrequestAnimationFrame ç¡®ä¿ï¼š\n\n1. ä¸é˜»å¡å½“å‰çš„æ¸²æŸ“\n2. åœ¨ä¸‹ä¸€å¸§å¼€å§‹å‰æ‰§è¡Œ\n3. æ­¤æ—¶å¸ƒå±€è®¡ç®—å·²å®Œæˆï¼Œå¯ä»¥å‡†ç¡®è·å–å°ºå¯¸\n\n### 3.4 æ ¸å¿ƒéš¾ç‚¹ä¸‰ï¼šä¼˜é›…åœ°å¤„ç†åŠ¨ç”»\n\nå½“ç”¨æˆ·åˆ‡æ¢ä¸€çº§åˆ†ç±»æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é‡ç½®äºŒçº§åˆ†ç±»ï¼Œä½†ä¸å¸Œæœ›ç”¨æˆ·çœ‹åˆ°æ”¶èµ·åŠ¨ç”»ï¼š\n\n```javascript\nuseEffect(() => {\n  if (firstUpdate) {\n    // é¦–æ¬¡åŠ è½½ï¼Œä½¿ç”¨é»˜è®¤é€‰ä¸­é¡¹\n    setActiveIDList(defaultCategoryIds);\n    setFirstUpdate(false);\n  } else {\n    // åˆ‡æ¢åˆ†ç±»æ—¶çš„å¤„ç†\n    \n    // æ­¥éª¤1ï¼šç«‹å³ç¦ç”¨ CSS è¿‡æ¸¡\n    setEnableTransition(false);\n    \n    // æ­¥éª¤2ï¼šé‡ç½®æ‰€æœ‰çŠ¶æ€\n    setIsExpanded(false);\n    setActiveIDList([]);\n    \n    // æ­¥éª¤3ï¼šåœ¨ä¸‹ä¸€å¸§æ¢å¤è¿‡æ¸¡æ•ˆæœ\n    requestAnimationFrame(() => {\n      setEnableTransition(true);\n    });\n  }\n}, [categoryList]);\n```\n\n**æ—¶åºåˆ†æ**ï¼š\n\n```mermaid\nsequenceDiagram\n    participant User as ç”¨æˆ·\n    participant Component as ç»„ä»¶\n    participant CSS as CSSåŠ¨ç”»\n    participant Browser as æµè§ˆå™¨\n    \n    User->>Component: åˆ‡æ¢ä¸€çº§åˆ†ç±»\n    Component->>Component: categoryList å˜åŒ–\n    Component->>CSS: ç¦ç”¨ transition\n    Component->>Component: é‡ç½®çŠ¶æ€ï¼ˆé«˜åº¦å˜ä¸ºæŠ˜å çŠ¶æ€ï¼‰\n    Note over CSS: æ— åŠ¨ç”»ï¼Œç¬é—´å˜åŒ–\n    Component->>Browser: è¯·æ±‚ä¸‹ä¸€å¸§\n    Browser-->>Component: ä¸‹ä¸€å¸§å¼€å§‹\n    Component->>CSS: å¯ç”¨ transition\n    Note over CSS: åç»­äº¤äº’æœ‰åŠ¨ç”»\n```\n\n### 3.5 æ€§èƒ½ä¼˜åŒ–ï¼šå“åº”å¼è®¾è®¡\n\nç»„ä»¶è¿˜å®ç°äº†ä¸€ä¸ªå·§å¦™çš„å“åº”å¼ç³»ç»Ÿï¼š\n\n```javascript\nconst calculateScale = useCallback(() => {\n  const currentWidth = window.innerWidth;\n  const scale = currentWidth / baseWidth;\n  \n  // é™åˆ¶ç¼©æ”¾èŒƒå›´ï¼Œé¿å…æç«¯æƒ…å†µ\n  const clampedScale = Math.max(0.8, Math.min(1.5, scale));\n  \n  return {\n    scale: clampedScale,\n    rowHeight: Math.round(baseRowHeight * clampedScale),\n    gap: Math.round(baseGap * clampedScale)\n  };\n}, [baseWidth, baseRowHeight, baseGap]);\n```\n\nè¿™ç¡®ä¿äº†ç»„ä»¶åœ¨ä¸åŒè®¾å¤‡ä¸Šéƒ½æœ‰åˆé€‚çš„æ˜¾ç¤ºæ•ˆæœã€‚\n\n## å››ã€æ·±å…¥ç†è§£ useEffect å’Œ useLayoutEffect\n\n### 4.1 æœ¬è´¨åŒºåˆ«\n\n```javascript\n// useEffectï¼šåœ¨æµè§ˆå™¨å®Œæˆç»˜åˆ¶åå¼‚æ­¥æ‰§è¡Œ\nuseEffect(() => {\n  console.log('1. DOM å·²æ›´æ–°');\n  console.log('2. æµè§ˆå™¨å·²ç»˜åˆ¶');\n  console.log('3. ç”¨æˆ·å·²çœ‹åˆ°å˜åŒ–');\n  console.log('4. ç°åœ¨æ‰§è¡Œä¸ä¼šé˜»å¡æ¸²æŸ“');\n});\n\n// useLayoutEffectï¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶å‰åŒæ­¥æ‰§è¡Œ\nuseLayoutEffect(() => {\n  console.log('1. DOM å·²æ›´æ–°');\n  console.log('2. æµè§ˆå™¨è¿˜æœªç»˜åˆ¶');\n  console.log('3. ç”¨æˆ·è¿˜çœ‹ä¸åˆ°å˜åŒ–');\n  console.log('4. å¯ä»¥åœ¨è¿™é‡Œè°ƒæ•´æ ·å¼é¿å…é—ªçƒ');\n});\n```\n\n### 4.2 ä½¿ç”¨åœºæ™¯å¯¹æ¯”\n\n```mermaid\ngraph TB\n    A[éœ€è¦æ‰§è¡Œå‰¯ä½œç”¨] --> B{æ˜¯å¦å½±å“è§†è§‰å‘ˆç°?}\n    \n    B -->|æ˜¯| C{æ˜¯å¦éœ€è¦ DOM æµ‹é‡?}\n    B -->|å¦| D[ä½¿ç”¨ useEffect]\n    \n    C -->|æ˜¯| E{æµ‹é‡æ˜¯å¦ç´§æ€¥?}\n    C -->|å¦| F[ä½¿ç”¨ useLayoutEffect]\n    \n    E -->|æ˜¯| G[useLayoutEffect]\n    E -->|å¦| H[useEffect + RAF]\n    \n    D --> I[æ•°æ®è·å–<br/>äº‹ä»¶è®¢é˜…<br/>æ—¥å¿—ä¸ŠæŠ¥]\n    F --> J[é˜»æ­¢é—ªçƒ<br/>åŒæ­¥æ»šåŠ¨<br/>ç„¦ç‚¹ç®¡ç†]\n    G --> K[å…³é”®å¸ƒå±€è®¡ç®—<br/>åŠ¨ç”»åˆå§‹çŠ¶æ€]\n    H --> L[éå…³é”®æµ‹é‡<br/>æ€§èƒ½ä¼˜åŒ–]\n    \n    style B fill:#ffffcc\n    style C fill:#ffffcc\n    style E fill:#ffffcc\n```\n\n### 4.3 å®é™…æ¡ˆä¾‹å¯¹æ¯”\n\nè®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªå®é™…ä¾‹å­æ¥åŠ æ·±ç†è§£ï¼š\n\n#### æ¡ˆä¾‹1ï¼šå·¥å…·æç¤ºå®šä½\n\n```javascript\nfunction Tooltip({ children, content }) {\n  const [position, setPosition] = useState({ top: 0, left: 0 });\n  const triggerRef = useRef();\n  const tooltipRef = useRef();\n  \n  // âœ… ä½¿ç”¨ useLayoutEffect é¿å…å·¥å…·æç¤ºé—ªçƒ\n  useLayoutEffect(() => {\n    if (triggerRef.current && tooltipRef.current) {\n      const triggerRect = triggerRef.current.getBoundingClientRect();\n      const tooltipRect = tooltipRef.current.getBoundingClientRect();\n      \n      setPosition({\n        top: triggerRect.top - tooltipRect.height - 8,\n        left: triggerRect.left + (triggerRect.width - tooltipRect.width) / 2\n      });\n    }\n  }, []);\n  \n  return (\n    <>\n      <span ref={triggerRef}>{children}</span>\n      <div \n        ref={tooltipRef}\n        className=\"tooltip\"\n        style={{ position: 'fixed', ...position }}\n      >\n        {content}\n      </div>\n    </>\n  );\n}\n```\n\n#### æ¡ˆä¾‹2ï¼šæ»šåŠ¨ä½ç½®æ¢å¤\n\n```javascript\nfunction ScrollRestore({ location }) {\n  // âœ… ä½¿ç”¨ useLayoutEffect ç«‹å³æ¢å¤æ»šåŠ¨ä½ç½®\n  useLayoutEffect(() => {\n    const savedPosition = sessionStorage.getItem(`scroll-${location}`);\n    if (savedPosition) {\n      window.scrollTo(0, parseInt(savedPosition));\n    }\n  }, [location]);\n  \n  // âœ… ä½¿ç”¨ useEffect ä¿å­˜æ»šåŠ¨ä½ç½®ï¼ˆéç´§æ€¥ï¼‰\n  useEffect(() => {\n    const handleScroll = () => {\n      sessionStorage.setItem(`scroll-${location}`, window.scrollY);\n    };\n    \n    window.addEventListener('scroll', handleScroll);\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, [location]);\n}\n```\n\n#### æ¡ˆä¾‹3ï¼šåŠ¨ç”»åºåˆ—\n\n```javascript\nfunction AnimatedList({ items }) {\n  const [visibleItems, setVisibleItems] = useState([]);\n  \n  // âŒ é”™è¯¯ï¼šåœ¨ useLayoutEffect ä¸­åšå¤æ‚è®¡ç®—\n  // useLayoutEffect(() => {\n  //   items.forEach((item, index) => {\n  //     setTimeout(() => {\n  //       setVisibleItems(prev => [...prev, item]);\n  //     }, index * 100);\n  //   });\n  // }, [items]);\n  \n  // âœ… æ­£ç¡®ï¼šä½¿ç”¨ useEffect + RAF\n  useEffect(() => {\n    let frameId;\n    let index = 0;\n    \n    const animate = () => {\n      if (index < items.length) {\n        setVisibleItems(prev => [...prev, items[index]]);\n        index++;\n        frameId = requestAnimationFrame(animate);\n      }\n    };\n    \n    frameId = requestAnimationFrame(animate);\n    \n    return () => {\n      if (frameId) {\n        cancelAnimationFrame(frameId);\n      }\n    };\n  }, [items]);\n}\n```\n\n## äº”ã€requestAnimationFrame çš„é«˜çº§åº”ç”¨\n\n### 5.1 ä»€ä¹ˆæ˜¯ requestAnimationFrameï¼Ÿ\n\nrequestAnimationFrameï¼ˆç®€ç§° RAFï¼‰æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€ä¸ª APIï¼Œç”¨äºåœ¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡ŒåŠ¨ç”»ã€‚å®ƒçš„æ‰§è¡Œæ—¶æœºéå¸¸ç‰¹æ®Šï¼š\n\n```mermaid\ngraph LR\n    A[å¸§å¼€å§‹] --> B[å¤„ç†ç”¨æˆ·è¾“å…¥]\n    B --> C[JS æ‰§è¡Œ]\n    C --> D[RAF å›è°ƒ]\n    D --> E[æ ·å¼è®¡ç®—]\n    E --> F[å¸ƒå±€]\n    F --> G[ç»˜åˆ¶]\n    G --> H[åˆæˆ]\n    H --> I[å¸§ç»“æŸ]\n    \n    style D fill:#ffcccc\n```\n\n### 5.2 åœ¨ React ä¸­çš„åº”ç”¨åœºæ™¯\n\n#### åœºæ™¯1ï¼šç¡®ä¿å¸ƒå±€å®Œæˆåæµ‹é‡\n\n```javascript\nfunction useMeasure() {\n  const ref = useRef();\n  const [bounds, setBounds] = useState({});\n  \n  useEffect(() => {\n    if (!ref.current) return;\n    \n    // ç¡®ä¿åœ¨å¸ƒå±€ç¨³å®šåæµ‹é‡\n    const measure = () => {\n      requestAnimationFrame(() => {\n        if (ref.current) {\n          setBounds(ref.current.getBoundingClientRect());\n        }\n      });\n    };\n    \n    measure();\n    window.addEventListener('resize', measure);\n    \n    return () => window.removeEventListener('resize', measure);\n  }, []);\n  \n  return [ref, bounds];\n}\n```\n\n#### åœºæ™¯2ï¼šæ‰¹é‡ DOM æ“ä½œ\n\n```javascript\nfunction batchDOMUpdates(updates) {\n  requestAnimationFrame(() => {\n    // åœ¨ä¸€ä¸ªå¸§å†…å®Œæˆæ‰€æœ‰ DOM æ“ä½œ\n    updates.forEach(update => update());\n    \n    // å¼ºåˆ¶æµè§ˆå™¨ç«‹å³è®¡ç®—æ ·å¼ï¼ˆå¦‚æœéœ€è¦è¯»å–ï¼‰\n    // æ³¨æ„ï¼šè¿™ä¼šè§¦å‘å¼ºåˆ¶åŒæ­¥å¸ƒå±€ï¼Œè°¨æ…ä½¿ç”¨\n    if (needsRead) {\n      document.body.offsetHeight; // å¼ºåˆ¶é‡æ’\n    }\n  });\n}\n```\n\n#### åœºæ™¯3ï¼šå¹³æ»‘åŠ¨ç”»\n\n```javascript\nfunction useAnimation(duration = 300) {\n  const [progress, setProgress] = useState(0);\n  const frameRef = useRef();\n  const startTimeRef = useRef();\n  \n  const start = useCallback(() => {\n    startTimeRef.current = performance.now();\n    \n    const animate = (currentTime) => {\n      const elapsed = currentTime - startTimeRef.current;\n      const progress = Math.min(elapsed / duration, 1);\n      \n      setProgress(progress);\n      \n      if (progress < 1) {\n        frameRef.current = requestAnimationFrame(animate);\n      }\n    };\n    \n    frameRef.current = requestAnimationFrame(animate);\n  }, [duration]);\n  \n  useEffect(() => {\n    return () => {\n      if (frameRef.current) {\n        cancelAnimationFrame(frameRef.current);\n      }\n    };\n  }, []);\n  \n  return [progress, start];\n}\n```\n\n### 5.3 RAF vs setTimeout/setInterval\n\n```javascript\n// âŒ ä¸æ¨èï¼šå¯èƒ½å¯¼è‡´æ‰å¸§æˆ–ä¸æµç•…\nuseEffect(() => {\n  const timer = setInterval(() => {\n    setPosition(prev => prev + 1);\n  }, 16); // çº¦ 60fps\n  \n  return () => clearInterval(timer);\n}, []);\n\n// âœ… æ¨èï¼šä¸æµè§ˆå™¨åˆ·æ–°ç‡åŒæ­¥\nuseEffect(() => {\n  let frameId;\n  \n  const animate = () => {\n    setPosition(prev => prev + 1);\n    frameId = requestAnimationFrame(animate);\n  };\n  \n  frameId = requestAnimationFrame(animate);\n  \n  return () => cancelAnimationFrame(frameId);\n}, []);\n```\n\n## å…­ã€å¸¸è§é—®é¢˜ä¸æœ€ä½³å®è·µ\n\n### 6.1 å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ\n\n#### é”™è¯¯1ï¼šåœ¨æ¸²æŸ“é˜¶æ®µè¯»å– DOM\n\n```javascript\n// âŒ é”™è¯¯\nfunction BadComponent() {\n  const ref = useRef();\n  // è¿™é‡Œ ref.current å¯èƒ½æ˜¯ null\n  const height = ref.current?.offsetHeight || 0;\n  \n  return <div ref={ref}>Content</div>;\n}\n\n// âœ… æ­£ç¡®\nfunction GoodComponent() {\n  const ref = useRef();\n  const [height, setHeight] = useState(0);\n  \n  useEffect(() => {\n    if (ref.current) {\n      setHeight(ref.current.offsetHeight);\n    }\n  }, []);\n  \n  return <div ref={ref}>Content</div>;\n}\n```\n\n#### é”™è¯¯2ï¼šè¿‡åº¦ä½¿ç”¨ useLayoutEffect\n\n```javascript\n// âŒ é”™è¯¯ï¼šéè§†è§‰ç›¸å…³æ“ä½œ\nuseLayoutEffect(() => {\n  // æ•°æ®è·å–ä¸åº”è¯¥é˜»å¡æ¸²æŸ“\n  fetch('/api/data').then(setData);\n}, []);\n\n// âœ… æ­£ç¡®\nuseEffect(() => {\n  fetch('/api/data').then(setData);\n}, []);\n```\n\n#### é”™è¯¯3ï¼šå¿½è§†æ¸…ç†å‡½æ•°\n\n```javascript\n// âŒ é”™è¯¯ï¼šå†…å­˜æ³„æ¼\nuseEffect(() => {\n  const timer = setInterval(() => {\n    console.log('tick');\n  }, 1000);\n  // å¿˜è®°æ¸…ç†ï¼\n}, []);\n\n// âœ… æ­£ç¡®\nuseEffect(() => {\n  const timer = setInterval(() => {\n    console.log('tick');\n  }, 1000);\n  \n  return () => clearInterval(timer);\n}, []);\n```\n\n### 6.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®\n\n#### 1. é¿å…ä¸å¿…è¦çš„å¸ƒå±€è®¡ç®—\n\n```javascript\n// âŒ æ€§èƒ½å·®ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½è®¡ç®—\nfunction BadComponent({ items }) {\n  const heights = items.map(item => {\n    const element = document.getElementById(item.id);\n    return element?.offsetHeight || 0;\n  });\n}\n\n// âœ… æ€§èƒ½å¥½ï¼šåªåœ¨å¿…è¦æ—¶è®¡ç®—\nfunction GoodComponent({ items }) {\n  const [heights, setHeights] = useState([]);\n  \n  useEffect(() => {\n    requestAnimationFrame(() => {\n      const newHeights = items.map(item => {\n        const element = document.getElementById(item.id);\n        return element?.offsetHeight || 0;\n      });\n      setHeights(newHeights);\n    });\n  }, [items]);\n}\n```\n\n#### 2. æ‰¹é‡æ›´æ–° DOM\n\n```javascript\n// âœ… æ‰¹é‡è¯»å–å’Œå†™å…¥\nfunction BatchUpdate({ items }) {\n  useLayoutEffect(() => {\n    // ç¬¬ä¸€é˜¶æ®µï¼šæ‰¹é‡è¯»å–\n    const measurements = items.map(item => ({\n      id: item.id,\n      height: document.getElementById(item.id)?.offsetHeight || 0\n    }));\n    \n    // ç¬¬äºŒé˜¶æ®µï¼šæ‰¹é‡å†™å…¥\n    measurements.forEach(({ id, height }) => {\n      const element = document.getElementById(id);\n      if (element) {\n        element.style.transform = `translateY(${height}px)`;\n      }\n    });\n  }, [items]);\n}\n```\n\n#### 3. ä½¿ç”¨ CSS ä»£æ›¿ JS åŠ¨ç”»\n\n```javascript\n// âŒ JS åŠ¨ç”»ï¼ˆæ€§èƒ½è¾ƒå·®ï¼‰\nconst [height, setHeight] = useState(0);\nuseEffect(() => {\n  let current = 0;\n  const timer = setInterval(() => {\n    current += 5;\n    setHeight(current);\n    if (current >= 100) clearInterval(timer);\n  }, 16);\n}, []);\n\n// âœ… CSS åŠ¨ç”»ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰\nconst [expanded, setExpanded] = useState(false);\nreturn (\n  <div \n    className={`container ${expanded ? 'expanded' : ''}`}\n    style={{\n      transition: 'height 0.3s ease-out',\n      height: expanded ? '100px' : '0px'\n    }}\n  />\n);\n```\n\n### 6.3 è°ƒè¯•æŠ€å·§\n\n#### 1. å¯è§†åŒ–æ¸²æŸ“æ—¶æœº\n\n```javascript\nfunction useRenderLog(name) {\n  console.log(`${name} rendering`);\n  \n  useLayoutEffect(() => {\n    console.log(`${name} layout effect`);\n  });\n  \n  useEffect(() => {\n    console.log(`${name} effect`);\n    \n    requestAnimationFrame(() => {\n      console.log(`${name} next frame`);\n    });\n  });\n}\n```\n\n#### 2. æ€§èƒ½ç›‘æ§\n\n```javascript\nfunction usePerformanceMonitor(name) {\n  const renderStart = performance.now();\n  \n  useLayoutEffect(() => {\n    const layoutEffectTime = performance.now();\n    console.log(`${name} to layout effect: ${layoutEffectTime - renderStart}ms`);\n  });\n  \n  useEffect(() => {\n    const effectTime = performance.now();\n    console.log(`${name} to effect: ${effectTime - renderStart}ms`);\n    \n    requestAnimationFrame(() => {\n      const frameTime = performance.now();\n      console.log(`${name} to next frame: ${frameTime - renderStart}ms`);\n    });\n  });\n}\n```\n\n## ä¸ƒã€React 18 å¹¶å‘ç‰¹æ€§ä¸æ¸²æŸ“æ—¶æœº\n\n### 7.1 å¹¶å‘æ¸²æŸ“çš„å½±å“\n\nReact 18 å¼•å…¥çš„å¹¶å‘ç‰¹æ€§æ”¹å˜äº†ä¸€äº›æ¸²æŸ“è¡Œä¸ºï¼š\n\n```javascript\nimport { startTransition, useDeferredValue, useId } from 'react';\n\nfunction ConcurrentComponent({ searchTerm, items }) {\n  // å»¶è¿Ÿéç´§æ€¥æ›´æ–°\n  const deferredSearchTerm = useDeferredValue(searchTerm);\n  \n  // æ ‡è®°ä½ä¼˜å…ˆçº§æ›´æ–°\n  const handleExpensiveUpdate = () => {\n    startTransition(() => {\n      // è¿™ä¸ªæ›´æ–°å¯ä»¥è¢«ä¸­æ–­\n      setExpensiveState(calculateExpensiveValue());\n    });\n  };\n  \n  // ç´§æ€¥æ›´æ–°ä»ç„¶åŒæ­¥å¤„ç†\n  const handleUrgentUpdate = () => {\n    setUrgentState(value); // ç«‹å³å“åº”\n  };\n}\n```\n\n### 7.2 å¹¶å‘æ¸²æŸ“ä¸‹çš„ useEffect\n\nåœ¨å¹¶å‘æ¨¡å¼ä¸‹ï¼Œç»„ä»¶å¯èƒ½ä¼šå¤šæ¬¡æ¸²æŸ“ä½†åªæäº¤ä¸€æ¬¡ï¼š\n\n```mermaid\ngraph TB\n    A[å¼€å§‹æ¸²æŸ“] --> B{é«˜ä¼˜å…ˆçº§æ›´æ–°?}\n    B -->|æ˜¯| C[ä¸­æ–­å½“å‰æ¸²æŸ“]\n    B -->|å¦| D[ç»§ç»­æ¸²æŸ“]\n    C --> E[å¤„ç†é«˜ä¼˜å…ˆçº§]\n    E --> F[é‡æ–°å¼€å§‹ä½ä¼˜å…ˆçº§]\n    D --> G[æäº¤åˆ° DOM]\n    F --> D\n    G --> H[æ‰§è¡Œ Effects]\n    \n    style C fill:#ffcccc\n    style E fill:#ffcccc\n```\n\n### 7.3 å®è·µå»ºè®®\n\n```javascript\nfunction SearchResults({ query }) {\n  const [results, setResults] = useState([]);\n  const [isSearching, setIsSearching] = useState(false);\n  \n  // ä½¿ç”¨ useDeferredValue ä¼˜åŒ–æœç´¢ä½“éªŒ\n  const deferredQuery = useDeferredValue(query);\n  \n  // ç´§æ€¥ï¼šæ˜¾ç¤ºåŠ è½½çŠ¶æ€\n  useEffect(() => {\n    setIsSearching(query !== deferredQuery);\n  }, [query, deferredQuery]);\n  \n  // éç´§æ€¥ï¼šæ‰§è¡Œæœç´¢\n  useEffect(() => {\n    let cancelled = false;\n    \n    async function doSearch() {\n      const data = await searchAPI(deferredQuery);\n      if (!cancelled) {\n        startTransition(() => {\n          setResults(data);\n        });\n      }\n    }\n    \n    doSearch();\n    \n    return () => {\n      cancelled = true;\n    };\n  }, [deferredQuery]);\n  \n  return (\n    <div>\n      {isSearching && <Spinner />}\n      <ResultsList results={results} />\n    </div>\n  );\n}\n```\n\n## å…«ã€å®æˆ˜æ€»ç»“ï¼šå›åˆ°æˆ‘ä»¬çš„æŠ˜å ç»„ä»¶\n\nç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨å­¦åˆ°çš„çŸ¥è¯†é‡æ–°å®¡è§†æœ€åˆçš„æŠ˜å ç»„ä»¶ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•è§£å†³å„ç§æ¸²æŸ“æ—¶æœºé—®é¢˜çš„ï¼š\n\n### 8.1 é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆå¯¹ç…§\n\n| é—®é¢˜                 | è§£å†³æ–¹æ¡ˆ             | åŸç†                  |\n| -------------------- | -------------------- | --------------------- |\n| è·å–å‡†ç¡®çš„å†…å®¹é«˜åº¦   | useEffect + RAF      | ç¡®ä¿å¸ƒå±€è®¡ç®—å®Œæˆ      |\n| åˆ‡æ¢åˆ†ç±»æ—¶çš„åŠ¨ç”»é—ªçƒ | ç¦ç”¨/å¯ç”¨ transition | ç²¾ç¡®æ§åˆ¶ CSS åŠ¨ç”»æ—¶æœº |\n| å“åº”å¼é€‚é…           | åŠ¨æ€è®¡ç®—ç¼©æ”¾æ¯”ä¾‹     | é¿å…é¢‘ç¹çš„ DOM æ“ä½œ   |\n| é¦–æ¬¡åŠ è½½çš„é»˜è®¤çŠ¶æ€   | firstUpdate æ ‡è®°     | åŒºåˆ†åˆå§‹åŒ–å’Œæ›´æ–°      |\n\n### 8.2 å®Œæ•´çš„æ¸²æŸ“æµç¨‹\n\n```mermaid\nsequenceDiagram\n    participant U as ç”¨æˆ·\n    participant C as ç»„ä»¶\n    participant D as DOM\n    participant B as æµè§ˆå™¨\n    \n    Note over U,B: åœºæ™¯1ï¼šç»„ä»¶é¦–æ¬¡åŠ è½½\n    U->>C: é¡µé¢åŠ è½½\n    C->>C: åˆå§‹åŒ–çŠ¶æ€\n    C->>D: æ¸²æŸ“ DOM\n    C->>C: useEffect æ‰§è¡Œ\n    C->>B: RAF æ³¨å†Œå›è°ƒ\n    B->>C: ä¸‹ä¸€å¸§æ‰§è¡Œæµ‹é‡\n    C->>C: è®¾ç½®æ­£ç¡®é«˜åº¦\n    C->>D: æ›´æ–° DOM\n    B->>U: æ˜¾ç¤ºå®Œæ•´å†…å®¹\n    \n    Note over U,B: åœºæ™¯2ï¼šç”¨æˆ·ç‚¹å‡»å±•å¼€\n    U->>C: ç‚¹å‡»å±•å¼€æŒ‰é’®\n    C->>C: setIsExpanded(true)\n    C->>D: æ›´æ–°é«˜åº¦æ ·å¼\n    Note over D,B: CSS transition ç”Ÿæ•ˆ\n    B->>U: å¹³æ»‘å±•å¼€åŠ¨ç”»\n    \n    Note over U,B: åœºæ™¯3ï¼šåˆ‡æ¢åˆ†ç±»\n    U->>C: é€‰æ‹©æ–°åˆ†ç±»\n    C->>C: ç¦ç”¨ transition\n    C->>C: é‡ç½®çŠ¶æ€\n    C->>D: ç«‹å³æ›´æ–°ï¼ˆæ— åŠ¨ç”»ï¼‰\n    C->>B: RAF æ³¨å†Œå›è°ƒ\n    B->>C: ä¸‹ä¸€å¸§æ¢å¤ transition\n    Note over C,B: åç»­äº¤äº’æ¢å¤åŠ¨ç”»\n```\n\n### 8.3 å…³é”®ä»£ç ç‰‡æ®µå›é¡¾\n\n```javascript\n// 1. è‡ªå®šä¹‰ Hook å°è£…å¤æ‚é€»è¾‘\nexport const useCollapse = (options) => {\n  const { maxVisibleRows = 2, dependencies = [] } = options;\n  const containerRef = useRef();\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [showToggleButton, setShowToggleButton] = useState(false);\n  \n  // 2. ä½¿ç”¨ RAF ç¡®ä¿å‡†ç¡®æµ‹é‡\n  useEffect(() => {\n    requestAnimationFrame(() => calculateHeightsWithScale());\n  }, dependencies);\n  \n  // 3. è¿”å›å¿…è¦çš„çŠ¶æ€å’Œå¼•ç”¨\n  return {\n    containerRef,\n    isExpanded,\n    showToggleButton,\n    setIsExpanded,\n    containerStyle: {\n      height: !showToggleButton ? 'auto' : \n              isExpanded ? heights.full : heights.visible,\n      overflow: 'hidden',\n      transition: 'height 0.3s ease-in-out'\n    }\n  };\n};\n```\n\n## ä¹ã€å†™åœ¨æœ€å\n\né€šè¿‡è¿™ä¸ªçœŸå®çš„ç”µå•†é¡¹ç›®æ¡ˆä¾‹ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº† React çš„æ¸²æŸ“æ—¶æœºé—®é¢˜ã€‚è®©æˆ‘ä»¬å†æ¬¡æ€»ç»“ä¸€ä¸‹æ ¸å¿ƒè¦ç‚¹ï¼š\n\n### 9.1 æ ¸å¿ƒåŸåˆ™\n\n1. **ç†è§£æ—¶æœº**ï¼šçŸ¥é“ä»£ç åœ¨ React ç”Ÿå‘½å‘¨æœŸçš„å“ªä¸ªé˜¶æ®µæ‰§è¡Œ\n2. **é€‰å¯¹å·¥å…·**ï¼šuseEffectã€useLayoutEffectã€RAF å„æœ‰é€‚ç”¨åœºæ™¯\n3. **é¿å…é—ªçƒ**ï¼šéœ€è¦ç«‹å³ç”Ÿæ•ˆçš„è§†è§‰å˜åŒ–ç”¨ useLayoutEffect\n4. **æ€§èƒ½ä¼˜å…ˆ**ï¼šéç´§æ€¥æ“ä½œæ”¾åœ¨ useEffect ä¸­å¼‚æ­¥æ‰§è¡Œ\n5. **ç²¾ç¡®æ§åˆ¶**ï¼šä½¿ç”¨ RAF åœ¨æ­£ç¡®çš„æ—¶æœºè¿›è¡Œ DOM æµ‹é‡\n\n### 9.2 å†³ç­–æµç¨‹å›¾\n\n```mermaid\ngraph TD\n    A[éœ€è¦å‰¯ä½œç”¨?] -->|æ˜¯| B[å½±å“è§†è§‰?]\n    A -->|å¦| Z[çº¯ç»„ä»¶é€»è¾‘]\n    \n    B -->|æ˜¯| C[éœ€è¦ DOM æµ‹é‡?]\n    B -->|å¦| D[useEffect]\n    \n    C -->|æ˜¯| E[æµ‹é‡ç´§æ€¥?]\n    C -->|å¦| F[useLayoutEffect]\n    \n    E -->|æ˜¯| G[useLayoutEffect]\n    E -->|å¦| H[useEffect + RAF]\n    \n    D --> I[å¼‚æ­¥æ“ä½œ<br/>æ•°æ®è·å–<br/>äº‹ä»¶è®¢é˜…]\n    F --> J[é˜²æ­¢é—ªçƒ<br/>æ»šåŠ¨æ¢å¤]\n    G --> K[å…³é”®æµ‹é‡<br/>åˆå§‹å®šä½]\n    H --> L[æ€§èƒ½ä¼˜åŒ–<br/>éå…³é”®æµ‹é‡]\n    \n    style A fill:#f9f,stroke:#333,stroke-width:4px\n    style B fill:#bbf,stroke:#333,stroke-width:2px\n    style C fill:#bbf,stroke:#333,stroke-width:2px\n    style E fill:#bbf,stroke:#333,stroke-width:2px\n```\n\n### 9.3 ä»ç†è®ºåˆ°å®è·µ\n\nç†è§£ React çš„æ¸²æŸ“æ—¶æœºä¸ä»…ä»…æ˜¯ç†è®ºçŸ¥è¯†ï¼Œæ›´æ˜¯è§£å†³å®é™…é—®é¢˜çš„å…³é”®ã€‚å½“ä½ é‡åˆ°ä»¥ä¸‹é—®é¢˜æ—¶ï¼Œè¯·æƒ³èµ·è¿™ç¯‡æ–‡ç« ï¼š\n\n- é¡µé¢é—ªçƒ â†’ æ£€æŸ¥æ˜¯å¦åº”è¯¥ä½¿ç”¨ useLayoutEffect\n- è·å–çš„å°ºå¯¸ä¸º 0 â†’ ä½¿ç”¨ RAF ç¡®ä¿å¸ƒå±€å®Œæˆ\n- åŠ¨ç”»å¡é¡¿ â†’ è€ƒè™‘ä½¿ç”¨ CSS åŠ¨ç”»æˆ– RAF\n- æ€§èƒ½é—®é¢˜ â†’ å°†éç´§æ€¥æ“ä½œç§»åˆ° useEffect\n\n## åã€å‚è€ƒèµ„æ–™\n\n1. [React å®˜æ–¹æ–‡æ¡£ - Hooks Reference](https://react.dev/reference/react)\n2. [React æºç è§£æ - Fiber æ¶æ„](https://github.com/facebook/react)\n3. [Web æ€§èƒ½ä¼˜åŒ– - requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame)\n4. [React 18 Working Group](https://github.com/reactwg/react-18)\n5. [æµè§ˆå™¨æ¸²æŸ“åŸç†](https://developers.google.com/web/fundamentals/performance/rendering)\n\n------\n\n*å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—å’Œåˆ†äº«ã€‚æœ‰ä»»ä½•é—®é¢˜æˆ–ä¸åŒè§è§£ï¼Œä¹Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºï¼*\n","tags":["React","é¡¹ç›®æ¡ˆä¾‹","æ€§èƒ½ä¼˜åŒ–","å‰ç«¯å¼€å‘"],"categories":["ä»é¡¹ç›®åˆ°æŠ€æœ¯"]},{"title":"ã€æ¦‚å¿µè§£æã€‘å‰ç«¯å¼€å‘ä¸­çš„polypill","url":"/2025/07/22/ã€æ¦‚å¿µè§£æã€‘å‰ç«¯å¼€å‘ä¸­çš„Polyfill/","content":"\n\n\n## ä»€ä¹ˆæ˜¯ Polyfillï¼Ÿ\n\n**Polyfill** æ˜¯ä¸€æ®µä»£ç ï¼ˆé€šå¸¸æ˜¯ JavaScriptï¼‰ï¼Œç”¨æ¥ä¸ºæ—§æµè§ˆå™¨æä¾›å®ƒæ²¡æœ‰åŸç”Ÿæ”¯æŒçš„è¾ƒæ–°çš„åŠŸèƒ½ã€‚\n\n### åå­—çš„ç”±æ¥ ğŸ¨\n\n\"Polyfill\" è¿™ä¸ªè¯æ¥æºäºä¸€ç§å»ºç­‘ææ–™ Polyfillaï¼ˆä¸€ç§ç”¨äºå¡«è¡¥å¢™é¢è£‚ç¼çš„è…»å­ï¼‰ï¼Œå½¢è±¡åœ°è¡¨ç¤º\"å¡«è¡¥æµè§ˆå™¨åŠŸèƒ½çš„ç©ºç¼º\"ã€‚\n\n## ä¸ºä»€ä¹ˆéœ€è¦ Polyfillï¼Ÿ\n\n```javascript\n// ğŸŒ° ä¾‹å­ï¼šæ—§æµè§ˆå™¨ä¸æ”¯æŒ Array.includes\nconst fruits = ['apple', 'banana', 'orange'];\n\n// æ–°æµè§ˆå™¨å¯ä»¥ç›´æ¥ä½¿ç”¨\nconsole.log(fruits.includes('banana')); // true\n\n// æ—§æµè§ˆå™¨ä¼šæŠ¥é”™ï¼šfruits.includes is not a function\n```\n\n## å¸¸è§çš„ Polyfill ç¤ºä¾‹\n\n### 1. Array.includes Polyfill\n\n```javascript\n// æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨\nif (!Array.prototype.includes) {\n  Array.prototype.includes = function(searchElement, fromIndex) {\n    // ä¸¥æ ¼æ¨¡å¼\n    'use strict';\n    \n    const O = Object(this);\n    const len = parseInt(O.length) || 0;\n    \n    if (len === 0) return false;\n    \n    const n = parseInt(fromIndex) || 0;\n    let k = Math.max(n >= 0 ? n : len + n, 0);\n    \n    while (k < len) {\n      if (searchElement === O[k]) return true;\n      k++;\n    }\n    \n    return false;\n  };\n}\n```\n\n### 2. Promise Polyfill\n\n```javascript\n// ç®€åŒ–ç‰ˆ Promise polyfill\nif (typeof Promise === 'undefined') {\n  window.Promise = function(executor) {\n    // Promise å®ç°ä»£ç ...\n  };\n}\n```\n\n### 3. Object.assign Polyfill\n\n```javascript\nif (!Object.assign) {\n  Object.assign = function(target) {\n    'use strict';\n    \n    if (target == null) {\n      throw new TypeError('Cannot convert undefined or null to object');\n    }\n    \n    const output = Object(target);\n    \n    for (let index = 1; index < arguments.length; index++) {\n      const source = arguments[index];\n      if (source != null) {\n        for (const key in source) {\n          if (Object.prototype.hasOwnProperty.call(source, key)) {\n            output[key] = source[key];\n          }\n        }\n      }\n    }\n    \n    return output;\n  };\n}\n```\n\n### 4. String.padStart Polyfill\n\n```javascript\nif (!String.prototype.padStart) {\n  String.prototype.padStart = function(targetLength, padString) {\n    targetLength = targetLength >> 0; // è½¬ä¸ºæ•´æ•°\n    padString = String(padString || ' ');\n    \n    if (this.length >= targetLength) {\n      return String(this);\n    }\n    \n    targetLength = targetLength - this.length;\n    if (targetLength > padString.length) {\n      padString += padString.repeat(targetLength / padString.length);\n    }\n    \n    return padString.slice(0, targetLength) + String(this);\n  };\n}\n```\n\n## Polyfill vs å…¶ä»–æ¦‚å¿µ\n\n### 1. Polyfill vs Transpileï¼ˆè½¬è¯‘ï¼‰\n\n```javascript\n// Polyfillï¼šè¿è¡Œæ—¶è¡¥å……ç¼ºå¤±çš„ API\nArray.prototype.find = Array.prototype.find || function() { /* ... */ };\n\n// Transpileï¼šç¼–è¯‘æ—¶è½¬æ¢è¯­æ³•ï¼ˆå¦‚ Babelï¼‰\n// ES6 ç®­å¤´å‡½æ•°\nconst add = (a, b) => a + b;\n// è½¬è¯‘å\nvar add = function(a, b) { return a + b; };\n```\n\n### 2. Polyfill vs Shim\n\n- **Polyfill**ï¼šå®ç°æ ‡å‡† APIï¼Œè¡Œä¸ºä¸è§„èŒƒä¸€è‡´\n- **Shim**ï¼šå¯èƒ½æœ‰è‡ªå·±çš„ APIï¼Œä¸ä¸€å®šéµå¾ªæ ‡å‡†\n\n## å¦‚ä½•ä½¿ç”¨ Polyfillï¼Ÿ\n\n### 1. æ‰‹åŠ¨å¼•å…¥\n\n```html\n<!-- å¼•å…¥ç‰¹å®šçš„ polyfill -->\n<script src=\"https://polyfill.io/v3/polyfill.min.js?features=Promise,Array.from\"></script>\n```\n\n### 2. ä½¿ç”¨ core-js\n\n```javascript\n// å®‰è£…\nnpm install core-js\n\n// ä½¿ç”¨\nimport 'core-js/features/array/includes';\nimport 'core-js/features/promise';\n```\n\n### 3. ä½¿ç”¨ @babel/polyfillï¼ˆå·²åºŸå¼ƒï¼‰\n\n```javascript\n// æ–°çš„æ¨èæ–¹å¼\nnpm install core-js regenerator-runtime\n\n// babel.config.js\nmodule.exports = {\n  presets: [\n    ['@babel/preset-env', {\n      useBuiltIns: 'usage',\n      corejs: 3\n    }]\n  ]\n};\n```\n\n## æœ€ä½³å®è·µ\n\n### 1. æŒ‰éœ€åŠ è½½\n\n```javascript\n// åªåœ¨éœ€è¦æ—¶åŠ è½½ polyfill\nif (!window.Promise) {\n  // åŠ¨æ€åŠ è½½ Promise polyfill\n  loadScript('promise-polyfill.js');\n}\n```\n\n### 2. ä½¿ç”¨ polyfill.io æœåŠ¡\n\n```html\n<!-- æ ¹æ®ç”¨æˆ·æµè§ˆå™¨è‡ªåŠ¨è¿”å›éœ€è¦çš„ polyfill -->\n<script src=\"https://polyfill.io/v3/polyfill.min.js\"></script>\n```\n\n### 3. ç‰¹æ€§æ£€æµ‹\n\n```javascript\n// ä½¿ç”¨ç‰¹æ€§æ£€æµ‹è€Œä¸æ˜¯æµè§ˆå™¨æ£€æµ‹\nfunction loadPolyfills() {\n  const polyfills = [];\n  \n  if (!window.Promise) {\n    polyfills.push(import('promise-polyfill'));\n  }\n  \n  if (!Array.prototype.includes) {\n    polyfills.push(import('array-includes-polyfill'));\n  }\n  \n  return Promise.all(polyfills);\n}\n\n// åŠ è½½å®Œ polyfill åå†å¯åŠ¨åº”ç”¨\nloadPolyfills().then(() => {\n  // å¯åŠ¨åº”ç”¨\n  startApp();\n});\n```\n\n## å¸¸ç”¨çš„ Polyfill åº“\n\n1. **core-js** - æœ€å…¨é¢çš„ polyfill åº“\n2. **polyfill.io** - è‡ªåŠ¨åŒ– polyfill æœåŠ¡\n3. **es5-shim/es6-shim** - ES5/ES6 polyfill\n4. **fetch-polyfill** - Fetch API polyfill\n5. **intersection-observer** - IntersectionObserver polyfill\n\n## æ³¨æ„äº‹é¡¹ âš ï¸\n\n1. **æ€§èƒ½å½±å“**ï¼šPolyfill ä¼šå¢åŠ ä»£ç ä½“ç§¯\n2. **é€‰æ‹©æ€§åŠ è½½**ï¼šåªåŠ è½½éœ€è¦çš„ polyfill\n3. **ç‰ˆæœ¬å…¼å®¹**ï¼šç¡®ä¿ polyfill æ”¯æŒç›®æ ‡æµè§ˆå™¨\n4. **åŸç”Ÿä¼˜å…ˆ**ï¼šä¼˜å…ˆä½¿ç”¨åŸç”Ÿå®ç°\n\n```javascript\n// å¥½çš„åšæ³•ï¼šå…ˆæ£€æµ‹å†æ·»åŠ \nif (!Array.prototype.flat) {\n  // æ·»åŠ  polyfill\n}\n\n// é¿å…ï¼šç›´æ¥è¦†ç›–\nArray.prototype.flat = function() { /* ... */ };\n```\n\næ€»ä¹‹ï¼ŒPolyfill æ˜¯å‰ç«¯å¼€å‘ä¸­å®ç°å‘åå…¼å®¹çš„é‡è¦æ‰‹æ®µï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨æ—§æµè§ˆå™¨ä¸­ä½¿ç”¨æ–°ç‰¹æ€§ï¼","tags":["å‰ç«¯å¼€å‘","æ¦‚å¿µè§£æ"],"categories":["å‰ç«¯çŸ¥è¯†å°å†Œ"]},{"title":"ã€ç§‹æ‹›å‡†å¤‡ã€‘é¢è¯•æ‰‹æ’•å¤§é›†åˆ","url":"/2025/07/22/ã€ç§‹æ‹›å¤‡æˆ˜ã€‘é¢è¯•æ‰‹æ’•å¤§é›†åˆ/","content":"\n# **æ‰€æœ‰éå†æ•°ç»„çš„æ–¹æ³•**\n\n\n\n## forEach\n\n```JavaScript\n// è‡ªå®šä¹‰ forEach å‡½æ•°ï¼Œæ·»åŠ åˆ° Array åŸå‹é“¾\nArray.prototype.myForEach = function (callback, thisArg) {\n\n    // ç±»å‹æ£€æŸ¥ï¼šç¡®ä¿ callback æ˜¯ä¸€ä¸ªå‡½æ•°\n    if (typeof callback !== 'function') {\n        throw new TypeError('ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°');\n    }\n\n    // éå†æ•°ç»„ï¼Œè°ƒç”¨ callback å‡½æ•°\n    for (let i = 0; i < this.length; i++) {\n        // å¦‚æœæ•°ç»„çš„å½“å‰å…ƒç´ æ˜¯ undefined æˆ– null, åˆ™è·³è¿‡\n        if (i in this) {//å¯¹äºæ•°ç»„è€Œè¨€ï¼Œinè¿ç®—ç¬¦ç”¨äºæ£€æŸ¥æ˜¯å¦æœ‰è¿™ä¸ªç´¢å¼•å€¼\n            callback.call(thisArg, this[i], i, this);\n        }\n    }\n};\n```\n\n## map\n\n```JavaScript\n// è‡ªå®šä¹‰ Map å‡½æ•°ï¼Œæ·»åŠ åˆ° Array åŸå‹é“¾\nArray.prototype.myMap = function (callback) {\n\n    // ç±»å‹æ£€æŸ¥ï¼šç¡®ä¿ callback æ˜¯ä¸€ä¸ªå‡½æ•°\n    if (typeof callback !== 'function') {\n        throw new TypeError('ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°');\n    }\n    let res = [];\n\n    // éå†æ•°ç»„ï¼Œè°ƒç”¨ callback å‡½æ•°\n    for (let i = 0; i < this.length; i++) {\n        // å¦‚æœæ•°ç»„çš„å½“å‰å…ƒç´ æ˜¯ undefined æˆ– null, åˆ™è·³è¿‡\n        if (i in this) {\n            res.push(callback(this[i], i, this));\n        }\n    }\n    return res\n};\n```\n\n## Filter\n\n```JavaScript\nArray.prototype.my_filter = function (cb) {\n    let newArr = []\n    for (var i = 0; i < this.length; i++) {\n        if (cb(this[i], i, this)) {\n            newArr.push(this[i])\n        }\n    }\n    return newArr\n}\n```\n\n## every(åˆ¤æ–­æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯å¦éƒ½æ»¡è¶³æŸä¸ªæ¡ä»¶)\n\n```JavaScript\nArray.prototype.my_every = function (cb) {\n    for (let i = 0; i < this.length; i++) {\n        if (!cb(this[i], i, this)) {\n            return false;\n        }\n    }\n    return true;\n}\n```\n\n## someï¼ˆåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªå…ƒç´ æ»¡è¶³æŸä¸ªæ¡ä»¶ï¼‰\n\n```JavaScript\nArray.prototype.my_some = function (cb) {\n    for (let i = 0; i < this.length; i++) {\n        if (cb(this[i], i, this)) {\n            return true;\n        }\n    }\n    return false;\n}\n```\n\n## reduce\n\n```JavaScript\nArray.prototype.my_reduce = function (cb, ...args) {\n    let start, index = 0\n    if (args.length) {\n        start = args[0]\n    } else {\n        start = this[0];\n        index = 1\n    }\n    for (let i = index; i < this.length; i++) {\n        start = cb(start, this[i], i, this);\n    }\n    return start;\n}\n```\n\n## includes\n\n```JavaScript\nArray.prototype.my_includes = function (item, ...args) {\n    let index\n    if (args.length && !Number.isNaN(Number(args[0])) && Number(args[0])>0) {\n        index = Number(args[0])\n    } else {\n        index = 0;\n    }\n    for (let i = index; i < this.length; i++) {\n        if (this[i] === item) return true;\n    }\n    return false\n}\n```\n\n## splice\n\n```JavaScript\nArray.prototype.mySplice = function (start, len, ...args) {\n    let newArr = [], resArr = [];\n    if (arguments.length === 0) return resArr;\n\n    if (typeof len === 'undefined') {\n        len = 0;\n    }\n    if (typeof start === 'undefined') {\n        start = 0;\n    } else if (start < 0) {\n        start = start + this.length;\n        start = start < 0 ? 0 : start;\n    } else if (start >= this.length) {\n        start = this.length;\n    }\n\n    for (let i = 0; i < this.length; ++i) {\n        if (i < start || i >= start + len) {\n            newArr.push(this[i]);\n        } else {\n            resArr.push(this[i]);\n        }\n        if (i === start || start + i === this.length * 2 - 1) {\n            newArr.push(...args);\n        }\n    }\n    while (this.length) {\n        this.pop();\n    }\n    this.push(...newArr);\n    return resArr;\n}\n```\n\n# JSå†…ç½®æ–¹æ³•ã€å¯¹è±¡ä»¥åŠè¿ç®—ç¬¦\n\n## newè¿ç®—ç¬¦\n\n```javascript\nfunction myNew (Func, ...arg){\n        if (fn.prototype === undefined) throw new TypeError('function is not a constructor');\n        let obj = {}  //å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡ã€‚\n        obj.__proto__ = Func.prototype  \n        //å°†Func.prototypeèµ‹å€¼ä¸ºå¯¹è±¡çš„__proto__å±æ€§,å³åŸå‹é“¾çš„æ¦‚å¿µ\n        let res = Func.call(obj, ...arg) //æ›´æ”¹Funcçš„thisæŒ‡å‘\n        return res instanceof Object ? res : obj \n}\n```\n\n## æ‰‹æ’•curry\n\n```javascript\nconst my_curry = (fn, ...args) =>\n    args.length >= fn.length\n        ? fn(...args)\n        : (...args1) => my_curry(fn, ...args, ...args1);\n\nfunction adder(x, y, z) {\n    return x + y + z;\n}\nconst add = my_curry(adder);\nconsole.log(add(1, 2, 3));  //6\nconsole.log(add(1)(2)(3));  //6\nconsole.log(add(1, 2)(3));  //6\nconsole.log(add(1)(2, 3));  //6\n```\n\n## æ‰‹å†™composeå‡½æ•°\n\n```JavaScript\nconst compose = (...fns)=>(x)=>fns.reduceRight((v, fn)=>fn(v),x);\nconst doubleAndSuare = compose(double, square);//å…ˆç¿»å€å†å¹³æ–¹\nconsole.log(doubleAndSuare(3));\n```\n\n## æ‰‹æ’•vue3å“åº”å¼ä»£ç†\n\n```javascript\n//æµ‹è¯•ä»£ç \nclass Depend {\n  constructor() {\n    this.reactiveFns = new Set()//ä¾èµ–ç»„\n  }\n\n  // æ›´å¥½çš„æ”¶é›†ä¾èµ–\n  depend() {\n    if (activeReactiveFn) this.reactiveFns.add(activeReactiveFn)\n  }\n\n  //å¯¹æ‰€æœ‰ä¾èµ–è¿›è¡Œç»Ÿä¸€é€šçŸ¥å¤„ç†\n  notify() {\n    console.log(this.reactiveFns)\n    this.reactiveFns.forEach(fn => {\n      //éå†ä¾èµ–å¤„ç†\n      if (fn) fn()\n    })\n  }\n}\n\n// å°è£…å“åº”å¼å‡½æ•°\nlet activeReactiveFn = null\nfunction watchFn(fn) {\n  activeReactiveFn = fn\n  fn()\n  activeReactiveFn = null\n}\n\n// å°è£…ä¸€ä¸ªè·å–dependå‡½æ•°\nconst targetMap = new WeakMap()\nfunction getDepend(target, key) {\n  // 1ã€æ ¹æ®targetå¯¹è±¡è·å–mapçš„è¿‡ç¨‹\n  let map = targetMap.get(target)\n  if (!map) {\n    map = new Map()\n    targetMap.set(target, map)\n  }\n  // 2ã€æ ¹æ®å¯¹è±¡å±æ€§è·å–dependä¾èµ–\n  let depend = map.get(key)\n  if (!depend) {\n    depend = new Depend()\n    map.set(key, depend)\n  }\n  return depend\n}\n\n\n//ä½¿ç”¨Proxyç›‘å¬å¯¹è±¡å˜åŒ–\nfunction reactive(obj) {\n  return new Proxy(obj, {\n    get: function (target, key, receiver) {\n      const depend = getDepend(target, key)\n      depend.depend()\n      return Reflect.get(target, key, receiver)\n    },\n    set: function (target, key, newValue, receiver) {\n      Reflect.set(target, key, newValue, receiver)\n      const depend = getDepend(target, key)\n      depend.notify()\n    }\n  })\n}\n\nconst obj = {\n  name: \"coderwhy\",//dependå®ä¾‹å¯¹è±¡\n  age: 18//dependå®ä¾‹å¯¹è±¡\n}\n\nconst info = {\n  name:\"å°ä½™\",\n  age:18\n}\n//å“åº”å¼å¼€å…³åª’ä»‹\nconst objRef = reactive({\n  name: \"coderwhy\",\n  age: 18\n})\nconst infoRef = reactive({\n  name:\"å°ä½™\",\n  age:18\n})\n\nwatchFn(() => {\n  console.log(infoRef.name);  \n})\nwatchFn(() => {\n  console.log(objRef.name);  \n})\n\ninfoRef.name = 'å“åº”å¼-å°ä½™'\nobjRef.name = 'å“åº”å¼-coderwhy'\n\n// å°ä½™\n// coderwhy\n// Set(1) { [Function (anonymous)] }\n// å“åº”å¼-å°ä½™\n// Set(1) { [Function (anonymous)] }\n// å“åº”å¼-coderwhy\n```\n\n## æ‰‹æ’•instanceof\n\n```sql\nconst myInstanceOf=(Left,Right)=>{\n  if(!Left){\n    return false\n  }\n  while(Left){\n    if(Left.__proto__===Right.prototype){\n      return true\n    }else{\n      Left=Left.__proto__\n    }\n  }\n  return false\n}\n\n//éªŒè¯\nconsole.log(myInstanceOf({},Array));  //false\n```\n\n## callï¼Œbindï¼Œapply\n\n```javascript\nfunction foo(x,y){\n  console.log(this.a,x+y);\n}\n\nconst obj={\n  a:1\n}\n\nFunction.prototype.myCall=function(context,...args){\n  if(typeof this !== 'function')  return new TypeError('is not a function')\n  const fn = Symbol('fn') //ä½¿ç”¨Symbolå°½å¯èƒ½é™ä½myCallå¯¹å…¶ä»–çš„å½±å“\n  context[fn] = this  //thisæŒ‡å‘foo\n  const res = context[fn](...args)  //è§£æ„ï¼Œè°ƒç”¨fn\n  delete context[fn]  //ä¸è¦å¿˜äº†åˆ é™¤objä¸Šçš„å·¥å…·å‡½æ•°fn\n  return res  //å°†ç»“æœè¿”å›\n}\n\n//éªŒè¯\nfoo.myCall(obj,1,2)   //1,3\n\nfunction foo(x,y){\n  console.log(this.a,x+y);\n}\n\nconst obj={\n  a:1\n}\n\nFunction.prototype.myApply=function(context,args){\n  if(typeof this !== 'function')  return new TypeError('is not a function')\n  const fn = Symbol('fn') //ä½¿ç”¨Symbolå°½å¯èƒ½é™ä½myCallå¯¹å…¶ä»–çš„å½±å“\n  context[fn] = this  //thisæŒ‡å‘foo\n  const res = context[fn](...args)  //è§£æ„ï¼Œè°ƒç”¨fn\n  delete context[fn]  //ä¸è¦å¿˜äº†åˆ é™¤objä¸Šçš„å·¥å…·å‡½æ•°fn\n  return res  //å°†ç»“æœè¿”å›\n}\n\n//éªŒè¯\nfoo.myApply(obj,1,2)   //1,3\n\nfunction foo(x,y,z){\n  this.name='zt'\n  console.log(this.a,x+y+z);\n}\n\nconst obj={\n  a:1\n}\n\nFunction.prototype.myBind=function(context,...args){\n  if(typeof this !== 'function')  return new TypeError('It is not a function');\n  context = context || window; // ä¸Šä¸‹æ–‡ç¯å¢ƒ\n  const _this = this; // å½“å‰çš„å‡½æ•°çš„ä¸Šä¸‹æ–‡this\n  return function F(...arg) {\n    //åˆ¤æ–­è¿”å›å‡ºå»çš„Fæœ‰æ²¡æœ‰è¢«newï¼Œæœ‰å°±è¦æŠŠfooç»™åˆ°newå‡ºæ¥çš„å¯¹è±¡\n    if (this instanceof F) {\n       return new _this(...args, ...arg);\n    } else {\n       _this.call(this, ...args, ...arg);\n    }\n  }\n}\n\n//éªŒè¯\nconst bar=foo.myBind(obj,1,2)\nconsole.log(new bar(3));   //undefined 6  foo { name: 'zt' }\n```\n\n## å€¼ç›¸ç­‰\n\n```javascript\nfunction compare(data1, data2) {\n  if (typeof data1 != typeof data2) {\n    return false;\n  }\n\n  if (typeof data1 != \"object\" && typeof data1 == typeof data2) {\n    return data1 === data2;\n  }\n\n  if ((!data1 instanceof Array && data2 instanceof Array) || (data1 instanceof Array && !data2 instanceof Array)) {\n    return false;\n  } else if (data1 instanceof Array  && data2 instanceof Array) {\n    if (data1.length == data2.length) {\n      for (let i = 0; i < data1.length; i++) {\n        if (!compare(data1[i], data2[i])) {\n          return false;\n        }\n      }\n    } else {\n      return false;\n    }\n  } else {\n      if (Object.keys(data1).length == Object.keys(data2).length) {\n      for (let key in data1) {\n        if (!data2[key] || !compare(data1[key], data2[key])) {\n          return false;\n        }\n      }\n    } else {\n      return false;\n    }\n  }\n  return true;\n}\n```\n\n## æ·±æ‹·è´\n\n```javascript\nfunction isObject(value) {\n  const valueType = typeof value\n  return (value !== null) && (valueType === \"object\" || valueType === \"function\")\n}\n\nfunction deepClone(originValue) {\n  // åˆ¤æ–­ä¼ å…¥çš„originValueæ˜¯å¦æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹\n  if (!isObject(originValue)) {\n    return originValue\n  }\n\n  const newObject = {}\n  for (const key in originValue) {\n    newObject[key] = deepClone(originValue[key])\n  }\n  //è¿”å›é€šè¿‡é€’å½’æ·±å±‚éå†èµ‹å€¼åï¼Œå…¨æ–°çš„æ•°æ®å¯¹è±¡\n  return newObject\n}\n```\n\n## å®ç°Object.create()\n\nåˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå®šä¹‰å…¶åŸå‹å¯¹è±¡å¹¶è®¾ç½®å…¶æšä¸¾å±æ€§\n\n```javascript\n// proto å¯ä»¥æ˜¯object æˆ–è€…function\nObject.myCreate = function (proto, defineProperties){\n    if((typeof proto === 'object' && proto !== null) || typeof proto === 'function'){\n        let obj = {};\n\n        // obj.__proto__ = proto;\n        Object.setPrototypeOf(obj, proto);\n        Object.defineProperty(obj, defineProperties);\n        return obj;\n    }else {\n        throw new TypeError('ç±»å‹é”™è¯¯');\n    }\n}\n```\n\n## å®ç°Object.assignï¼ˆæµ…æ‹·è´ï¼‰\n\n```javascript\nfunction myAssign(target,...objs){\n    if(target === null || target === undefined){\n        throw new TypeError(\"can not convert null or undefined to object\")\n    }\n    let res = Object(target)\n    objs.forEach(obj => {\n        'use strict'\n        if(obj != null && obj != undefined){\n            for(let key in obj){\n                //hasOwnPropertyç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå±æ€§æ˜¯å®šä¹‰åœ¨å¯¹è±¡æœ¬èº«è€Œä¸æ˜¯ç»§æ‰¿è‡ªåŸå‹é“¾çš„\n                if(Object.prototype.hasOwnProperty.call(obj,key)){\n                    res[key] = obj[key]\n                }\n            }\n        }\n    })\n    return res\n}\nObject.defineProperty(Object,'myAssign',{\n    value: myAssign,\n    writable: true,\n    configurable: true,\n    enumerable: false\n})\n```\n\n## trimæ–¹æ³•\n\n```javascript\nfunction myTrim(str) {\n  const reg = /^\\s+|\\s+$/g;\n  return str.replace(reg, '');\n}\n```\n\n## æ¨¡æ¿å­—ç¬¦ä¸²\n\n```javascript\nconst render = (template, data) => {\n    const reg = /\\$\\{(.*?)\\}/g;\n    template = template.replace(reg, (match, key) => {\n        let keys = key.trim().split('.');\n        return keys.reduce((obj, k) => obj?.[k], data) || '';\n    })\n    return template;\n}\n```\n\n## sleepå‡½æ•°\n\n```javascript\nfunction sleep(ms) {\n    return new Promise((resolve) => {\n        setTimeout(() => {\n            console.log('sleep...')\n            resolve()\n        }, ms);\n    })\n}\n\nasync function test(){\n    console.log('1');\n    await sleep(400)\n    console.log('2')\n}\n\ntest();\n```\n\n## åˆ©ç”¨setTimeoutå®ç°setInterval\n\n```javascript\nfunction coustomSetInterval(callback, time) {\n    let intervalId = null;\n    function loop() {\n        intervalId = setTimeout(() => {\n            callback();\n            loop();\n        }, time)\n    }\n    loop();\n    return () => clearTimeout(intervalId)\n}\nconst interval = coustomSetInterval(() => {\n    console.log('æƒ³ä½ äº†')\n}, 1000)\n\nsetTimeout(() => {\n    interval()\n}, 5000)\n```\n\n# ğŸš€ Promise æºç å®ç°å®Œå…¨æŒ‡å— - ä»é›¶æ‰‹å†™ Promise\n\n> ğŸ¯ **é˜…è¯»æœ¬èŠ‚ä½ å°†æ”¶è·**ï¼š\n>\n> - æ·±å…¥ç†è§£ Promise å†…éƒ¨è¿è¡Œæœºåˆ¶\n> - æ‰‹å†™ä¸€ä¸ªç¬¦åˆ Promise/A+ è§„èŒƒçš„ Promise\n> - æŒæ¡é¢è¯•ä¸­ Promise ç›¸å…³çš„æ ¸å¿ƒè€ƒç‚¹\n> - ç†è§£ async/await çš„å®ç°åŸç†\n\n## ğŸ“Œ å¼€ç¯‡ï¼šä¸ºä»€ä¹ˆè¦æ‰‹å†™ Promiseï¼Ÿ\n\nåœ¨é¢è¯•ä¸­ï¼ŒPromise ç›¸å…³çš„é¢˜ç›®å¯ä»¥è¯´æ˜¯å¿…è€ƒé¢˜ã€‚ä½†å¾ˆå¤šåŒå­¦åªä¼šç”¨ï¼Œä¸çŸ¥é“å…¶å†…éƒ¨åŸç†ã€‚ä»Šå¤©æˆ‘ä»¬å°±ä¸€èµ·æ¥æ­å¼€ Promise çš„ç¥ç§˜é¢çº±ï¼Œæ‰‹å†™ä¸€ä¸ªå®Œæ•´çš„ Promiseï¼\n\n## ä¸€ã€Promise åŸºç¡€æ¶æ„ - æ­å»ºåœ°åŸº ğŸ—ï¸\n\n### 1.1 æœ€ç®€å•çš„ Promise ç»“æ„\n\næˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„ç»“æ„å¼€å§‹ï¼Œå°±åƒç›–æˆ¿å­è¦å…ˆæ‰“åœ°åŸºï¼š\n\n```javascript\nclass MyPromise {\n    constructor(executor) {\n        // executor æ˜¯ä½¿ç”¨è€…ä¼ å…¥çš„å‡½æ•°ï¼Œå½¢å¦‚ (resolve, reject) => {}\n        \n        // å®šä¹‰ resolve å‡½æ•°\n        const resolve = (value) => {\n            console.log('è°ƒç”¨äº† resolveï¼Œå€¼ä¸ºï¼š', value);\n        }\n        \n        // å®šä¹‰ reject å‡½æ•°\n        const reject = (reason) => {\n            console.log('è°ƒç”¨äº† rejectï¼ŒåŸå› ä¸ºï¼š', reason);\n        }\n        \n        // ç«‹å³æ‰§è¡Œ executor\n        executor(resolve, reject);\n    }\n}\n\n// æµ‹è¯•ä¸€ä¸‹\nnew MyPromise((resolve, reject) => {\n    resolve('æˆåŠŸå•¦ï¼');\n});\n```\n\n### 1.2 Promise çš„ä¸‰ç§çŠ¶æ€ - çŠ¶æ€æœº ğŸš¦\n\nPromise å°±åƒä¸€ä¸ªæœ‰ä¸‰ç§çŠ¶æ€çš„äº¤é€šç¯ï¼š\n\n- ğŸŸ¡ **pending**ï¼ˆç­‰å¾…æ€ï¼‰ï¼šåˆå§‹çŠ¶æ€ï¼Œæ—¢ä¸æ˜¯æˆåŠŸï¼Œä¹Ÿä¸æ˜¯å¤±è´¥\n- ğŸŸ¢ **fulfilled**ï¼ˆæˆåŠŸæ€ï¼‰ï¼šæ“ä½œæˆåŠŸå®Œæˆ\n- ğŸ”´ **rejected**ï¼ˆå¤±è´¥æ€ï¼‰ï¼šæ“ä½œå¤±è´¥\n\n**é‡è¦ç‰¹æ€§**ï¼š\n\n1. çŠ¶æ€åªèƒ½ä» `pending` â†’ `fulfilled` æˆ– `pending` â†’ `rejected`\n2. çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå°±æ°¸è¿œä¸ä¼šå†å˜ï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå« \"Promise\" - æ‰¿è¯ºï¼‰\n\nè®©æˆ‘ä»¬åŠ ä¸ŠçŠ¶æ€ç®¡ç†ï¼š\n\n```javascript\nclass MyPromise {\n    constructor(executor) {\n        // åˆå§‹çŠ¶æ€ä¸º pending\n        this.status = 'pending';\n        // æˆåŠŸçš„å€¼\n        this.value = undefined;\n        // å¤±è´¥çš„åŸå› \n        this.reason = undefined;\n        \n        // resolve å‡½æ•°ï¼šå°†çŠ¶æ€ä» pending æ”¹ä¸º fulfilled\n        const resolve = (value) => {\n            // åªæœ‰åœ¨ pending çŠ¶æ€æ‰èƒ½æ”¹å˜çŠ¶æ€ï¼ˆä¿è¯çŠ¶æ€åªæ”¹å˜ä¸€æ¬¡ï¼‰\n            if (this.status === 'pending') {\n                this.status = 'fulfilled';\n                this.value = value;\n            }\n        }\n        \n        // reject å‡½æ•°ï¼šå°†çŠ¶æ€ä» pending æ”¹ä¸º rejected\n        const reject = (reason) => {\n            if (this.status === 'pending') {\n                this.status = 'rejected';\n                this.reason = reason;\n            }\n        }\n        \n        // ç«‹å³æ‰§è¡Œ executorï¼Œå¹¶ä¼ å…¥ resolve å’Œ reject\n        try {\n            executor(resolve, reject);\n        } catch (error) {\n            // å¦‚æœæ‰§è¡Œå™¨æŠ›å‡ºå¼‚å¸¸ï¼ŒPromise åº”è¯¥è¢«æ‹’ç»\n            reject(error);\n        }\n    }\n}\n```\n\n## äºŒã€å®ç° then æ–¹æ³• - Promise çš„çµé­‚ âœ¨\n\n### 2.1 then æ–¹æ³•çš„åŸºæœ¬å®ç°\n\n`then` æ–¹æ³•æ˜¯ Promise çš„æ ¸å¿ƒï¼Œå®ƒç”¨æ¥æ³¨å†Œå½“ Promise çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°ã€‚\n\n```javascript\nclass MyPromise {\n    // ... å‰é¢çš„ä»£ç \n\n    then(onFulfilled, onRejected) {\n        // å¦‚æœçŠ¶æ€æ˜¯ fulfilledï¼Œæ‰§è¡ŒæˆåŠŸå›è°ƒ\n        if (this.status === 'fulfilled') {\n            onFulfilled(this.value);\n        }\n        \n        // å¦‚æœçŠ¶æ€æ˜¯ rejectedï¼Œæ‰§è¡Œå¤±è´¥å›è°ƒ\n        if (this.status === 'rejected') {\n            onRejected(this.reason);\n        }\n    }\n}\n\n// æµ‹è¯•åŒæ­¥æƒ…å†µ\nconst promise = new MyPromise((resolve, reject) => {\n    resolve('æˆåŠŸï¼');\n});\n\npromise.then(\n    value => console.log('æˆåŠŸ:', value),\n    reason => console.log('å¤±è´¥:', reason)\n);\n```\n\n### 2.2 å¤„ç†å¼‚æ­¥æƒ…å†µ - å‘å¸ƒè®¢é˜…æ¨¡å¼ ğŸ“¢\n\nä¸Šé¢çš„ä»£ç æœ‰ä¸ªé—®é¢˜ï¼šå¦‚æœ executor ä¸­æœ‰å¼‚æ­¥æ“ä½œæ€ä¹ˆåŠï¼Ÿ\n\n```javascript\nconst promise = new MyPromise((resolve, reject) => {\n    setTimeout(() => {\n        resolve('å¼‚æ­¥æˆåŠŸï¼');\n    }, 1000);\n});\n\n// æ­¤æ—¶çŠ¶æ€è¿˜æ˜¯ pendingï¼Œthen æ–¹æ³•ä¸ä¼šæ‰§è¡Œä»»ä½•å›è°ƒï¼\npromise.then(value => console.log(value));\n```\n\nè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨**å‘å¸ƒè®¢é˜…æ¨¡å¼**ï¼Œå…ˆæŠŠå›è°ƒå­˜èµ·æ¥ï¼Œç­‰çŠ¶æ€æ”¹å˜æ—¶å†æ‰§è¡Œï¼š\n\n```javascript\nclass MyPromise {\n    constructor(executor) {\n        this.status = 'pending';\n        this.value = undefined;\n        this.reason = undefined;\n        \n        // å­˜å‚¨æˆåŠŸå›è°ƒçš„æ•°ç»„\n        this.onFulfilledCallbacks = [];\n        // å­˜å‚¨å¤±è´¥å›è°ƒçš„æ•°ç»„\n        this.onRejectedCallbacks = [];\n        \n        const resolve = (value) => {\n            if (this.status === 'pending') {\n                this.status = 'fulfilled';\n                this.value = value;\n                // çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰§è¡Œæ‰€æœ‰çš„æˆåŠŸå›è°ƒ\n                this.onFulfilledCallbacks.forEach(fn => fn());\n            }\n        }\n        \n        const reject = (reason) => {\n            if (this.status === 'pending') {\n                this.status = 'rejected';\n                this.reason = reason;\n                // çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰§è¡Œæ‰€æœ‰çš„å¤±è´¥å›è°ƒ\n                this.onRejectedCallbacks.forEach(fn => fn());\n            }\n        }\n        \n        try {\n            executor(resolve, reject);\n        } catch (error) {\n            reject(error);\n        }\n    }\n    \n    then(onFulfilled, onRejected) {\n        if (this.status === 'fulfilled') {\n            onFulfilled(this.value);\n        }\n        \n        if (this.status === 'rejected') {\n            onRejected(this.reason);\n        }\n        \n        // å¦‚æœæ˜¯ pending çŠ¶æ€ï¼Œå°†å›è°ƒå­˜å‚¨èµ·æ¥\n        if (this.status === 'pending') {\n            this.onFulfilledCallbacks.push(() => {\n                onFulfilled(this.value);\n            });\n            this.onRejectedCallbacks.push(() => {\n                onRejected(this.reason);\n            });\n        }\n    }\n}\n```\n\n### 2.3 é“¾å¼è°ƒç”¨çš„å®ç° - then è¿”å› Promise ğŸ”—\n\nPromise æœ€å¼ºå¤§çš„ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯é“¾å¼è°ƒç”¨ã€‚è¦å®ç°é“¾å¼è°ƒç”¨ï¼Œ`then` æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼š\n\n```javascript\nthen(onFulfilled, onRejected) {\n    // then æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Promise\n    return new MyPromise((resolve, reject) => {\n        // å°è£…ä¸€ä¸ªæ‰§è¡Œå‡½æ•°ï¼Œç»Ÿä¸€å¤„ç†æˆåŠŸå’Œå¤±è´¥çš„æƒ…å†µ\n        const fulfilledMicrotask = () => {\n            // ä½¿ç”¨ queueMicrotask åˆ›å»ºå¾®ä»»åŠ¡ï¼Œä¿è¯å¼‚æ­¥æ‰§è¡Œ\n            queueMicrotask(() => {\n                try {\n                    const x = onFulfilled(this.value);\n                    // å¤„ç†è¿”å›å€¼ï¼ˆè¯¦è§ä¸‹ä¸€èŠ‚ï¼‰\n                    resolvePromise(promise2, x, resolve, reject);\n                } catch (error) {\n                    reject(error);\n                }\n            });\n        };\n        \n        const rejectedMicrotask = () => {\n            queueMicrotask(() => {\n                try {\n                    const x = onRejected(this.reason);\n                    resolvePromise(promise2, x, resolve, reject);\n                } catch (error) {\n                    reject(error);\n                }\n            });\n        };\n        \n        if (this.status === 'fulfilled') {\n            fulfilledMicrotask();\n        } else if (this.status === 'rejected') {\n            rejectedMicrotask();\n        } else if (this.status === 'pending') {\n            this.onFulfilledCallbacks.push(fulfilledMicrotask);\n            this.onRejectedCallbacks.push(rejectedMicrotask);\n        }\n    });\n}\n```\n\n### 2.4 å¤„ç† then çš„è¿”å›å€¼ - resolvePromise ğŸ¯\n\nè¿™æ˜¯å®ç° Promise æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œéœ€è¦å¤„ç†å„ç§æƒ…å†µï¼š\n\n```javascript\nfunction resolvePromise(promise2, x, resolve, reject) {\n    // å¦‚æœ x === promise2ï¼Œä¼šé€ æˆå¾ªç¯å¼•ç”¨\n    if (x === promise2) {\n        return reject(new TypeError('Chaining cycle detected'));\n    }\n    \n    // å¦‚æœ x æ˜¯ Promise å®ä¾‹\n    if (x instanceof MyPromise) {\n        // ç­‰å¾… x çš„çŠ¶æ€æ”¹å˜ï¼Œç„¶åé€’å½’å¤„ç†\n        x.then(\n            value => resolvePromise(promise2, value, resolve, reject),\n            reason => reject(reason)\n        );\n        return;\n    }\n    \n    // å¦‚æœ x æ˜¯å¯¹è±¡æˆ–å‡½æ•°ï¼ˆå¯èƒ½æ˜¯ thenableï¼‰\n    if (x !== null && (typeof x === 'object' || typeof x === 'function')) {\n        let then;\n        try {\n            then = x.then;\n        } catch (error) {\n            return reject(error);\n        }\n        \n        // å¦‚æœ then æ˜¯å‡½æ•°ï¼Œè®¤ä¸º x æ˜¯ thenable\n        if (typeof then === 'function') {\n            let called = false; // é˜²æ­¢å¤šæ¬¡è°ƒç”¨\n            try {\n                then.call(\n                    x,\n                    value => {\n                        if (called) return;\n                        called = true;\n                        resolvePromise(promise2, value, resolve, reject);\n                    },\n                    reason => {\n                        if (called) return;\n                        called = true;\n                        reject(reason);\n                    }\n                );\n            } catch (error) {\n                if (called) return;\n                reject(error);\n            }\n        } else {\n            // å¦‚æœ then ä¸æ˜¯å‡½æ•°ï¼Œç›´æ¥ resolve\n            resolve(x);\n        }\n    } else {\n        // å¦‚æœ x æ˜¯æ™®é€šå€¼ï¼Œç›´æ¥ resolve\n        resolve(x);\n    }\n}\n```\n\n## ä¸‰ã€å®ç° Promise çš„é™æ€æ–¹æ³• ğŸ› ï¸\n\n### 3.1 Promise.resolve å’Œ Promise.reject\n\n```javascript\nclass MyPromise {\n    // å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæˆåŠŸçš„ Promise\n    static resolve(value) {\n        // å¦‚æœ value å·²ç»æ˜¯ Promiseï¼Œç›´æ¥è¿”å›\n        if (value instanceof MyPromise) {\n            return value;\n        }\n        \n        return new MyPromise(resolve => resolve(value));\n    }\n    \n    // å¿«é€Ÿåˆ›å»ºä¸€ä¸ªå¤±è´¥çš„ Promise\n    static reject(reason) {\n        return new MyPromise((resolve, reject) => reject(reason));\n    }\n}\n```\n\n### 3.2 Promise.all - ä¸€ä¸ªéƒ½ä¸èƒ½å°‘ ğŸ¯\n\n`Promise.all` æ¥æ”¶ä¸€ä¸ª Promise æ•°ç»„ï¼Œåªæœ‰å…¨éƒ¨æˆåŠŸæ‰æˆåŠŸï¼Œæœ‰ä¸€ä¸ªå¤±è´¥å°±å¤±è´¥ï¼š\n\n```javascript\nstatic all(promises) {\n    return new MyPromise((resolve, reject) => {\n        const results = [];\n        let completedCount = 0;\n        \n        // å¤„ç†ç©ºæ•°ç»„çš„æƒ…å†µ\n        if (promises.length === 0) {\n            resolve(results);\n            return;\n        }\n        \n        promises.forEach((promise, index) => {\n            // å°†é Promise å€¼è½¬æ¢ä¸º Promise\n            MyPromise.resolve(promise).then(\n                value => {\n                    results[index] = value;\n                    completedCount++;\n                    \n                    // æ‰€æœ‰ Promise éƒ½æˆåŠŸäº†\n                    if (completedCount === promises.length) {\n                        resolve(results);\n                    }\n                },\n                reason => {\n                    // æœ‰ä¸€ä¸ªå¤±è´¥å°±ç›´æ¥ reject\n                    reject(reason);\n                }\n            );\n        });\n    });\n}\n```\n\n### 3.3 Promise.race - è°å¿«ç”¨è° ğŸƒ\n\n```javascript\nstatic race(promises) {\n    return new MyPromise((resolve, reject) => {\n        // ç©ºæ•°ç»„æ°¸è¿œ pending\n        if (promises.length === 0) return;\n        \n        promises.forEach(promise => {\n            // è°å…ˆå®Œæˆå°±ç”¨è°çš„ç»“æœ\n            MyPromise.resolve(promise).then(resolve, reject);\n        });\n    });\n}\n```\n\n### 3.4 Promise.allSettled - ç­‰å¾…æ‰€æœ‰ç»“æœ ğŸ“Š\n\nä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œç­‰æ‰€æœ‰ Promise éƒ½æœ‰ç»“æœï¼š\n\n```javascript\nstatic allSettled(promises) {\n    return new MyPromise((resolve) => {\n        const results = [];\n        let settledCount = 0;\n        \n        if (promises.length === 0) {\n            resolve(results);\n            return;\n        }\n        \n        promises.forEach((promise, index) => {\n            MyPromise.resolve(promise).then(\n                value => {\n                    results[index] = { status: 'fulfilled', value };\n                    settledCount++;\n                    if (settledCount === promises.length) {\n                        resolve(results);\n                    }\n                },\n                reason => {\n                    results[index] = { status: 'rejected', reason };\n                    settledCount++;\n                    if (settledCount === promises.length) {\n                        resolve(results);\n                    }\n                }\n            );\n        });\n    });\n}\n```\n\n### 3.5 Promise.any - ä¸€ä¸ªæˆåŠŸå°±å¤Ÿäº† âœ…\n\n```javascript\nstatic any(promises) {\n    return new MyPromise((resolve, reject) => {\n        const errors = [];\n        let rejectedCount = 0;\n        \n        if (promises.length === 0) {\n            reject(new AggregateError([], 'All promises were rejected'));\n            return;\n        }\n        \n        promises.forEach((promise, index) => {\n            MyPromise.resolve(promise).then(\n                value => {\n                    // æœ‰ä¸€ä¸ªæˆåŠŸå°± resolve\n                    resolve(value);\n                },\n                reason => {\n                    errors[index] = reason;\n                    rejectedCount++;\n                    \n                    // å…¨éƒ¨å¤±è´¥æ‰ reject\n                    if (rejectedCount === promises.length) {\n                        reject(new AggregateError(errors, 'All promises were rejected'));\n                    }\n                }\n            );\n        });\n    });\n}\n```\n\n## å››ã€å®ç° catch å’Œ finally ğŸ£\n\n### 4.1 catch - é”™è¯¯å¤„ç†\n\n```javascript\ncatch(onRejected) {\n    // catch å°±æ˜¯ then çš„è¯­æ³•ç³–\n    return this.then(null, onRejected);\n}\n```\n\n### 4.2 finally - æ— è®ºå¦‚ä½•éƒ½è¦æ‰§è¡Œ\n\n```javascript\nfinally(callback) {\n    return this.then(\n        // æˆåŠŸæ—¶æ‰§è¡Œ callbackï¼Œä½†ä¼ é€’åŸæ¥çš„å€¼\n        value => MyPromise.resolve(callback()).then(() => value),\n        // å¤±è´¥æ—¶æ‰§è¡Œ callbackï¼Œä½†ä¼ é€’åŸæ¥çš„é”™è¯¯\n        reason => MyPromise.resolve(callback()).then(() => { throw reason })\n    );\n}\n```\n\n## äº”ã€async/await çš„å®ç°åŸç† ğŸ”®\n\n### 5.1 ç†è§£ async/await\n\n`async/await` æœ¬è´¨ä¸Šæ˜¯ Generator + Promise çš„è¯­æ³•ç³–ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š\n\n```javascript\n// async å‡½æ•°\nasync function fetchData() {\n    const user = await getUser();\n    const posts = await getPosts(user.id);\n    return posts;\n}\n\n// ç­‰ä»·äº\nfunction fetchData() {\n    return spawn(function* () {\n        const user = yield getUser();\n        const posts = yield getPosts(user.id);\n        return posts;\n    });\n}\n```\n\n### 5.2 å®ç°è‡ªåŠ¨æ‰§è¡Œå™¨\n\n```javascript\nfunction spawn(genFunc) {\n    return new Promise((resolve, reject) => {\n        const gen = genFunc();\n        \n        function step(nextFunc) {\n            let next;\n            try {\n                next = nextFunc();\n            } catch (error) {\n                return reject(error);\n            }\n            \n            // Generator å‡½æ•°æ‰§è¡Œå®Œæ¯•\n            if (next.done) {\n                return resolve(next.value);\n            }\n            \n            // å°† yield çš„å€¼åŒ…è£…æˆ Promiseï¼Œç„¶åé€’å½’æ‰§è¡Œ\n            Promise.resolve(next.value).then(\n                value => step(() => gen.next(value)),\n                error => step(() => gen.throw(error))\n            );\n        }\n        \n        // å¼€å§‹æ‰§è¡Œ\n        step(() => gen.next());\n    });\n}\n```\n\n### 5.3 ä¸€ä¸ªæ›´ç®€å•çš„å®ç°\n\n```javascript\nfunction asyncToGenerator(generatorFunc) {\n    return function (...args) {\n        const gen = generatorFunc.apply(this, args);\n        \n        return new Promise((resolve, reject) => {\n            function step(key, arg) {\n                let generatorResult;\n                \n                try {\n                    generatorResult = gen[key](arg);\n                } catch (error) {\n                    return reject(error);\n                }\n                \n                const { value, done } = generatorResult;\n                \n                if (done) {\n                    return resolve(value);\n                } else {\n                    return Promise.resolve(value).then(\n                        val => step('next', val),\n                        err => step('throw', err)\n                    );\n                }\n            }\n            \n            step('next');\n        });\n    };\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst getData = asyncToGenerator(function* () {\n    const data1 = yield fetch('/api/1');\n    const data2 = yield fetch('/api/2');\n    return [data1, data2];\n});\n\ngetData().then(result => console.log(result));\n```\n\n## ğŸ¯ é¢è¯•é«˜é¢‘è€ƒç‚¹æ€»ç»“\n\n1. **Promise çš„çŠ¶æ€æœºåˆ¶**ï¼šä¸‰ç§çŠ¶æ€ï¼Œåªèƒ½å•å‘æ”¹å˜ï¼Œä¸€æ—¦æ”¹å˜ä¸å¯é€†\n2. **then çš„é“¾å¼è°ƒç”¨**ï¼šthen è¿”å›æ–°çš„ Promiseï¼Œæ ¹æ®å›è°ƒå‡½æ•°çš„è¿”å›å€¼å†³å®šæ–° Promise çš„çŠ¶æ€\n3. **å¾®ä»»åŠ¡é˜Ÿåˆ—**ï¼šPromise çš„å›è°ƒåœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ‰§è¡Œ\n4. **é”™è¯¯å¤„ç†**ï¼šcatch èƒ½æ•è·å‰é¢æ‰€æœ‰ then ä¸­çš„é”™è¯¯\n5. **Promise.all vs Promise.race**ï¼šä¸€ä¸ªè¦å…¨éƒ¨æˆåŠŸï¼Œä¸€ä¸ªè¦æœ€å¿«å®Œæˆ\n6. **async/await åŸç†**ï¼šGenerator + è‡ªåŠ¨æ‰§è¡Œå™¨ + Promise\n\n# æ¨¡æ¿æ¸²æŸ“å¼•æ“\n\n```xml\n<!DOCTYPE html>\n<html lang=\"zh\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>æ¨¡æ¿æ¸²æŸ“ç¤ºä¾‹</title>\n</head>\n<body>\n    <div id=\"app\"></div>\n\n    <script src=\"script.js\"></script>\n</body>\n</html>\n// æ¸²æŸ“å¼•æ“\nfunction renderTemplate(template, data) {\n\n    // å¤„ç†æ¡ä»¶åˆ¤æ–­\n    template = template.replace(/{{\\s*#if\\s*(\\w+)\\s*}}([\\s\\S]*?){{\\s*\\/if\\s*}}/g, function (_, condition, content) {\n        return data[condition] ? content : '';\n    });\n\n    // å¤„ç†å¾ªç¯\n    template = template.replace(/{{\\s*#each\\s*(\\w+)\\s*}}([\\s\\S]*?){{\\s*\\/each\\s*}}/g, function (_, arrayKey, content) {\n        let result = '';\n        let array = data[arrayKey];\n        if (Array.isArray(array)) {\n            array.forEach((item, index) => {\n                // åˆ›å»ºä¸€ä¸ªç‹¬ç«‹ä½œç”¨åŸŸï¼Œé¿å…å†²çª\n                let temp = content;\n                // æ›¿æ¢æ¨¡æ¿å†…çš„ {{ this }} ä¸ºå¾ªç¯é¡¹\n                temp = temp.replace(/{{\\s*this\\s*}}/g, function () {\n                    return item;\n                });\n                // å¦‚æœæ˜¯å¯¹è±¡ï¼Œå¤„ç†å®ƒçš„å±æ€§\n                temp = temp.replace(/{{\\s*this\\.(\\w+)\\s*}}/g, function (_, prop) {\n                    return item[prop] || '';\n                });\n                // æ›¿æ¢å¾ªç¯ç´¢å¼•ï¼ˆå¦‚æœéœ€è¦ï¼‰\n                temp = temp.replace(/{{\\s*index\\s*}}/g, index);\n                // å°†å¤„ç†åçš„ç»“æœæ·»åŠ åˆ°æœ€ç»ˆç»“æœä¸­\n                result += temp;\n            });\n        }\n        return result;\n    });\n    // æ›¿æ¢å˜é‡ï¼Œä¸€å®šè¦æ”¾åˆ°æœ€åï¼ï¼\n    template = template.replace(/\\{\\{(.*?)\\}\\}/g, (match, key) => {\n        let keys = key.trim().split('.');\n        return keys.reduce((obj, k) => obj?.[k], data) || '';\n    })\n\n    return template;\n}\n\n// å®šä¹‰æ•°æ®\nconst data = {\n    name: \"å¼ ä¸‰\",\n    age: 25,\n    isEmployed: true,\n    occupation: \"å·¥ç¨‹å¸ˆ\",\n    hobbies: [\"é˜…è¯»\", \"ç¼–ç¨‹\", \"æ—…æ¸¸\"],\n    friends: [\n        { name: \"æå››\", age: 26 },\n        { name: \"ç‹äº”\", age: 24 }\n    ]\n};\n\n// å®šä¹‰æ¨¡æ¿\nconst template = `\n    <h1>ä¸ªäººä¿¡æ¯</h1>\n    <p>å§“å: {{ name }}</p>\n    <p>å¹´é¾„: {{ age }}</p>\n    <p>èŒä¸š: {{ occupation }}</p>\n\n    {{#if isEmployed}}\n        <p>å½“å‰çŠ¶æ€: åœ¨èŒ</p>\n    {{/if}}\n\n    <h2>å…´è¶£çˆ±å¥½</h2>\n    <ul>\n        {{#each hobbies}}\n            <li>{{ this }}</li>\n        {{/each}}\n    </ul>\n\n    <h2>æœ‹å‹åˆ—è¡¨</h2>\n    <ul>\n        {{#each friends}}\n            <li>{{ this.name }} - {{ this.age }} å²</li>\n        {{/each}}\n    </ul>\n`;\n\n// æ¸²æŸ“æ¨¡æ¿å¹¶æ’å…¥ HTML\ndocument.getElementById('app').innerHTML = renderTemplate(template, data);\n```\n\n# é˜²æŠ–æˆªæµ\n\n```JavaScript\nconst debounce = (fn, ms, Immediate = false) => {\n    // Immediateé€‰æ‹©æ˜¯å¦ç«‹å³æ‰§è¡Œ\n    let timer = null;\n    return function (...thisArgs) {\n        if (timer) {\n            clearTimeout(timer)\n        }\n        if (Immediate) {\n            let flag = !timer\n            flag && fn.apply(this, thisArgs)\n            timer = setTimeout(() => {\n                timer = null\n            }, ms)\n        } else {\n            timer = setTimeout(() => {\n                fn.apply(this, thisArgs)\n                timer = null\n            }, ms)\n        }\n    }\n}\n\nconst throttle = (fn, ms) => {\n    let timer = null;\n    return function (...thisArgs) {\n        if (!timer) {\n            fn.apply(this, thisArgs);\n            timer = setTimeout(() => {\n                timer = null;\n            }, ms);\n        }\n    }\n}\n```\n\n# æŠ€å·§\n\n## æ•°ç»„å»é‡\n\n```javascript\nlet arr = [1, 0, 2, 3, 4, 5, 2, 3, 4];\n//indexOfå»é‡\nfunction removeRepeat(arr) {\n  let res = [];\n  for (let i of arr) {\n    if (res.indexOf(i) == -1) {\n      res.push(i);\n    }\n  }\n  return res;\n}\n// set å»é‡\nfunction removeRepeat(arr) {\n  let res = new Set(arr);\n  return Array.from(res);\n}\n// forå¾ªç¯å»é‡\nfunction removeRepeat(arr) {\n  for (let i = 0; i < arr.length; i++) {\n    for (let j = i + 1; j < arr.length; j++) {\n      if (arr[i] == arr[j]) {\n        arr.splice(j, 1);\n        j--;\n      }\n    }\n  }\n  return arr;\n}\n// filter å»é‡\nfunction removeRepeat(arr) {\n  return arr.filter((item, index) => {\n    return arr.indexOf(item) == index;\n  });\n}\n// includes å»é‡\nfunction removeRepeat(arr) {\n  let res = [];\n  for (let i of arr) {\n    if (!res.includes(i)) {\n      res.push(i);\n    }\n  }\n  return res;\n}\nlet res = removeRepeat(arr);\nconsole.log(res);\n```\n\n## å¿«æ’å’Œå½’å¹¶\n\n```javascript\nArray.prototype.quicksort = function (l, r) {\n    if (l >= r) return this;\n    let key = this[l];\n    let i = l - 1, j = r + 1;\n    while (i < j) {\n        do i++; while (this[i] < key);\n        do j--; while (this[j] > key);\n        if (i < j) [this[i], this[j]] = [this[j], this[i]];\n    }\n    this.quicksort(l, j);\n    this.quicksort(j + 1, r);\n    return this;\n}\nlet arr = [5,8,3,6,4,2];\nconsole.log(arr.quicksort(0, arr.length-1));\n\n\nArray.prototype.mergesort = function (temp, l, r) {\n    if (l >= r) return this;\n    let mid = l + r >> 1;\n    this.mergesort(temp, l, mid);\n    this.mergesort(temp, mid + 1, r);\n\n    let i = l, j = mid + 1, k = 0;\n    while (i <= mid && j <= r) {\n        if (this[i] <= this[j]) temp[k++] = this[i++];\n        else temp[k++] = this[j++];\n    }\n    while (i <= mid) temp[k++] = this[i++];\n    while (j <= r) temp[k++] = this[j++];\n\n    for (let m = 0, n = l; n <= r; m++, n++) {\n        this[n] = temp[m];\n    }\n    return this;\n}\n\nlet arr = [7, 1, 0, 3, 0, 5, 6, 4];\nconsole.log(arr.mergesort(Array(arr.length).fill(0), 0, arr.length - 1));\n```\n\n## ä¸‹åˆ’çº¿å’Œé©¼å³°ç›¸äº’è½¬æ¢\n\n```javascript\n//æ–¹å¼ä¸€ï¼šæ“ä½œå­—ç¬¦ä¸²æ•°ç»„\nfunction transformStr2Hump1(str) {\n    if(str == null) {\n        return \"\";\n    }\n    var strArr = str.split('-');\n    for(var i = 1; i < strArr.length; i++) {\n        strArr[i] = strArr[i].charAt(0).toUpperCase() + strArr[i].substring(1);\n    }\n    return strArr.join('');\n}\n\n//æ–¹å¼äºŒï¼šæ“ä½œå­—ç¬¦æ•°ç»„\nfunction transformStr2Hump2(str) {\n    if(str == null) {\n        return \"\";\n    }\n    var strArr  =str.split('');\n    for(var i = 0; i < strArr.length; i++) {\n        if(strArr[i] == \"-\"){\n            //åˆ é™¤-\n            strArr.splice(i, 1);\n            //å°†è¯¥å¤„æ”¹ä¸ºå¤§å†™\n            if(i < strArr.length) {\n                strArr[i] = strArr[i].toUpperCase();\n            }\n        }\n    }\n    return strArr.join(\"\");\n}\n\n//æ–¹å¼ä¸‰ï¼šåˆ©ç”¨æ­£åˆ™\nfunction transformStr2Hump3(str) {\n    if(str == null) {\n        return \"\";\n    }\n    var reg = /-(\\w)/g;//åŒ¹é…å­—æ¯æˆ–æ•°å­—æˆ–ä¸‹åˆ’çº¿æˆ–æ±‰å­—\n    return str.replace(reg, function($0, $1) {\n        return $1.toUpperCase();\n    })\n}\n```\n\n## æ‡’åŠ è½½\n\n- é¦–å…ˆï¼Œä¸è¦å°†å›¾ç‰‡åœ°å€æ”¾åˆ°srcå±æ€§ä¸­ï¼Œè€Œæ˜¯æ”¾åˆ°å…¶å®ƒå±æ€§(data-original)ä¸­ã€‚\n- é¡µé¢åŠ è½½å®Œæˆåï¼Œæ ¹æ®scrollTopåˆ¤æ–­å›¾ç‰‡æ˜¯å¦åœ¨ç”¨æˆ·çš„è§†é‡å†…ï¼Œå¦‚æœåœ¨ï¼Œåˆ™å°†data-originalå±æ€§ä¸­çš„å€¼å–å‡ºå­˜æ”¾åˆ°srcå±æ€§ä¸­ã€‚\n- åœ¨æ»šåŠ¨äº‹ä»¶ä¸­é‡å¤åˆ¤æ–­å›¾ç‰‡æ˜¯å¦è¿›å…¥è§†é‡ï¼Œå¦‚æœè¿›å…¥ï¼Œåˆ™å°†data-originalå±æ€§ä¸­çš„å€¼å–å‡ºå­˜æ”¾åˆ°srcå±æ€§ä¸­ã€‚\n\n>  elementNode.getAttribute(name)ï¼šæ–¹æ³•é€šè¿‡åç§°è·å–å±æ€§çš„å€¼ã€‚\n>\n>  elementNode.setAttribute(name, value)ï¼šæ–¹æ³•åˆ›å»ºæˆ–æ”¹å˜æŸä¸ªæ–°å±æ€§ã€‚\n>\n>  elementNode.removeAttribute(name)ï¼šæ–¹æ³•é€šè¿‡åç§°åˆ é™¤å±æ€§çš„å€¼ã€‚\n\n```javascript\n//æ‡’åŠ è½½ä»£ç å®ç°\nvar viewHeight = document.documentElement.clientHeight;//å¯è§†åŒ–åŒºåŸŸçš„é«˜åº¦\n\nfunction lazyload () {\n    //è·å–æ‰€æœ‰è¦è¿›è¡Œæ‡’åŠ è½½çš„å›¾ç‰‡\n    let eles = document.querySelectorAll('img[data-original][lazyload]');//è·å–å±æ€§åä¸­æœ‰data-originalçš„\n    Array.prototype.forEach.call(eles, function(item, index) {\n        let rect;\n        if(item.dataset.original === '') {\n            return;\n        }\n\n        rect = item.getBoundingClientRect();\n\n        //å›¾ç‰‡ä¸€è¿›å…¥å¯è§†åŒºï¼ŒåŠ¨æ€åŠ è½½\n        if(rect.bottom >= 0 && rect.top < viewHeight) {\n            !function () {\n                let img = new Image();\n                img.src = item.dataset.original;\n                img.onload = function () {\n                    item.src = img.src;\n                }\n                item.removeAttribute('data-original');\n                item.removeAttribute('lazyload');\n            }();\n        }\n    })\n}\n\nlazyload();\n\ndocument.addEventListener('scroll', lazyload);\n```\n\n## æ•°ç»„æ‰å¹³åŒ–\n\n```javascript\n//ä¼ å…¥å‚æ•° å†³å®šæ‰å¹³åŒ–çš„é˜¶æ•°\nArray.prototype._flat = function (n) {\n    let result = [];\n    let num = n;\n    for (let item of this) {\n        // å¦‚æœæ˜¯æ•°ç»„\n        if (Array.isArray(item)) {\n            n--;\n            //   æ²¡æœ‰æ‰å¹³åŒ–çš„ç©ºé—´ ç›´æ¥æ¨å…¥\n            if (n < 0) {\n                result.push(item);\n            }\n            // ç»§ç»­æ‰å¹³åŒ– å¹¶å°†nä¼ å…¥ å†³å®šitemè¿™ä¸€ä¸ªæ•°ç»„ä¸­çš„æ‰å¹³åŒ–\n            else {\n                result.push(...item._flat(n));\n            }\n        }\n        // ä¸æ˜¯æ•°ç»„ç›´æ¥æ¨å…¥\n        else {\n            result.push(item);\n        }\n        // æ¯æ¬¡å¾ªç¯ é‡ç½®n ä¸ºä¼ å…¥çš„å‚æ•° å› ä¸ºæ¯ä¸€é¡¹éƒ½éœ€è¦æ‰å¹³åŒ– éœ€è¦è¿›è¡Œåˆ¤æ–­\n        n = num;\n    }\n    return result;\n};\nlet arr = [1, 2, [3, 4], [5, 6, [7, 8]]];\nlet res = arr._flat(1);\nconsole.log(res); // [ 1, 2, 3, 4, 5, 6, [ 7, 8 ] ]\n```\n\n## è®¡ç®—å±æ€§\n\nè¯·ä¸è¦ä¸ºæ‰€æœ‰å‡½æ•°æ·»åŠ ç¼“å­˜ï¼\n\n```javascript\nconst computed = (func, content) => {\n    let cache = Object.create(null);\n    content = content || this;\n    return (...key) => {\n        console.log(cache)\n        if (!cache[key]) {\n            cache[key] = func.apply(content, key);\n        }\n        return cache[key];\n    }\n}\n```\n\n## æœ‰å¹¶å‘é™åˆ¶çš„Promiseè°ƒåº¦å™¨\n\n```JavaScript\nclass Scheduler{\n    constructor(limit){\n        this.limit = limit;\n        this.running = 0;\n        this.queue = [];\n    }\n    createTask(callback, duration){\n        return ()=>{\n            return new Promise((resolve, reject)=>{\n                setTimeout(()=>{\n                    callback();\n                    resolve();\n                },duration);\n            });\n        };\n    }\n    \n    add(callback, duration){\n        const task = this.createTask(callback, duration);\n        this.queue.push(task);\n    }\n    \n    start(){\n        for(let i=0;i<this.limit;++i){\n            this.schedule();\n        }\n    }\n    schedule(){\n        if(this.queue.length === 0 || this.running >= this.limit)return;\n        this.running++;\n        const task = this.queue.shift();\n        \n        task().then(()=>{\n            this.running--;\n            schedule();\n        });\n    }\n}\n```\n\n# ç½‘ç»œè¯·æ±‚å’Œè·¨åŸŸè§£å†³æ–¹æ¡ˆ\n\n## åŸç”Ÿajax\n\n```javascript\nfunction sendajax() {\n    // 1ã€ åˆå§‹åŒ–xhrå¯¹è±¡\n    const xhr = new XMLHttpRequest();\n    //  2ã€ å»ºç«‹è¿æ¥ è®¾ç½®è¯·æ±‚æ–¹æ³•å’Œurl\n    xhr.open(\"get\", \"./data.json\");\n    //   3ã€å‘é€è¯·æ±‚\n    xhr.send();\n    //   4ã€çŠ¶æ€æ”¹å˜æ—¶ è¿›è¡Œå›è°ƒ\n    xhr.onreadystatechange = function () {\n        // readyState æœ‰0-4 äº”ä¸ªå€¼\n        // 0 ä»£è¡¨ æœªåˆå§‹åŒ– 1 ä»£è¡¨ åˆå§‹åŒ–æˆåŠŸ 2 ä»£è¡¨å‘é€è¯·æ±‚\n        // 3 ä»£è¡¨è¿”å›äº†éƒ¨åˆ†æ•°æ® 4 ä»£è¡¨è¿”å›äº†å…¨éƒ¨æ•°æ®\n        if (xhr.readyState == 4) {\n            if (xhr.status >= 200 && xhr.status < 300) {\n                //   è¿›è¡ŒæˆåŠŸçš„æ“ä½œ\n                console.log(xhr.responseText);\n            }\n        }\n    };\n}\nsendajax();\n```\n\n## JSONPè·¨åŸŸ\n\né¦–å…ˆåœ¨å®¢æˆ·ç«¯æ³¨å†Œä¸€ä¸ªcallbackï¼Œç„¶åæŠŠcallbackçš„åå­—ä¼ ç»™æœåŠ¡å™¨ã€‚æ­¤æ—¶ï¼ŒæœåŠ¡å™¨å…ˆç”Ÿæˆjsonæ•°æ®ï¼Œç„¶åä»¥JavaScriptçš„è¯­æ³•æ–¹å¼ï¼Œç”Ÿæˆfunctionï¼Œfunctionçš„åå­—å°±æ˜¯ä¼ é€’ä¸Šæ¥å¸¦å‚æ•°çš„jsonpï¼Œæœ€åå°†jsonæ•°æ®ç›´æ¥ä»¥å…¥å‚çš„æ–¹å¼ï¼Œæ”¾ç½®åœ¨functionä¸­ï¼Œè¿™æ ·å­å°±ç”ŸæˆJavaScriptè¯­æ³•æ–‡æ¡£ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æµè§ˆå™¨ï¼Œé€šè¿‡è§£æï¼Œå¹¶æ‰§è¡Œè¿”å›JavaScriptæ–‡æ¡£ï¼Œæ­¤æ—¶æ•°æ®ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥åˆ°å®¢æˆ·ç«¯é¢„å…ˆå®šä¹‰å¥½çš„callbackå‡½æ•°ä¸­ï¼Œç®€å•åœ°è¯´ï¼Œå°±æ˜¯**åˆ©ç”¨scriptæ ‡ç­¾æ²¡æœ‰è·¨åŸŸé™åˆ¶åœ°æ¼æ´æ¥è¾¾åˆ°ç¬¬ä¸‰æ–¹é€šè®¯çš„ç›®çš„ï¼ˆhrefã€src éƒ½ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ã€‚ï¼‰**\n\n**ä¼˜ç‚¹ï¼š**\n\n- å®ƒä¸åƒXMLHttpRequestå¯¹è±¡å®ç°çš„Ajaxè¯·æ±‚é‚£æ ·å—åˆ°åŒæºç­–ç•¥çš„é™åˆ¶ï¼ŒJSONPå¯ä»¥è·¨è¶ŠåŒæºç­–ç•¥ï¼›\n- å®ƒçš„å…¼å®¹æ€§æ›´å¥½ï¼Œåœ¨æ›´åŠ å¤è€çš„æµè§ˆå™¨ä¸­éƒ½å¯ä»¥è¿è¡Œï¼Œä¸éœ€è¦XMLHttpRequestæˆ–ActiveXçš„æ”¯æŒï¼›\n\n**ç¼ºç‚¹:**\n\n- å®ƒ**åªæ”¯æŒGETè¯·æ±‚**è€Œä¸æ”¯æŒPOSTç­‰å…¶å®ƒç±»å‹çš„HTTPè¯·æ±‚\n- å®ƒåªæ”¯æŒè·¨åŸŸHTTPè¯·æ±‚è¿™ç§æƒ…å†µï¼Œä¸èƒ½è§£å†³ä¸åŒåŸŸçš„ä¸¤ä¸ªé¡µé¢ä¹‹é—´å¦‚ä½•è¿›è¡ŒJavaScriptè°ƒç”¨çš„é—®é¢˜ã€‚\n- jsonpåœ¨è°ƒç”¨å¤±è´¥çš„æ—¶å€™ä¸ä¼šè¿”å›å„ç§HTTPçŠ¶æ€ç ã€‚\n- éœ€è¦åç«¯é…åˆ\n\n```javascript\n        function jsonp({url,params,cb}){\n                return new Promise((resolve, reject)=>{\n                        window[cb] = function(data){\n                                console.log(data)\n                                resolve(data);\n                                document.body.removeChild(script);\n                        }//windowå¯¹è±¡ä¸Šè®¾ç½®showæ–¹æ³•\n                        params= {...params,cb}\n                        let arrs = [];\n                        for (let key in params){\n                                arrs.push(`${key}=${params[key]}`)\n                        }\n                        let script = document.createElement('script');\n                        script.src = `${url}?${arrs.join('&')}`;\n                        script.onerror = () => reject('åŠ è½½å¤±è´¥') \n                        document.body.appendChild(script);\n                \n\n                })\n        }\n        jsonp({\n                url:\"http://localhost:3000/users\",\n                params:{name:\"jin\",age:12},\n                cb:'show'\n        }).then(data=>{\n                console.log(data)\n        })\n```\n\nåç«¯ï¼š\n\n```javascript\nlet express = require('express');\nlet app = express();\napp.get('/users', function(req, res, next) {\n        // æ¨¡æ‹Ÿçš„æ•°æ®\n        let {name,age,cb} = req.query\n        let data = `\"${name}ç°åœ¨${age}å²\"`\n        res.send(`${cb}(${data})`);// show(data)\n});\n\napp.listen(3000)\n```\n\n## corsè·¨åŸŸ\n\nåŒæºç­–ç•¥æ˜¯ä¸å…è®¸æ¥æ”¶å“åº”è€Œä¸æ˜¯ä¸å…è®¸å‘é€è¯·æ±‚ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡åœ¨å“åº”å¤´ä¸­è®¾ç½®æŸäº›å­—æ®µæ¥å…è®¸æ»¡è¶³æ¡ä»¶çš„è¯·æ±‚è·¨åŸŸï¼Œæ¯”å¦‚è®¾ç½® `Access-Control-Allow-Origin` å­—æ®µå…è®¸æ¥è‡ªæŸä¸ªæºçš„è¯·æ±‚è·¨åŸŸï¼Œæ¯”å¦‚è®¾ç½® `Access-Control-Allow-Methods` å­—æ®µå…è®¸'GET'æˆ–è€…'POST'æ–¹å¼çš„è¯·æ±‚è·¨åŸŸ\n\nåç«¯ï¼š\n\n```javascript\nlet express = require('express');\nlet app = express();\napp.all('*', function (req, res, next) {\n  let origin = req.headers.origin\n        //è®¾ç½®å“ªä¸ªæºå¯ä»¥è®¿é—®æˆ‘\n  res.header(\"Access-Control-Allow-Origin\",origin);\n        // å…è®¸æºå¸¦å“ªä¸ªå¤´è®¿é—®æˆ‘\n  res.header(\"Access-Control-Allow-Headers\", \"name\");\n        // å…è®¸å“ªä¸ªæ–¹æ³•è®¿é—®æˆ‘\n  res.header(\"Access-Control-Allow-Methods\", \"POST\");\n        // å…è®¸æºå¸¦cookie\n  res.set(\"Access-Control-Allow-Credentials\", true);\n        // é¢„æ£€çš„å­˜æ´»æ—¶é—´\n  res.header(\"Access-Control-Max-Age\", 6);\n        // å…è®¸å‰ç«¯è·å–å“ªä¸ªå¤´\n        res.header(\"Access-Control-Expose-Headers\", \"name\");\n        // è¯·æ±‚å¤´çš„æ ¼å¼\n  res.header(\"Content-Type\", \"application/json;charset=utf-8\");        \n  next();\n});\napp.post('/getData', function(req, res, next) {\n        console.log(req.headers)\n        res.send(\"ä½ æ‹¿ä¸åˆ°æ•°æ®äº†ï¼\");\n});\n\napp.listen(4000)\n```\n\n![img](https://k0x1mohrv2i.feishu.cn/space/api/box/stream/download/asynccode/?code=NDZkMzY0OGQyNDNmNjUxZDIwMjU1MWNlN2E0Mzg4MWFfa29GVk90bXpPWThOWlE3b2RzVFJJclhjRG45R01BaXFfVG9rZW46TlBKZGJkQlJ4b0F3V3h4NDRxWWNHNmxnbldjXzE3NTMxNjg3NjA6MTc1MzE3MjM2MF9WNA)\n\néç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯`PUT`æˆ–`DELETE`ï¼Œæˆ–è€…`Content-Type`å­—æ®µçš„ç±»å‹æ˜¯`application/json`ã€‚\n\néç®€å•è¯·æ±‚çš„CORSè¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸º\"é¢„æ£€\"è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚\n\næµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº›HTTPåŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„`XMLHttpRequest`è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚ ä»£ç ä¿®æ”¹ä¸€ä¸‹ï¼š\n\n```javascript\n// åœ¨è¯·æ±‚å¤´çš„è®¾ç½®ä¸­åŠ ä¸Š\nif(req.method ==='OPTIONS'){\n    res.end();//OPTIONSè¯·æ±‚ä¸åšä»»ä½•å¤„ç†\n}\n```\n\n![img](https://k0x1mohrv2i.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGZhMjliNjM3ZDgyYTViMWZjYjdkZGJkOGMxZDE4YTBfclJZQzR4MzMwZmRpd3J4MEl3UWlqbVE3NEU2UDZwODFfVG9rZW46Qk53bWJ2T2dSb3BoZU14eXNFRmNZN1M0blNYXzE3NTMxNjg3NjA6MTc1MzE3MjM2MF9WNA)\n\n## postMessageè·¨åŸŸ\n\n**ã€Œwindow.postMessage()ã€** æ–¹æ³•å¯ä»¥å®‰å…¨åœ°å®ç°è·¨æºé€šä¿¡ã€‚é€šå¸¸ï¼Œå¯¹äºä¸¤ä¸ªä¸åŒé¡µé¢çš„è„šæœ¬ï¼Œåªæœ‰å½“æ‰§è¡Œå®ƒä»¬çš„é¡µé¢ä½äºå…·æœ‰ç›¸åŒçš„åè®®ï¼ˆé€šå¸¸ä¸º httpsï¼‰ï¼Œç«¯å£å·ï¼ˆ443 ä¸º https çš„é»˜è®¤å€¼ï¼‰ï¼Œä»¥åŠä¸»æœº (ä¸¤ä¸ªé¡µé¢çš„æ¨¡æ•° [`Document.domain`]è®¾ç½®ä¸ºç›¸åŒçš„å€¼) æ—¶ï¼Œè¿™ä¸¤ä¸ªè„šæœ¬æ‰èƒ½ç›¸äº’é€šä¿¡ã€‚**ã€Œwindow.postMessage()ã€** æ–¹æ³•æä¾›äº†ä¸€ç§å—æ§æœºåˆ¶æ¥è§„é¿æ­¤é™åˆ¶ï¼Œåªè¦æ­£ç¡®çš„ä½¿ç”¨ï¼Œè¿™ç§æ–¹æ³•å°±å¾ˆå®‰å…¨ã€‚\n\n**ç”¨é€”**\n\n1.é¡µé¢å’Œå…¶æ‰“å¼€çš„æ–°çª—å£çš„æ•°æ®ä¼ é€’\n\n2.å¤šçª—å£ä¹‹é—´æ¶ˆæ¯ä¼ é€’\n\n3.é¡µé¢ä¸åµŒå¥—çš„ iframe æ¶ˆæ¯ä¼ é€’\n\n**å®ç°**\n\na.html\n\n```xml\n<iframe src=\"http://localhost:4000/b.html\" frameborder=\"0\" id=\"frame\" onload=\"load()\"></iframe>\n<script>\n    function load(){\n        let frame = document.getElementById('frame');\n        frame.contentWindow.postMessage('ä½ å¥½','http://localhost:4000/');\n        //æ¥æ”¶\n        window.onmessage= function(e){\n            console.log(e.data)\n        }\n    }\n</script>\n```\n\nb.html\n\n```xml\nwindow.onmessage = function(e){\n    console.log(e.data);\n    //å‘é€\n    e.source.postMessage('hello',e.origin)\n}\n```\n\n## æœ¬åœ°ä»£ç†è·¨åŸŸ\n\nproxyå…¶å®å°±æ˜¯å› ä¸ºæµè§ˆå™¨åŒæºåè®®æ— æ³•è¯·æ±‚éåŒæºçš„åœ°å€ï¼Œä½†æ˜¯æœåŠ¡å™¨ç›´æ¥æ²¡æœ‰åŒæºåè®®ï¼Œåˆ©ç”¨å°†æœ¬åœ°è¯·æ±‚è½¬åˆ°æœ¬åœ°æœåŠ¡å™¨è¿›è¡Œä»£ç†è½¬å‘ï¼Œä»è€Œç»•è¿‡äº†åŒæºåè®®çš„é™åˆ¶ï¼Œé€šè¿‡ä»£ç†çš„å®ç°å¯ä»¥è§£å†³è·¨åŸŸçš„é—®é¢˜\n\né€šè¿‡è®¾ç½®ä¸€ä¸ª node åç«¯ä½œä¸ºä¸­é—´å±‚ï¼Œå‰ç«¯å‘é€çš„è¯·æ±‚é¦–å…ˆåˆ°è¾¾è¿™ä¸ªä¸­é—´å±‚ï¼Œç„¶åå†ç”±ä¸­é—´å±‚å°†è¯·æ±‚è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚å“åº”è¿‡ç¨‹ä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒæœåŠ¡å™¨å…ˆå“åº”ç»™ä¸­é—´å±‚ï¼Œä¸­é—´å±‚å†å°†å“åº”æ•°æ®å‘é€å›å‰ç«¯ã€‚\n\nè¿™ä¸ªä¸­é—´å±‚å°±èµ·åˆ°äº†ä¸€ä¸ªä»£ç†çš„ä½œç”¨ã€‚è¿™æ ·ï¼Œæµè§ˆå™¨çœ‹åˆ°çš„æ˜¯åŒæºè¯·æ±‚ï¼Œä»è€Œç»•è¿‡äº†CORSé™åˆ¶ã€‚\n\nå‡è®¾å‰ç«¯ç°åœ¨è¦å°†è¯·æ±‚å‘é€ç»™ [http://192.168.1.63:3000](https://link.juejin.cn?target=http%3A%2F%2F192.168.1.63%3A3000) è¿™ä¸ªåç«¯ï¼Œå°±å¯ä»¥å…ˆç”±æœ¬æœºçš„ 3001 ç«¯å£ä½œä¸€ä¸ªä»£ç†\n\n```xml\n<!-- å‰ç«¯ -->\n<body>\n    <script>\n        const xhr = new XMLHttpRequest()\n        xhr.open('GET', 'https://localhost:3001')\n        xhr.send()\n        xhr.onreadystatechange = function() {\n            if (xhr.readyState === 4 && xhr.status === 200) {\n                console.log(xhr.responseText)\n            }\n        }\n    </script>\n</body>\n```\n\næœ¬æœºåç«¯\n\n```javascript\n// åç«¯\nconst http = require('http')\n\n// ç›‘å¬æœ¬æœº3001ç«¯å£ï¼Œæœ‰æ–°è¯·æ±‚æ—¶è°ƒç”¨å›è°ƒå‡½æ•°\nhttp.createServer((req, res)  => {\n\n    // è®¾ç½®å“åº”å¤´ï¼Œä»¥å…è®¸å‰ç«¯åº”ç”¨è®¿é—®å“åº”å†…å®¹\n    res.writeHead(200, {\n        'Access-Control-Allow-Origin': '*'\n    })\n\n    // è½¬å‘è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œå¹¶å¤„ç†å“åº”\n    http.request({\n        host: '192.168.1.63',\n        port: 3000,\n        path: '/',\n        method: 'GET',\n        headers: {}\n    }, proxyRes => {\n        proxyRes.on('data', chunk => {\n            res.end(chunk.toString())\n        })\n    }).end()\n    \n}).listen(3001)\n```\n\n### å„è„šæ‰‹æ¶çš„proxyé…ç½®ï¼š\n\n#### Webpack (4.x)\n\nåœ¨`webpack`ä¸­å¯ä»¥é…ç½®`proxy`æ¥å¿«é€Ÿè·å¾—æ¥å£ä»£ç†çš„èƒ½åŠ›ã€‚\n\n```JavaScript\nconst path = require(\"path\");\nconst HtmlWebpackPlugin = require(\"html-webpack-plugin\");\n\nmodule.exports = {\n  entry: {\n    index: \"./index.js\"\n  },\n  output: {\n    filename: \"bundle.js\",\n    path: path.resolve(__dirname, \"dist\")\n  },\n  devServer: {\n    port: 8000,\n    proxy: {\n      \"/api\": {\n        target: \"http://localhost:8080\"\n      }\n    }\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: \"index.html\",\n      template: \"webpack.html\"\n    })\n  ]\n};\n```\n\n#### **Vue-cli 2.x**\n\n```JavaScript\n// config/index.js\n\n...\nproxyTable: {\n  '/api': {\n     target: 'http://localhost:8080',\n  }\n},\n...\n```\n\n#### Vue-cli 3.x\n\n```JavaScript\n// vue.config.js å¦‚æœæ²¡æœ‰å°±æ–°å»º\nmodule.exports = {\n  devServer: {\n    port: 8000,\n    proxy: {\n      \"/api\": {\n        target: \"http://localhost:8080\"\n      }\n    }\n  }\n};\n```\n\n#### vite\n\n```javascript\nimport { defineConfig } from 'vite'\nimport vue from '@vitejs/plugin-vue'\nimport styleImport, { VantResolve } from 'vite-plugin-style-import';\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [\n    vue(),\n    styleImport({\n      resolves: [VantResolve()],\n    }),],\n    server: { //ä¸»è¦æ˜¯åŠ ä¸Šè¿™æ®µä»£ç \n      host: '127.0.0.1',\n      port: 3000,\n      proxy: {\n        '/api': {\n          target: 'http://127.0.0.1:8888',        //å®é™…è¯·æ±‚åœ°å€\n          changeOrigin: true,\n          rewrite: (path) => path.replace(/^\\/api/, '')\n        },\n      }\n    }\n})\n```\n\n## nginxåå‘ä»£ç†è·¨åŸŸ\n\nåå‘ä»£ç†ä¸æœ¬åœ°ä»£ç†ç›¸åã€‚æœ¬åœ°ä»£ç†æ˜¯å®¢æˆ·ç«¯æå®šçš„ï¼Œåå‘ä»£ç†å°±æ˜¯æœåŠ¡ç«¯æå®šçš„\n\nåå‘ä»£ç†çš„æ˜¯åœ¨æœåŠ¡ç«¯å†…éƒ¨å®Œæˆã€‚\n\næ˜¯æœåŠ¡ç«¯ï¼ˆæ•°æ®åº”ç”¨ï¼‰å‘æœåŠ¡ç«¯ï¼ˆç½‘é¡µåº”ç”¨ï¼‰å‘é€æ•°æ®ï¼Œ æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ® å…¶æœ¬è´¨æ˜¯åœ¨æœåŠ¡ç«¯ï¼ˆç½‘é¡µåº”ç”¨ï¼‰é€šè¿‡é…ç½®Access-Control-Allow-Origin * æ¥è§£å†³è·¨åŸŸé—®é¢˜ã€‚ç›¸å½“äºå¯¹åç«¯æ¥å£è¿›è¡Œäº†ç»Ÿä¸€çš„corsé…ç½®\n\n`Access-Control-Allow-Origin: *` å€¼è¡¨æ˜ï¼Œè¯¥èµ„æºå¯ä»¥è¢«**ä»»æ„**å¤–æºè®¿é—®ã€‚\n\n```bash\n    #é€šè¿‡é…ç½®nginxæ–‡ä»¶æ—¢å¯\n    \n    events{}\n\nhttp{\n    include       mime.types;\n    default_type  application/octet-stream;\n    server{\n        listen 80;\n        server_name 127.0.0.1;\n        root D:/nginx-1.26.1/dist;\n        index index.html;\n        location / {\n   \n               location /api {\n                proxy_pass http://127.0.0.1:8080/;\n                proxy_set_header Host $host;\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n                proxy_set_header X-Forwarded-Proto $scheme;\n\n                # è§£å†³è·¨åŸŸé—®é¢˜\n                add_header Access-Control-Allow-Origin *;\n                add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS, HEAD, PUT, DELETE\";\n                add_header Access-Control-Allow-Headers \"Origin, X-Requested-With, Content-Type, Accept, Authorization, User-Agent, DNT\";\n                add_header Access-Control-Max-Age 86400;\n\n                \n            }\n        }\n    }\n}\n```\n\n# è®¾è®¡æ¨¡å¼\n\n## å•ä¾‹æ¨¡å¼\n\n```typescript\n// å•ä¾‹æ¨¡å¼ç¤ºä¾‹ä»£ç \nclass Singleton {\n  constructor() {\n    if (!Singleton.instance) {\n      Singleton.instance = this;\n    }\n    return Singleton.instance;\n  }\n\n  createInstance() {\n    const object = { name: \"example\" };\n    return object;\n  }\n\n  getInstance() {\n    if (!Singleton.instance) {\n      Singleton.instance = this.createInstance();\n    }\n    return Singleton.instance;\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst instance1 = new Singleton();\nconst instance2 = new Singleton();\n\nconsole.log(instance1 === instance2); // true\n```\n\n## å·¥å‚æ¨¡å¼\n\n```javascript\nclass Product {\n  constructor(name) {\n    this.name = name;\n  }\n\n  getName() {\n    return this.name;\n  }\n}\n\nclass ProductFactory {\n  static createProduct(name) {\n    return new Product(name);\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst product = ProductFactory.createProduct(\"Example Product\");\nconsole.log(product.getName()); // \"Example Product\"\n```\n\n## è§‚å¯Ÿè€…æ¨¡å¼\n\n```javascript\nclass Subject {\n  constructor() {\n    this.observers = [];\n  }\n\n  addObserver(observer) {\n    this.observers.push(observer);\n  }\n\n  removeObserver(observer) {\n    const index = this.observers.indexOf(observer);\n    if (index !== -1) {\n      this.observers.splice(index, 1);\n    }\n  }\n\n  notify(data) {\n    this.observers.forEach(observer => observer.update(data));\n  }\n}\n\nclass Observer {\n  update(data) {\n    console.log(`Received data: ${data}`);\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst subject = new Subject();\nconst observer1 = new Observer();\nconst observer2 = new Observer();\n\nsubject.addObserver(observer1);\nsubject.addObserver(observer2);\n\nsubject.notify(\"Hello World!\");\n```\n\n## è£…é¥°å™¨æ¨¡å¼\n\n```java\ninterface Component {\n  operation(): void;\n}\n\nclass ConcreteComponent implements Component {\n  public operation(): void {\n    console.log(\"ConcreteComponent: operation.\");\n  }\n}\n\nclass Decorator implements Component {\n  protected component: Component;\n\n  constructor(component: Component) {\n    this.component = component;\n  }\n\n  public operation(): void {\n    console.log(\"Decorator: operation.\");\n    this.component.operation();\n  }\n}\n\nclass ConcreteDecoratorA extends Decorator {\n  public operation(): void {\n    super.operation();\n    console.log(\"ConcreteDecoratorA: operation.\");\n  }\n}\n\nclass ConcreteDecoratorB extends Decorator {\n  public operation(): void {\n    super.operation();\n    console.log(\"ConcreteDecoratorB: operation.\");\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst concreteComponent = new ConcreteComponent();\nconst concreteDecoratorA = new ConcreteDecoratorA(concreteComponent);\nconst concreteDecoratorB = new ConcreteDecoratorB(concreteDecoratorA);\n\nconcreteDecoratorB.operation();\n```\n\n## ä»£ç†æ¨¡å¼\n\n```javascript\nconst target = {\n  method() {\n    console.log(\"Target method.\");\n  }\n};\n\nconst proxy = new Proxy(target, {\n  get(target, prop) {\n    console.log(`Called ${prop} method.`);\n    return target[prop];\n  }\n});\n\n// ä½¿ç”¨ç¤ºä¾‹\nproxy.method(); // \"Called method method. Target method.\"\n```\n\n## é€‚é…å™¨æ¨¡å¼\n\n```javascript\nclass Adaptee {\n  specificRequest() {\n    return \"é€‚é…è€…ä¸­çš„ä¸šåŠ¡ä»£ç è¢«è°ƒç”¨\";\n  }\n}\n\nclass Target {\n  constructor() {\n    this.adaptee = new Adaptee();\n  }\n\n  request() {\n    let info = this.adaptee.specificRequest();\n    return `${info} - è½¬æ¢å™¨ - é€‚é…å™¨ä»£ç è¢«è°ƒç”¨`;\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nlet target = new Target();\ntarget.request(); // \"é€‚é…è€…ä¸­çš„ä¸šåŠ¡ä»£ç è¢«è°ƒç”¨ - è½¬æ¢å™¨ - é€‚é…å™¨ä»£ç è¢«è°ƒç”¨\"\n```\n\n## MVCæ¨¡å¼\n\n```javascript\nclass Model {\n  constructor() {\n    this.data = {\n      name: \"example\",\n      age: 18,\n      gender: \"male\"\n    };\n  }\n\n  setData(key, value) {\n    this.data[key] = value;\n  }\n\n  getData() {\n    return this.data;\n  }\n}\n\nclass View {\n  constructor() {\n    this.container = document.createElement(\"div\");\n  }\n\n  render(data) {\n    const { name, age, gender } = data;\n    this.container.innerHTML = `\n      <p>Name: ${name}</p>\n      <p>Age: ${age}</p>\n      <p>Gender: ${gender}</p>\n    `;\n    document.body.appendChild(this.container);\n  }\n}\n\nclass Controller {\n  constructor(model, view) {\n    this.model = model;\n    this.view = view;\n    this.view.render(this.model.getData());\n  }\n\n  setData(key, value) {\n    this.model.setData(key, value);\n    this.view.render(this.model.getData());\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst model = new Model();\nconst view = new View();\nconst controller = new Controller(model, view);\n\ncontroller.setData(\"age\", 20);\n```\n\n## ç­–ç•¥æ¨¡å¼\n\nè¡¨å•éªŒè¯æƒ…æ™¯ï¼š\n\n```ts\n// éªŒè¯ç­–ç•¥\nconst validationStrategies = {\n  required: {\n    validate: (value) => value !== '',\n    message: 'è¯¥å­—æ®µä¸èƒ½ä¸ºç©º'\n  },\n  \n  minLength: {\n    validate: (value, length) => value.length >= length,\n    message: (length) => `æœ€å°‘éœ€è¦${length}ä¸ªå­—ç¬¦`\n  },\n  \n  email: {\n    validate: (value) => /^\\S+@\\S+\\.\\S+$/.test(value),\n    message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€'\n  },\n  \n  phone: {\n    validate: (value) => /^1[3-9]\\d{9}$/.test(value),\n    message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·'\n  },\n  \n  custom: {\n    validate: (value, validator) => validator(value),\n    message: 'è‡ªå®šä¹‰éªŒè¯å¤±è´¥'\n  }\n};\n\n// è¡¨å•éªŒè¯å™¨\nclass FormValidator {\n  constructor() {\n    this.rules = [];\n  }\n  \n  // æ·»åŠ éªŒè¯è§„åˆ™\n  addRule(field, strategy, ...params) {\n    this.rules.push({\n      field,\n      strategy,\n      params\n    });\n  }\n  \n  // æ‰§è¡ŒéªŒè¯\n  validate(formData) {\n    const errors = [];\n    \n    for (const rule of this.rules) {\n      const { field, strategy, params } = rule;\n      const value = formData[field];\n      const validationStrategy = validationStrategies[strategy];\n      \n      if (!validationStrategy.validate(value, ...params)) {\n        errors.push({\n          field,\n          message: typeof validationStrategy.message === 'function' \n            ? validationStrategy.message(...params)\n            : validationStrategy.message\n        });\n      }\n    }\n    \n    return {\n      isValid: errors.length === 0,\n      errors\n    };\n  }\n}\n\n// ä½¿ç”¨ç¤ºä¾‹\nconst validator = new FormValidator();\nvalidator.addRule('username', 'required');\nvalidator.addRule('username', 'minLength', 3);\nvalidator.addRule('email', 'required');\nvalidator.addRule('email', 'email');\nvalidator.addRule('phone', 'phone');\n\nconst formData = {\n  username: 'ab',\n  email: 'invalid-email',\n  phone: '12345678901'\n};\n\nconst result = validator.validate(formData);\nconsole.log(result);\n// {\n//   isValid: false,\n//   errors: [\n//     { field: 'username', message: 'æœ€å°‘éœ€è¦3ä¸ªå­—ç¬¦' },\n//     { field: 'email', message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€' },\n//     { field: 'phone', message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·' }\n//   ]\n// }\n```\n\n","tags":["ç§‹æ‹›","ES","é¢è¯•é¢˜","å‰ç«¯æ‰‹æ’•"],"categories":["ç§‹æ‹›å‡†å¤‡"]},{"title":"ã€ç§‹æ‹›å¤‡æˆ˜ã€‘è®¡ç®—æœºç½‘ç»œ","url":"/2025/07/22/ã€ç§‹æ‹›å¤‡æˆ˜ã€‘è®¡ç®—æœºç½‘ç»œ/","content":"\n# å‰è¨€\n\nè®¡ç®—æœºç½‘ç»œä½œä¸ºå‰ç«¯å¼€å‘ä¸­ç»•ä¸å¼€çš„åŸºç¡€çŸ¥è¯†ï¼Œé¢è¯•æ—¶ä¹Ÿç‰¹çˆ±é—®ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æœ‰å¯èƒ½è¢«æ‰“ä¸€ä¸ªå†·ä¸é˜²ã€‚è¿™ä»½æ–‡æ¡£æ—¨åœ¨æ•´ç†å‰ç«¯é¢è¯•ä¸­é«˜é¢‘å‡ºç°çš„è®¡ç®—æœºç½‘ç»œçŸ¥è¯†ç‚¹ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°æ­£åœ¨å‡†å¤‡é¢è¯•çš„ä½ ã€‚\n\nå†…å®¹åŸºäºä¸ªäººé¢è¯•ç»éªŒå’Œå­¦ä¹ æ€»ç»“ï¼Œå¦‚æœ‰ä¸å½“ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£äº¤æµã€‚  æœ¬æ–‡ä¸è¿½æ±‚é¢é¢ä¿±åˆ°ï¼Œè€Œæ˜¯èšç„¦äºå‰ç«¯é¢è¯•ä¸­çš„é«˜é¢‘è€ƒç‚¹ï¼ŒåŠ›æ±‚æ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½è®²é€å½»ã€è®²å®ç”¨ã€‚\n\n# ä¸€ã€HTTP åè®®ç¯‡\n\n## 1.1 HTTP åŸºç¡€\n\n- **HTTP æ˜¯ä»€ä¹ˆï¼Ÿ**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š** HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯åº”ç”¨å±‚åè®®ï¼ŒåŸºäºTCP/IPï¼Œé‡‡ç”¨è¯·æ±‚-å“åº”æ¨¡å¼ï¼Œæ— çŠ¶æ€ã€‚ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“è¶…æ–‡æœ¬æ•°æ®ã€‚\n\n- **HTTP è¯·æ±‚æ–¹æ³•è¯¦è§£**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - **GET**ï¼šè·å–èµ„æºï¼Œå¹‚ç­‰ï¼Œå¯ç¼“å­˜\n  - **POST**ï¼šæäº¤æ•°æ®ï¼Œéå¹‚ç­‰ï¼Œä¸å¯ç¼“å­˜\n  - **PUT**ï¼šæ›´æ–°æ•´ä¸ªèµ„æºï¼Œå¹‚ç­‰\n  - **DELETE**ï¼šåˆ é™¤èµ„æºï¼Œå¹‚ç­‰\n  - **HEAD**ï¼šè·å–å“åº”å¤´ï¼Œä¸è¿”å›body\n  - **OPTIONS**ï¼šé¢„æ£€è¯·æ±‚ï¼Œè¯¢é—®æ”¯æŒçš„æ–¹æ³•\n  - **PATCH**ï¼šéƒ¨åˆ†æ›´æ–°èµ„æº\n\n- **HTTP çŠ¶æ€ç åˆ†ç±»åŠå¸¸è§çŠ¶æ€ç **\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - **1xx**ï¼šä¿¡æ¯æç¤ºï¼ˆ100 Continueï¼‰\n  - **2xx**ï¼šæˆåŠŸï¼ˆ200 OKã€201 Createdã€204 No Contentï¼‰\n  - **3xx**ï¼šé‡å®šå‘ï¼ˆ301æ°¸ä¹…ã€302ä¸´æ—¶ã€304æœªä¿®æ”¹ï¼‰\n  - **4xx**ï¼šå®¢æˆ·ç«¯é”™è¯¯ï¼ˆ400 Bad Requestã€401æœªæˆæƒã€403ç¦æ­¢ã€404æœªæ‰¾åˆ°ï¼‰\n  - **5xx**ï¼šæœåŠ¡å™¨é”™è¯¯ï¼ˆ500å†…éƒ¨é”™è¯¯ã€502ç½‘å…³é”™è¯¯ã€503æœåŠ¡ä¸å¯ç”¨ï¼‰\n\n- HTTP æŠ¥æ–‡ç»“æ„\n  \n  ```markdown\n  è¯·æ±‚æŠ¥æ–‡ï¼š\n  è¯·æ±‚è¡Œï¼šGET /index.html HTTP/1.1\n  è¯·æ±‚å¤´ï¼šHost: www.example.com\n  ç©ºè¡Œ\n  è¯·æ±‚ä½“ï¼šï¼ˆPOSTè¯·æ±‚çš„æ•°æ®ï¼‰\n  \n  å“åº”æŠ¥æ–‡ï¼š\n  çŠ¶æ€è¡Œï¼šHTTP/1.1 200 OK\n  å“åº”å¤´ï¼šContent-Type: text/html\n  ç©ºè¡Œ\n  å“åº”ä½“ï¼š<html>...</html>\n  ```\n\n## 1.2 HTTP ç¼“å­˜æœºåˆ¶\n\n- å¼ºç¼“å­˜ vs åå•†ç¼“å­˜\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - **å¼ºç¼“å­˜**ï¼šä¸å‘è¯·æ±‚ï¼Œç›´æ¥ä»ç¼“å­˜å–ï¼ˆCache-Controlã€Expiresï¼‰\n  - **åå•†ç¼“å­˜**ï¼šå‘è¯·æ±‚è¯¢é—®æœåŠ¡å™¨ï¼Œèµ„æºæ˜¯å¦æ›´æ–°ï¼ˆETag/If-None-Matchã€Last-Modified/If-Modified-Sinceï¼‰\n\n  **ç†è§£tipsï¼š**\n\n  - å¼ºç¼“å­˜åƒ**å†°ç®±é‡Œçš„ç‰›å¥¶**ï¼šçœ‹ä¿è´¨æœŸï¼ˆCache-Controlï¼‰ï¼Œæ²¡è¿‡æœŸç›´æ¥å–\n  - åå•†ç¼“å­˜åƒ**æ‰“ç”µè¯é—®å¦ˆå¦ˆ**ï¼šå†°ç®±é‡Œçš„èœè¿˜èƒ½åƒå—ï¼Ÿå¦ˆå¦ˆè¯´èƒ½åƒï¼ˆ304ï¼‰å°±åƒï¼Œä¸èƒ½åƒå°±ä¹°æ–°çš„ï¼ˆ200ï¼‰\n\n- **Cache-Control è¯¦è§£**\n\n  ```\n  // å¸¸ç”¨æŒ‡ä»¤\n  Cache-Control: max-age=3600     // å¼ºç¼“å­˜3600ç§’\n  Cache-Control: no-cache         // éœ€è¦åå•†ç¼“å­˜\n  Cache-Control: no-store         // ä¸ç¼“å­˜\n  Cache-Control: private          // åªèƒ½æµè§ˆå™¨ç¼“å­˜\n  Cache-Control: public           // å¯ä»¥è¢«ä»£ç†æœåŠ¡å™¨ç¼“å­˜\n  Cache-Control: must-revalidate  // è¿‡æœŸå‰å¯ç”¨ï¼Œè¿‡æœŸåå¿…é¡»éªŒè¯\n  ```\n\n  **è®°å¿†æŠ€å·§ï¼š** \"maxå®šæ—¶é—´ï¼Œno-cacheè¦åå•†ï¼Œno-storeä¸å­˜å‚¨\"\n\n- **ETag å’Œ Last-Modified**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - **Last-Modified**ï¼šæ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´ï¼ˆç²¾åº¦ç§’çº§ï¼Œå¯èƒ½è¯¯åˆ¤ï¼‰\n  - **ETag**ï¼šæ–‡ä»¶å†…å®¹å“ˆå¸Œå€¼ï¼ˆç²¾åº¦é«˜ï¼Œéœ€è¦è®¡ç®—ï¼‰\n\n  **ä¼˜å…ˆçº§ï¼š** ETag > Last-Modifiedï¼ˆETagæ›´å‡†ç¡®ï¼‰\n\n  **å®é™…åœºæ™¯ï¼š**\n\n  ```\n  // ç¬¬ä¸€æ¬¡è¯·æ±‚\n  Response Headers:\n    Last-Modified: Mon, 10 Jan 2024 10:00:00 GMT\n    ETag: \"abc123\"\n  \n  // ç¬¬äºŒæ¬¡è¯·æ±‚\n  Request Headers:\n    If-Modified-Since: Mon, 10 Jan 2024 10:00:00 GMT\n    If-None-Match: \"abc123\"\n  \n  // æœªä¿®æ”¹è¿”å›304ï¼Œä¿®æ”¹äº†è¿”å›200+æ–°å†…å®¹\n  ```\n\n  \n\n- **ç¼“å­˜ä½ç½®ï¼ˆMemory Cacheã€Disk Cacheç­‰ï¼‰**\n  \n  **æ ¸å¿ƒç­”æ¡ˆï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ï¼š**\n  \n  1. **Service Worker**ï¼šå¯ç¼–ç¨‹æ§åˆ¶\n  2. **Memory Cache**ï¼šå†…å­˜ç¼“å­˜ï¼Œå¿«ä½†é‡å°ï¼Œå…³é—­Tabå°±æ²¡äº†\n  3. **Disk Cache**ï¼šç¡¬ç›˜ç¼“å­˜ï¼Œæ…¢ä½†é‡å¤§ï¼ŒæŒä¹…åŒ–\n  4. **Push Cache**ï¼šHTTP/2æ¨é€ç¼“å­˜ï¼Œä¼šè¯çº§åˆ«\n  \n  **è®°å¿†å£è¯€ï¼š** \"Serviceæ§åˆ¶æƒæœ€é«˜ï¼ŒMemoryå¿«ä½†æ´»ä¸ä¹…ï¼ŒDiskæ…¢ä½†èƒ½æŒä¹…ï¼ŒPushæ˜¯HTTP/2ç‰¹æœ‰\"\n\n## 1.3 HTTP ç‰ˆæœ¬æ¼”è¿›\n\n- **HTTP/1.0 vs HTTP/1.1**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š** HTTP/1.1 çš„æ”¹è¿›ï¼š\n\n  - **æŒä¹…è¿æ¥**ï¼šConnection: keep-aliveï¼ˆé»˜è®¤å¼€å¯ï¼‰\n  - **ç®¡é“åŒ–**ï¼šå¯ä»¥åŒæ—¶å‘å¤šä¸ªè¯·æ±‚ï¼ˆä½†æœ‰é˜Ÿå¤´é˜»å¡ï¼‰\n  - **Hostå¤´**ï¼šæ”¯æŒè™šæ‹Ÿä¸»æœº\n  - **æ–­ç‚¹ç»­ä¼ **ï¼šRangeå¤´æ”¯æŒ\n  - **ç¼“å­˜å¢å¼º**ï¼šCache-Controlã€ETagç­‰\n\n  **ç†è§£tipsï¼š**\n\n  - HTTP/1.0åƒ**æ‰“ä¸€æ¬¡ç”µè¯è¯´ä¸€ä»¶äº‹å°±æŒ‚**\n  - HTTP/1.1åƒ**æ‰“ä¸€æ¬¡ç”µè¯å¯ä»¥è¯´å¤šä»¶äº‹**\n\n- **HTTP/2 çš„ä¼˜åŠ¿ï¼ˆå¤šè·¯å¤ç”¨ã€æœåŠ¡å™¨æ¨é€ç­‰ï¼‰**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - **äºŒè¿›åˆ¶åˆ†å¸§**ï¼šå°†æ•°æ®åˆ†æˆå¸§ï¼Œä¸å†æ˜¯æ–‡æœ¬\n  - **å¤šè·¯å¤ç”¨**ï¼šä¸€ä¸ªTCPè¿æ¥å¹¶è¡Œå¤„ç†å¤šä¸ªè¯·æ±‚\n  - **å¤´éƒ¨å‹ç¼©**ï¼šHPACKç®—æ³•å‹ç¼©å¤´éƒ¨\n  - **æœåŠ¡å™¨æ¨é€**ï¼šä¸»åŠ¨æ¨é€èµ„æº\n  - **æµä¼˜å…ˆçº§**ï¼šå¯ä»¥è®¾ç½®è¯·æ±‚ä¼˜å…ˆçº§\n\n  **ç†è§£tipsï¼š** HTTP/1.1åƒ**å•è½¦é“**æ’é˜Ÿé€šè¡Œï¼ŒHTTP/2åƒ**å¤šè½¦é“é«˜é€Ÿ**å¹¶è¡Œé€šè¡Œ\n\n- **HTTP/3 å’Œ QUIC åè®®**\n  \n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n  \n  - **åŸºäºUDP**ï¼šé¿å…TCPçš„é˜Ÿå¤´é˜»å¡\n  - **0-RTTå»ºè¿**ï¼šå‡å°‘æ¡æ‰‹å»¶è¿Ÿ\n  - **è¿æ¥è¿ç§»**ï¼šIPå˜åŒ–ä¸æ–­è¿ï¼ˆæ‰‹æœºåˆ‡æ¢WiFi/4Gï¼‰\n  - **æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶**ï¼šæ›´å¿«çš„æ¢å¤\n  \n  **è®°å¿†è¦ç‚¹ï¼š** \"HTTP/3 = HTTP/2 + QUIC(UDP)\"\n\n## 1.4 HTTPS å®‰å…¨é€šä¿¡\n\n- **HTTP vs HTTPS**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - HTTPï¼šæ˜æ–‡ä¼ è¾“ï¼Œ80ç«¯å£ï¼Œä¸å®‰å…¨\n  - HTTPSï¼šHTTP + SSL/TLSåŠ å¯†ï¼Œ443ç«¯å£ï¼Œå®‰å…¨\n\n- **HTTPS åŠ å¯†åŸç†**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼ˆæ··åˆåŠ å¯†ï¼‰ï¼š**\n\n  1. **éå¯¹ç§°åŠ å¯†**ï¼šäº¤æ¢å¯¹ç§°å¯†é’¥ï¼ˆæ…¢ä½†å®‰å…¨ï¼‰\n  2. **å¯¹ç§°åŠ å¯†**ï¼šä¼ è¾“æ•°æ®ï¼ˆå¿«ï¼‰\n  3. **æ•°å­—è¯ä¹¦**ï¼šéªŒè¯æœåŠ¡å™¨èº«ä»½\n  4. **æ‘˜è¦ç®—æ³•**ï¼šéªŒè¯æ•°æ®å®Œæ•´æ€§\n\n  **ç†è§£tipsï¼š** åƒ**å¯„è´µé‡ç‰©å“**ï¼šå…ˆç”¨ä¿é™©ç®±ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰è£…ä¸œè¥¿ï¼Œç”¨æŒ‚å·ä¿¡ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰å¯„ä¿é™©ç®±é’¥åŒ™ï¼Œå¿«é€’å…¬å¸çš„è¥ä¸šæ‰§ç…§ï¼ˆæ•°å­—è¯ä¹¦ï¼‰è¯æ˜èº«ä»½\n\n- **HTTPS æ¡æ‰‹è¿‡ç¨‹ï¼š**\n\n  **ç²¾ç®€ç‰ˆç­”æ¡ˆï¼š**\n\n  1. **Client Hello**ï¼šå®¢æˆ·ç«¯å‘é€æ”¯æŒçš„åŠ å¯†å¥—ä»¶\n  2. **Server Hello**ï¼šæœåŠ¡å™¨é€‰æ‹©åŠ å¯†å¥—ä»¶+å‘é€è¯ä¹¦\n  3. **å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦**ï¼šéªŒè¯è¯ä¹¦åˆæ³•æ€§\n  4. **ç”Ÿæˆä¼šè¯å¯†é’¥**ï¼šç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†éšæœºæ•°\n  5. **æœåŠ¡å™¨è§£å¯†**ï¼šå¾—åˆ°ä¼šè¯å¯†é’¥\n  6. **åŠ å¯†é€šä¿¡**ï¼šä½¿ç”¨ä¼šè¯å¯†é’¥å¯¹ç§°åŠ å¯†\n\n  **ä¸­é—´äººæ”»å‡»ï¼š**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š** æ”»å‡»è€…åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œåˆ†åˆ«ä¸ä¸¤è€…å»ºç«‹è¿æ¥ï¼Œçªƒå–æˆ–ç¯¡æ”¹æ•°æ®ã€‚\n\n  **é˜²å¾¡æ–¹å¼ï¼š**\n\n  - æ•°å­—è¯ä¹¦éªŒè¯\n  - HSTSï¼ˆå¼ºåˆ¶ä½¿ç”¨HTTPSï¼‰\n  - è¯ä¹¦é”å®šï¼ˆCertificate Pinningï¼‰\n\n# äºŒã€TCP/IP åè®®ç¯‡\n\n## 2.1 TCP åŸºç¡€\n\n- **TCP ä¸‰æ¬¡æ¡æ‰‹è¯¦è§£**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  1. **SYN**ï¼šå®¢æˆ·ç«¯å‘é€SYN=1, seq=x\n  2. **SYN+ACK**ï¼šæœåŠ¡å™¨å‘é€SYN=1, ACK=1, seq=y, ack=x+1\n  3. **ACK**ï¼šå®¢æˆ·ç«¯å‘é€ACK=1, seq=x+1, ack=y+1\n\n  **ç”ŸåŠ¨æ¯”å–»ï¼š** åƒ**æ‰“ç”µè¯**ï¼š\n\n  - \"å–‚ï¼Œå¬å¾—åˆ°å—ï¼Ÿ\"ï¼ˆSYNï¼‰\n  - \"å¬å¾—åˆ°ï¼Œä½ å¬å¾—åˆ°æˆ‘å—ï¼Ÿ\"ï¼ˆSYN+ACKï¼‰\n  - \"æˆ‘ä¹Ÿå¬å¾—åˆ°\"ï¼ˆACKï¼‰\n\n  **ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - ç¡®è®¤åŒæ–¹æ”¶å‘èƒ½åŠ›æ­£å¸¸\n  - é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚çªç„¶ä¼ åˆ°æœåŠ¡å™¨\n  - åŒæ­¥åŒæ–¹åºåˆ—å·\n\n  **ä¸¤æ¬¡ä¸è¡Œçš„åŸå› ï¼š** æ— æ³•ç¡®è®¤å®¢æˆ·ç«¯çš„æ¥æ”¶èƒ½åŠ›ï¼Œå¯èƒ½é€ æˆæœåŠ¡å™¨èµ„æºæµªè´¹\n\n- **TCP å››æ¬¡æŒ¥æ‰‹è¯¦è§£**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  1. **FIN**ï¼šå®¢æˆ·ç«¯å‘é€FINï¼Œè¿›å…¥FIN_WAIT_1\n  2. **ACK**ï¼šæœåŠ¡å™¨å‘é€ACKï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN_WAIT_2\n  3. **FIN**ï¼šæœåŠ¡å™¨å‘é€FINï¼Œè¿›å…¥LAST_ACK\n  4. **ACK**ï¼šå®¢æˆ·ç«¯å‘é€ACKï¼Œè¿›å…¥TIME_WAIT\n\n  **ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡ä¸æ˜¯ä¸‰æ¬¡ï¼Ÿ** æœåŠ¡å™¨æ”¶åˆ°FINæ—¶å¯èƒ½è¿˜æœ‰æ•°æ®è¦å‘é€ï¼Œæ‰€ä»¥ACKå’ŒFINåˆ†å¼€å‘é€\n\n  **TIME_WAIT çŠ¶æ€çš„ä½œç”¨ï¼š**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - æŒç»­2MSLï¼ˆæœ€å¤§æŠ¥æ–‡ç”Ÿå­˜æ—¶é—´ï¼‰\n  - ä½œç”¨ï¼š\n    1. ç¡®ä¿æœ€åçš„ACKèƒ½åˆ°è¾¾\n    2. è®©æ‰€æœ‰æŠ¥æ–‡åœ¨ç½‘ç»œä¸­æ¶ˆå¤±ï¼Œé¿å…å½±å“æ–°è¿æ¥\n\n## 2.2 TCP å¯é ä¼ è¾“\n\n- **åºåˆ—å·å’Œç¡®è®¤åº”ç­”**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - **åºåˆ—å·**ï¼šç»™æ¯ä¸ªå­—èŠ‚ç¼–å·ï¼Œä¿è¯æ•°æ®é¡ºåº\n  - **ç¡®è®¤åº”ç­”**ï¼šACK=æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºåˆ—å·\n  - **ç´¯ç§¯ç¡®è®¤**ï¼šç¡®è®¤å·ä¹‹å‰çš„æ•°æ®éƒ½å·²æ”¶åˆ°\n\n  **ç†è§£tipsï¼š** åƒ**è€å¸ˆç‚¹å**ï¼š1å·åˆ°äº†ï¼Œ2å·åˆ°äº†...å¦‚æœè¯´\"æˆ‘è¦3å·\"ï¼Œè¯´æ˜1ã€2å·éƒ½åˆ°äº†\n\n- **è¶…æ—¶é‡ä¼ æœºåˆ¶**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - **RTO**ï¼ˆè¶…æ—¶æ—¶é—´ï¼‰= RTTï¼ˆå¾€è¿”æ—¶é—´ï¼‰+ 4Ã—RTTåå·®\n  - **è¶…æ—¶åŠ å€**ï¼šæ¯æ¬¡è¶…æ—¶RTOç¿»å€ï¼ˆé¿å…ç½‘ç»œé›ªå´©ï¼‰\n  - **å¿«é€Ÿé‡ä¼ **ï¼šæ”¶åˆ°3ä¸ªé‡å¤ACKç«‹å³é‡ä¼ ï¼ˆä¸ç­‰è¶…æ—¶ï¼‰\n\n  **è®°å¿†è¦ç‚¹ï¼š** \"è¶…æ—¶è¦ç­‰ï¼Œå¿«é‡ä¼ æ”¶3ä¸ªé‡å¤ACKå°±ä¼ \"\n\n- **æµé‡æ§åˆ¶ï¼ˆæ»‘åŠ¨çª—å£ï¼‰**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - **æ¥æ”¶çª—å£**ï¼šæ¥æ”¶æ–¹å‘Šè¯‰å‘é€æ–¹è‡ªå·±è¿˜èƒ½æ¥æ”¶å¤šå°‘æ•°æ®\n  - **å‘é€çª—å£**ï¼šå‘é€æ–¹æ ¹æ®æ¥æ”¶çª—å£è°ƒæ•´å‘é€é‡\n  - **é›¶çª—å£æ¢æµ‹**ï¼šçª—å£ä¸º0æ—¶å®šæœŸå‘é€æ¢æµ‹æŠ¥æ–‡\n\n  **ç”ŸåŠ¨æ¯”å–»ï¼š** åƒ**è‡ªåŠ©é¤**ï¼šæœåŠ¡å‘˜ï¼ˆæ¥æ”¶æ–¹ï¼‰å‘Šè¯‰ä½ ç›˜å­è¿˜èƒ½è£…å¤šå°‘ï¼ˆçª—å£å¤§å°ï¼‰ï¼Œè£…æ»¡äº†å°±è¯´\"ç­‰ä¸€ä¸‹\"ï¼ˆçª—å£ä¸º0ï¼‰\n\n- **æ‹¥å¡æ§åˆ¶**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼ˆå››ä¸ªç®—æ³•ï¼‰ï¼š**\n\n  1. **æ…¢å¼€å§‹**ï¼šæŒ‡æ•°å¢é•¿ï¼ˆ1,2,4,8...ï¼‰\n  2. **æ‹¥å¡é¿å…**ï¼šçº¿æ€§å¢é•¿ï¼ˆåˆ°è¾¾é˜ˆå€¼åï¼‰\n  3. **å¿«é‡ä¼ **ï¼š3ä¸ªé‡å¤ACKç«‹å³é‡ä¼ \n  4. **å¿«æ¢å¤**ï¼šé˜ˆå€¼å‡åŠï¼Œä¸é‡æ–°æ…¢å¼€å§‹\n\n  **è®°å¿†å£è¯€ï¼š** \"æ…¢å¼€å§‹æŒ‡æ•°å¢ï¼Œé¿å…åçº¿æ€§å¢ï¼Œå¿«é‡ä¼ 3ä¸ªACKï¼Œå¿«æ¢å¤é˜ˆå€¼å‡åŠ\"\n\n## 2.3 TCP vs UDP\n\n- **ä¸¤è€…çš„åŒºåˆ«å¯¹æ¯”**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  | TCP                  | UDP                |\n  | :------------------- | ------------------ |\n  | å¯é ä¼ è¾“             | ä¸å¯é              |\n  | é¢å‘è¿æ¥             | æ— è¿æ¥             |\n  | å­—èŠ‚æµ               | æ•°æ®æŠ¥             |\n  | æœ‰åº                 | å¯èƒ½ä¹±åº           |\n  | æœ‰æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ | æ—                  |\n  | å¤´éƒ¨20å­—èŠ‚           | å¤´éƒ¨8å­—èŠ‚          |\n  | ä¸€å¯¹ä¸€               | æ”¯æŒä¸€å¯¹å¤šã€å¤šå¯¹å¤š |\n\n  **è®°å¿†æŠ€å·§ï¼š** TCPåƒ**æ‰“ç”µè¯**ï¼ˆå¯é ä½†è´¹äº‹ï¼‰ï¼ŒUDPåƒ**å‘çŸ­ä¿¡**ï¼ˆå¿«ä½†ä¸ä¿è¯é€è¾¾ï¼‰\n\n- **å„è‡ªçš„åº”ç”¨åœºæ™¯**\n\n  **TCPé€‚ç”¨ï¼š**\n\n  - HTTP/HTTPS\n  - FTPæ–‡ä»¶ä¼ è¾“\n  - SMTPé‚®ä»¶\n  - SSHè¿œç¨‹ç™»å½•\n\n  **UDPé€‚ç”¨ï¼š**\n\n  - DNSæŸ¥è¯¢\n  - è§†é¢‘ç›´æ’­/è¯­éŸ³é€šè¯\n  - æ¸¸æˆå®æ—¶å¯¹æˆ˜\n  - DHCP\n\n- **ä¸ºä»€ä¹ˆè§†é¢‘ç›´æ’­å¸¸ç”¨ UDPï¼Ÿ**\n  \n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n  \n  - **å®æ—¶æ€§è¦æ±‚é«˜**ï¼šå®å¯ä¸¢å¸§ä¹Ÿä¸è¦å¡é¡¿\n  - **å¯ä»¥å®¹å¿å°‘é‡ä¸¢åŒ…**ï¼šä¸¢å‡ å¸§äººçœ¼å¯Ÿè§‰ä¸åˆ°\n  - **ä¸éœ€è¦é‡ä¼ **ï¼šé‡ä¼ çš„æ—§æ•°æ®æ²¡æ„ä¹‰\n\n# ä¸‰ã€æµè§ˆå™¨ç½‘ç»œç¯‡\n\n## 3.1 è·¨åŸŸé—®é¢˜\n\n- **åŒæºç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - **åŒæº**ï¼šåè®®+åŸŸå+ç«¯å£éƒ½ç›¸åŒ\n  - **é™åˆ¶**ï¼šDOMè®¿é—®ã€Cookie/LocalStorageè¯»å–ã€AJAXè¯·æ±‚\n  - **ä¸é™åˆ¶**ï¼š`<script>`ã€`<img>`ã€`<link>`æ ‡ç­¾\n\n  **è®°å¿†è¦ç‚¹ï¼š** \"åè®®åŸŸåç«¯å£ï¼Œä¸‰åŒæ‰åŒæº\"\n\n- **è·¨åŸŸçš„è§£å†³æ–¹æ¡ˆæ±‡æ€»**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼ˆæŒ‰å¸¸ç”¨åº¦æ’åºï¼‰ï¼š**\n\n  1. **CORS**ï¼šæœåŠ¡å™¨è®¾ç½®Access-Control-Allow-Origin\n  2. **ä»£ç†æœåŠ¡å™¨**ï¼šåŒæºæœåŠ¡å™¨è½¬å‘è¯·æ±‚\n  3. **JSONP**ï¼šscriptæ ‡ç­¾+å›è°ƒå‡½æ•°\n  4. **WebSocket**ï¼šæ²¡æœ‰åŒæºé™åˆ¶\n  5. **postMessage**ï¼šiframeé€šä¿¡\n\n- **CORS è¯¦è§£**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  ```\n  // ç®€å•è¯·æ±‚ï¼ˆGET/POST/HEAD + ç®€å•å¤´ï¼‰\n  Access-Control-Allow-Origin: *\n  Access-Control-Allow-Credentials: true  // æºå¸¦Cookie\n  \n  // é¢„æ£€è¯·æ±‚ï¼ˆå¤æ‚è¯·æ±‚å…ˆå‘OPTIONSï¼‰\n  Access-Control-Allow-Methods: GET, POST, PUT\n  Access-Control-Allow-Headers: Content-Type, X-Token\n  Access-Control-Max-Age: 86400  // é¢„æ£€ç¼“å­˜æ—¶é—´\n  ```\n\n  **è§¦å‘é¢„æ£€çš„æ¡ä»¶ï¼š**\n\n  - éç®€å•è¯·æ±‚æ–¹æ³•ï¼ˆPUT/DELETEç­‰ï¼‰\n  - è‡ªå®šä¹‰è¯·æ±‚å¤´\n  - Content-Typeä¸æ˜¯ç®€å•ç±»å‹\n\n- **JSONP åŸç†åŠé™åˆ¶**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  ```javascript\n  // åŸç†ï¼šåŠ¨æ€åˆ›å»ºscriptæ ‡ç­¾\n  function jsonp(url, callback) {\n    const script = document.createElement('script');\n    window[callback] = function(data) {\n      console.log(data);\n      delete window[callback];\n      document.body.removeChild(script);\n    }\n    script.src = `${url}?callback=${callback}`;\n    document.body.appendChild(script);\n  }\n  ```\n\n  **é™åˆ¶ï¼š**\n\n  - åªæ”¯æŒGETè¯·æ±‚\n  - å¯èƒ½XSSæ”»å‡»\n  - é”™è¯¯å¤„ç†å›°éš¾\n\n## 3.2 ç»å…¸é—®é¢˜ï¼šä» URL åˆ°é¡µé¢å±•ç¤º\n\néå¸¸è¯¦ç»†çš„ä¸€ç‰‡å›ç­”ï¼šhttps://bytetech.info/articles/6903166461217341454?searchId=2025081516181986474146815928AE395F\n\n## 3.3 WebSocket\n\n- **WebSocket vs HTTP**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  | **HTTP**         | **WebSocket**    |\n  | ---------------- | ---------------- |\n  | åŠåŒå·¥           | å…¨åŒå·¥           |\n  | æ— çŠ¶æ€           | æœ‰çŠ¶æ€           |\n  | è¯·æ±‚-å“åº”æ¨¡å¼    | æŒä¹…è¿æ¥         |\n  | æ–‡æœ¬/äºŒè¿›åˆ¶      | å¸§åè®®           |\n  | æ¯æ¬¡è¯·æ±‚éƒ½æœ‰å¤´éƒ¨ | å»ºç«‹åå¤´éƒ¨å¼€é”€å° |\n\n- **WebSocket è¿æ¥è¿‡ç¨‹**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  ```\n  // 1. æ¡æ‰‹è¯·æ±‚ï¼ˆHTTPå‡çº§ï¼‰\n  GET /ws HTTP/1.1\n  Upgrade: websocket\n  Connection: Upgrade\n  Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==\n  \n  // 2. æ¡æ‰‹å“åº”\n  HTTP/1.1 101 Switching Protocols\n  Upgrade: websocket\n  Connection: Upgrade\n  Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=\n  \n  // 3. æ•°æ®ä¼ è¾“ï¼ˆä½¿ç”¨å¸§ï¼‰\n  const ws = new WebSocket('ws://localhost:8080');\n  ws.onmessage = (e) => console.log(e.data);\n  ws.send('Hello Server');\n  ```\n\n  åº”ç”¨åœºæ™¯ï¼š\n\n  - å®æ—¶èŠå¤©\n  - å®æ—¶æ¨é€\n  - ååŒç¼–è¾‘\n  - å®æ—¶æ¸¸æˆ\n  - è‚¡ç¥¨è¡Œæƒ…\n\n# å››ã€Web å®‰å…¨ç¯‡\n\n## 4.1 XSS æ”»å‡»\n\n- **XSS ç±»å‹ï¼ˆåå°„å‹ã€å­˜å‚¨å‹ã€DOMå‹ï¼‰**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  1. **åå°„å‹XSS**ï¼šURLå‚æ•°ç›´æ¥è¾“å‡ºåˆ°é¡µé¢\n  2. **å­˜å‚¨å‹XSS**ï¼šæ¶æ„è„šæœ¬å­˜å…¥æ•°æ®åº“\n  3. **DOMå‹XSS**ï¼šä¿®æ”¹DOMèŠ‚ç‚¹è§¦å‘\n\n  **è®°å¿†å£è¯€ï¼š** \"åå°„å³æ—¶ç°ï¼Œå­˜å‚¨å…¥åº“é™©ï¼ŒDOMæ”¹èŠ‚ç‚¹\"\n\n- **XSS é˜²å¾¡ç­–ç•¥**\n\n  ```js\n  // 1. è¾“å…¥è¿‡æ»¤ï¼ˆä¸å¯é ï¼‰\n  // 2. è¾“å‡ºè½¬ä¹‰ï¼ˆæ ¸å¿ƒï¼‰\n  function escape(str) {\n    return str\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#x27;');\n  }\n  \n  // 3. CSPå†…å®¹å®‰å…¨ç­–ç•¥\n  Content-Security-Policy: default-src 'self'\n  \n  // 4. HttpOnly Cookieï¼ˆé˜²æ­¢JSè¯»å–ï¼‰\n  Set-Cookie: session=abc; HttpOnly\n  ```\n\n- **CSP å†…å®¹å®‰å…¨ç­–ç•¥**\n  \n  ```\n  // é™åˆ¶èµ„æºåŠ è½½æ¥æº\n  Content-Security-Policy: \n    default-src 'self';           // é»˜è®¤åŒæº\n    script-src 'self' cdn.com;    // JSæ¥æº\n    style-src 'self' 'unsafe-inline'; // CSSæ¥æº\n    img-src *;                     // å›¾ç‰‡æ¥æº\n    connect-src api.example.com;  // AJAX/WebSocket\n  ```\n  \n  \n\n## 4.2 CSRF æ”»å‡»\n\n- **CSRF æ”»å‡»åŸç†**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š** è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼šåˆ©ç”¨ç”¨æˆ·å·²ç™»å½•çš„èº«ä»½ï¼Œè¯±å¯¼ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™ï¼Œæ¶æ„ç½‘ç«™å‘ç›®æ ‡ç½‘ç«™å‘é€è¯·æ±‚ã€‚\n\n  **æ”»å‡»æµç¨‹ï¼š**\n\n  1. ç”¨æˆ·ç™»å½•é“¶è¡Œç½‘ç«™ï¼Œæœ‰äº†Cookie\n  2. ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™\n  3. æ¶æ„ç½‘ç«™å‘é€è½¬è´¦è¯·æ±‚åˆ°é“¶è¡Œ\n  4. æµè§ˆå™¨è‡ªåŠ¨å¸¦ä¸ŠCookie\n  5. é“¶è¡Œæ‰§è¡Œè½¬è´¦\n\n  **ç”ŸåŠ¨æ¯”å–»ï¼š** åƒ**å·ç”¨ä½ çš„èº«ä»½è¯**ï¼šä½ ç™»å½•äº†é“¶è¡Œï¼ˆæœ‰èº«ä»½è¯æ˜ï¼‰ï¼Œéª—å­ç½‘ç«™å·å·æ‹¿ä½ çš„èº«ä»½è¯æ˜å»åŠäº‹\n\n- **CSRF é˜²å¾¡æ–¹æ³•**\n\n  ```\n  // 1. CSRF Token\n  // æœåŠ¡å™¨ç”Ÿæˆtokenæ”¾åœ¨è¡¨å•ä¸­\n  <input type=\"hidden\" name=\"csrf_token\" value=\"random_token\">\n  \n  // 2. éªŒè¯Referer\n  if (request.headers.referer !== 'https://mybank.com') {\n    return 403;\n  }\n  \n  // 3. SameSite Cookie\n  Set-Cookie: session=abc; SameSite=Strict;  // å®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹\n  Set-Cookie: session=abc; SameSite=Lax;     // éƒ¨åˆ†å…è®¸ï¼ˆé“¾æ¥å¯ä»¥ï¼‰\n  Set-Cookie: session=abc; SameSite=None;    // éƒ½å…è®¸ï¼ˆéœ€HTTPSï¼‰\n  \n  // 4. åŒé‡CookieéªŒè¯\n  // Cookieä¸­å’Œè¯·æ±‚å‚æ•°éƒ½å¸¦tokenï¼ŒæœåŠ¡å™¨å¯¹æ¯”\n  ```\n\n  **è®°å¿†è¦ç‚¹ï¼š** \"TokenéªŒèº«ä»½ï¼ŒRefererçœ‹æ¥æºï¼ŒSameSiteé™Cookie\"\n\n\n# äº”ã€æ€§èƒ½ä¼˜åŒ–ç¯‡\n\n## 5.1 ç½‘ç»œå±‚ä¼˜åŒ–\n\n- **å‡å°‘ HTTP è¯·æ±‚æ•°**\n\n  ```\n  // 1. èµ„æºåˆå¹¶\n  // CSS Spritesã€JS/CSSæ‰“åŒ…\n  \n  // 2. å†…è”èµ„æº\n  // å°å›¾ç‰‡base64ã€å…³é”®CSSå†…è”\n  \n  // 3. ä½¿ç”¨ç¼“å­˜\n  // å¼ºç¼“å­˜é¿å…è¯·æ±‚\n  \n  // 4. æ‡’åŠ è½½\n  // å›¾ç‰‡æ‡’åŠ è½½ã€è·¯ç”±æ‡’åŠ è½½\n  ```\n\n- **ä½¿ç”¨ HTTP/2**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - å¤šè·¯å¤ç”¨å‡å°‘è¿æ¥æ•°\n  - æœåŠ¡å™¨æ¨é€å…³é”®èµ„æº\n  - å¤´éƒ¨å‹ç¼©å‡å°‘ä¼ è¾“é‡\n  - è¯·æ±‚ä¼˜å…ˆçº§ä¼˜åŒ–åŠ è½½é¡ºåº\n\n- **å¯ç”¨ Gzip å‹ç¼©**\n\n  ```\n  // Nginxé…ç½®\n  gzip on;\n  gzip_types text/plain text/css application/javascript;\n  gzip_min_length 1024;\n  gzip_comp_level 6;  // å‹ç¼©çº§åˆ«1-9\n  \n  // æ•ˆæœï¼šé€šå¸¸èƒ½å‹ç¼©60-80%\n  ```\n\n- **ä½¿ç”¨ CDN**\n\n  **æ ¸å¿ƒç­”æ¡ˆï¼š**\n\n  - **å°±è¿‘è®¿é—®**ï¼šç”¨æˆ·è®¿é—®æœ€è¿‘èŠ‚ç‚¹\n  - **è´Ÿè½½å‡è¡¡**ï¼šåˆ†æ•£æœåŠ¡å™¨å‹åŠ›\n  - **ç¼“å­˜é™æ€èµ„æº**ï¼šå‡å°‘æºç«™å‹åŠ›\n  - **æŠ—DDoS**ï¼šåˆ†å¸ƒå¼æ¶æ„\n\n  **è®°å¿†è¦ç‚¹ï¼š** \"CDN = å†…å®¹åˆ†å‘ç½‘ç»œï¼Œè®©ç”¨æˆ·å°±è¿‘æ‹¿èµ„æº\"\n\n  \n\n## 5.2 èµ„æºåŠ è½½ä¼˜åŒ–\n\n- **é¢„åŠ è½½ï¼ˆpreloadã€prefetchï¼‰**\n\n  ```html\n  <!-- preloadï¼šå½“å‰é¡µé¢å¿…éœ€ï¼Œé«˜ä¼˜å…ˆçº§ -->\n  <link rel=\"preload\" href=\"style.css\" as=\"style\">\n  <link rel=\"preload\" href=\"font.woff2\" as=\"font\" crossorigin>\n  \n  <!-- prefetchï¼šæœªæ¥é¡µé¢éœ€è¦ï¼Œä½ä¼˜å…ˆçº§ -->\n  <link rel=\"prefetch\" href=\"next-page.js\">\n  \n  <!-- dns-prefetchï¼šé¢„è§£æDNS -->\n  <link rel=\"dns-prefetch\" href=\"//api.example.com\">\n  \n  <!-- preconnectï¼šé¢„å»ºç«‹è¿æ¥(DNS+TCP+TLS) -->\n  <link rel=\"preconnect\" href=\"//api.example.com\">\n  ```\n\n- **æ‡’åŠ è½½**\n\n  ```js\n  // 1. å›¾ç‰‡æ‡’åŠ è½½\n  // Intersection Observer API\n  const observer = new IntersectionObserver((entries) => {\n    entries.forEach(entry => {\n      if (entry.isIntersecting) {\n        const img = entry.target;\n        img.src = img.dataset.src;\n        observer.unobserve(img);\n      }\n    });\n  });\n  \n  // 2. è·¯ç”±æ‡’åŠ è½½\n  const Home = () => import('./views/Home.vue');\n  \n  // 3. ç»„ä»¶æ‡’åŠ è½½\n  const HeavyComponent = React.lazy(() => import('./Heavy'));\n  ```\n\n  \n\n- **å›¾ç‰‡ä¼˜åŒ–ç­–ç•¥**\n\n  ```html\n  // 1. é€‰æ‹©åˆé€‚æ ¼å¼\n  WebP > JPEG/PNG    // æ–°æµè§ˆå™¨\n  JPEGï¼šç…§ç‰‡        // æœ‰æŸå‹ç¼©\n  PNGï¼šé€æ˜å›¾       // æ— æŸå‹ç¼©\n  SVGï¼šå›¾æ ‡çŸ¢é‡å›¾   // å¯ç¼©æ”¾\n  \n  // 2. å“åº”å¼å›¾ç‰‡\n  <picture>\n    <source srcset=\"image.webp\" type=\"image/webp\">\n    <source srcset=\"image.jpg\" type=\"image/jpeg\">\n    <img src=\"image.jpg\" alt=\"\">\n  </picture>\n  \n  // 3. å›¾ç‰‡å°ºå¯¸\n  <img srcset=\"320w.jpg 320w, 640w.jpg 640w\" \n       sizes=\"(max-width: 320px) 320px, 640px\">\n  \n  // 4. æ¸è¿›å¼åŠ è½½\n  // å…ˆæ¨¡ç³Šåæ¸…æ™°ï¼ˆå¦‚çŸ¥ä¹ã€Mediumï¼‰\n  ```\n\n  \n\n# å…­ã€å®æˆ˜é¢˜ç›®ç¯‡\n\nï¼ˆæ”¶å½•å„å¤§å…¬å¸çœŸå®é¢è¯•é¢˜åŠè¯¦è§£ï¼‰","tags":["ç§‹æ‹›","è®¡ç®—æœºç½‘ç»œ","é¢è¯•å…«è‚¡æ–‡"],"categories":["ç§‹æ‹›å‡†å¤‡"]},{"title":"ã€å»ºç«™æ—¥å¿—ã€‘SimonæˆåŠŸæ¬å®¶","url":"/2025/06/12/ã€å»ºç«™æ—¥å¿—ã€‘Simonå·²ç€é™†/","content":"\nä¹‹å‰ç”¨Wordpresså»ºçš„ç½‘ç«™çªç„¶ç‚¸äº†T_Tï¼Œåªå¥½æ¬å®¶åˆ°Hexoè¿™è¾¹æ¥ï¼Œè™½ç„¶ä¹‹å‰å°±æƒ³æ¢æˆssgé™æ€ç½‘ç«™å°±æ˜¯äº†ã€‚æ¯•ç«ŸWordpressåšå®¢ç³»ç»Ÿä¸Šä¼ æ–‡ç« å¤ªä¾¿ç§˜äº†ï¼Œå®Œå…¨ç”¨ä¸æƒ¯ä»–çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œè¿˜æ˜¯MDå¤§æ³•å¥½å•Šï¼\n","tags":["å»ºç«™æ—¥å¿—","ç”Ÿæ´»è®°å½•"]}]